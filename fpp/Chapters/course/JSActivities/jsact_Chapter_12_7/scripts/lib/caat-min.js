(function(d){String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1};Function.prototype.bind=Function.prototype.bind||function(){var o=this;var n=Array.prototype.slice.call(arguments);var p=n.shift();return function(){return o.apply(p,n.concat(Array.prototype.slice.call(arguments)))}};d.isArray=function(n){return typeof(n)=="object"&&(n instanceof Array)};d.isString=function(n){return typeof(n)=="string"};d.isFunction=function(n){return typeof n=="function"};var g=false;var c=function(){};c.extend=function(u,y,n,o,q){var x=this.prototype;g=true;var w=new this();g=false;function s(){if(!g&&this.__init){this.__init.apply(this,arguments)}}s.prototype=w;s.prototype.constructor=s;s.superclass=x;s.extend=c.extend;a(n,s);if(y){y=(isFunction(y)?y():y);for(var t in y){if(y.hasOwnProperty(t)){s[t]=y[t]}}}if(o){if(!isArray(o)){o=[o]}for(var r=0;r<o.length;r++){b(o[r]);var v=a(o[r],s);if(y){for(var t in y){if(y.hasOwnProperty(t)){v[t]=y[t]}}}}}u=(isFunction(u)?u():u);for(var p in u){w[p]=((p==="__init"||(q&&q.decorated))&&isFunction(u[p])&&isFunction(x[p]))?(function(z,A){return function(){var C=this.__super;this.__super=x[z];var B=A.apply(this,arguments);this.__super=C;return B}})(p,u[p]):u[p]}return s};var i=function(n){this.name=n.defines;this.extendWith=n.extendsWith;this.callback=n.onCreate;this.callbackPreCreation=n.onPreCreate;this.dependencies=n.depends;this.baseClass=n.extendsClass;this.aliases=n.aliases;this.constants=n.constants;this.decorated=n.decorated;this.children=[];return this};i.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:false,solved:false,visited:false,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?(" unsolved_deps:["+this.dependencies+"]"):" no dependencies.")+(this.solved?" solved":" ------> NOT solved."))},removeDependency:function(o){for(var n=0;n<this.dependencies.length;n++){if(this.dependencies[n]===o){this.dependencies.splice(n,1);break}}},assignDependency:function(o){var n;for(n=0;n<this.dependencies.length;n++){if(this.dependencies[n]===o.name){this.children.push(o);this.dependencies.splice(n,1);break}}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited){return true}this.visited=true;if(this.solved){return true}if(this.dependencies.length!==0){return false}var n=true;for(var o=0;o<this.children.length;o++){if(!this.children[o].solveDeep()){return false}}this.__initModule();this.solved=true;f.solved(this);return true},__initModule:function(){var n=null;if(this.baseClass){n=k(this.baseClass);if(!n){console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass);return}n=n.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated})}else{n=c.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated})}if(this.callback){this.callback()}}};var e=function(o,n){this.path=o;this.module=n;return this};e.prototype={path:null,processed:false,module:null,setProcessed:function(){this.processed=true},isProcessed:function(){return this.processed}};var m=function(){this.nodes=[];this.loadedFiles=[];this.path={};this.solveListener=[];this.orderedSolvedModules=[];this.readyListener=[];return this};m.baseURL="";m.modulePath={};m.sortedModulePath=[];m.symbol={};m.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(n,o){this.solveListener.push({name:n,callback:o})},solved:function(o){var n;for(n=0;n<this.solveListener.length;n++){if(this.solveListener[n].name===o.name){this.solveListener[n].callback()}}this.orderedSolvedModules.push(o);this.notifyReady()},notifyReady:function(){var o;for(o=0;o<this.nodes.length;o++){if(!this.nodes[o].isSolved()){return}}for(o=0;o<this.loadedFiles.length;o++){if(!this.loadedFiles[o].isProcessed()){return}}var p=this;var n=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var q=0;q<n.length;q++){n[q]()}},0);this.readyListener=[]},status:function(){for(var n=0;n<this.nodes.length;n++){this.nodes[n].status()}},module:function(t){var p,o,n;if(this.isModuleScheduledToSolve(t.defines)){return this}if(t.onPreCreate){try{t.onPreCreate()}catch(s){console.log("  -> catched "+s+" on module "+t.defines+" preCreation.")}}if(!t.depends){t.depends=[]}var q=t.depends;if(q){if(!isArray(q)){q=[q];t.depends=q}}n=0;while(n<q.length){if(this.alreadySolved(q[n])){q.splice(n,1)}else{n++}}o=new i(t);for(var n=0;n<this.nodes.length;n++){this.nodes[n].assignDependency(o)}this.nodes.push(o);for(n=0;n<t.depends.length;){if(this.isModuleScheduledToSolve(t.depends[n])){var r=this.findNode(t.depends[n]);if(null!==r){o.assignDependency(r)}else{alert("Module loaded and does not exist in loaded modules nodes. "+t.depends[n]);n++}}else{n+=1}}(function(v,u){setTimeout(function(){for(n=0;n<u.depends.length;n++){v.loadFile(u.depends[n])}},0)})(this,t);return this},findNode:function(n){for(var o=0;o<this.nodes.length;o++){if(this.nodes[o].name===n){return this.nodes[o]}}return null},alreadySolved:function(n){for(var o=0;o<this.nodes.length;o++){if(this.nodes[o].name===n&&this.nodes[o].isSolved()){return true}}return false},exists:function(p){var p=p.split(".");var n=d;for(var o=0;o<p.length;o++){if(!n[p[o]]){return false}n=n[p[o]]}return true},loadFile:function(o){if(this.exists(o)){return}var r=this.getPath(o);for(var n=0;n<this.loadedFiles.length;n++){if(this.loadedFiles[n].path===r){return}}var q=new e(r,o);this.loadedFiles.push(q);var p=document.createElement("script");p.type="text/javascript";p.charset="utf-8";p.async=true;CAAT.bindEvent(p,"load",this.moduleLoaded.bind(this),false);CAAT.bindEvent(p,"error",this.moduleErrored.bind(this),false);p.setAttribute("module-name",o);p.src=r+(!j?"?"+(new Date().getTime()):"");document.getElementsByTagName("head")[0].appendChild(p)},getPath:function(o){if(o.endsWith(".js")){if(o.charAt(0)!=="/"){o=m.baseURL+o}else{o=o.substring(1)}return o}var n,r;for(r in m.symbol){if(o===r){return m.baseURL+m.symbol[r]}}for(n=0;n<m.sortedModulePath.length;n++){var q=m.sortedModulePath[n];if(m.modulePath.hasOwnProperty(q)){var s=m.modulePath[q];if(o.indexOf(q)===0){var p=o.substring(q.length+1);p=p.replace(/\./g,"/");p=s+p+".js";return m.baseURL+p}}}return m.baseURL+o.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(n){for(var o=0;o<this.nodes.length;o++){if(this.nodes[o].name===n){return true}}return false},moduleLoaded:function(s){if(s.type==="load"){var r=s.currentTarget||s.srcElement||s.target;var p=r.getAttribute("module-name");for(var o=0;o<this.loadedFiles.length;o++){if(this.loadedFiles[o].module===p){this.loadedFiles[o].setProcessed();break}}for(var o=0;o<this.nodes.length;o++){this.nodes[o].removeDependency(p)}for(var o=0;o<this.nodes.length;o++){for(var n=0;n<this.nodes.length;n++){this.nodes[n].visited=false}this.nodes[o].solveDeep()}var q=this;setTimeout(function(){q.notifyReady()},0)}},moduleErrored:function(o){var n=o.currentTarget||o.srcElement;console.log("Error loading module: "+n.getAttribute("module-name"))},solvedInOrder:function(){for(var n=0;n<this.orderedSolvedModules.length;n++){console.log(this.orderedSolvedModules[n].name)}},solveAll:function(){for(var n=0;n<this.nodes.length;n++){this.nodes[n].solveDeep()}},onReady:function(n){this.readyListener.push(n)}};function b(p){var o=p.split(".");var q=d;for(var n=0;n<o.length-1;n++){if(!q[o[n]]){q[o[n]]={}}q=q[o[n]]}}function a(p,q){var o=p.split(".");var r=d;for(var n=0;n<o.length-1;n++){if(!r[o[n]]){console.log("    Error assigning value to namespace :"+p+". '"+o[n]+"' does not exist.");return null}r=r[o[n]]}r[o[o.length-1]]=q;return r[o[o.length-1]]}function k(p){var o=p.split(".");var q=d;for(var n=0;n<o.length;n++){if(!q[o[n]]){return null}q=q[o[n]]}return q}var f=new m();var j=false;d.CAAT=d.CAAT||{};CAAT.Module=function h(n){if(!n.defines){console.error("Bad module definition: "+n);return}b(n.defines);f.module(n)};CAAT.ModuleManager={};CAAT.ModuleManager.baseURL=function(n){if(!n){return CAAT.Module}if(!n.endsWith("/")){n=n+"/"}m.baseURL=n;return CAAT.ModuleManager};CAAT.ModuleManager.setModulePath=function(n,o){if(!o.endsWith("/")){o=o+"/"}if(!m.modulePath[n]){m.modulePath[n]=o;m.sortedModulePath.push(n);m.sortedModulePath.sort(function(q,p){return q<p})}return CAAT.ModuleManager};CAAT.ModuleManager.symbol=function(n,o){if(!m.symbol[n]){m.symbol[n]=o}return CAAT.ModuleManager};CAAT.ModuleManager.bring=function(o){if(!isArray(o)){o=[o]}for(var n=0;n<o.length;n++){f.loadFile(o[n])}return CAAT.ModuleManager};CAAT.ModuleManager.status=function(){f.status()};CAAT.ModuleManager.addModuleSolvedListener=function(n,o){f.addSolveListener(n,o);return CAAT.ModuleManager};CAAT.ModuleManager.load=function(o,q,n){var p=document.createElement("script");p.type="text/javascript";p.charset="utf-8";p.async=true;if(q){CAAT.bindEvent(p,"load",q,false)}if(n){CAAT.bindEvent(p,"error",n,false)}CAAT.bindEvent(p,"load",function(){f.solveAll()},false);p.src=o+(!j?"?"+(new Date().getTime()):"");document.getElementsByTagName("head")[0].appendChild(p)};CAAT.ModuleManager.solvedInOrder=function(){f.solvedInOrder()};CAAT.ModuleManager.onReady=function(n){f.onReady(n);return CAAT.ModuleManager};CAAT.ModuleManager.solveAll=function(){f.solveAll()};CAAT.ModuleManager.debug=function(n){j=n;return CAAT.ModuleManager}})(this);CAAT.Module({defines:"CAAT.Core.Constants",extendsWith:function(){CAAT.setCoordinateClamping=function(a){if(a){CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp;CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp;CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp;CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp}else{CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp;CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp;CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp;CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp}};CAAT.log=function(){if(window.console){window.console.log(Array.prototype.slice.call(arguments))}};CAAT.CSS_TEXT_METRICS=0;CAAT.GLRENDER=false;CAAT.DEBUG=false;CAAT.DEBUGBB=false;CAAT.DEBUGBBBCOLOR="#00f";CAAT.DEBUGAABB=false;CAAT.DEBUGAABBCOLOR="#f00";CAAT.DEBUG_DIRTYRECTS=false;CAAT.DRAG_THRESHOLD_X=5;CAAT.DRAG_THRESHOLD_Y=5;return{}}});CAAT.Module({defines:"CAAT.Event.Manager",extendsWith:function(){var a=[];CAAT.bindEvent=function(d,c,e,b){d.addEventListener(c,e,b);a.push({el:d,type:c,func:e,cap:b})};CAAT.clearEvents=function(){for(var b=0;b<a.length;b++){var c=a[b];c.el.removeEventListener(c.type,c.func,c.cap)}if(CAAT.INTERVAL_ID){clearInterval(CAAT.INTERVAL_ID)}if(CAAT.RAF_ID){window.cancelAnimFrame(CAAT.RAF_ID)}};return{}}});extend=function(b,e){var d=b.prototype;var a=function(){};a.prototype=e.prototype;b.prototype=new a();b.superclass=e.prototype;b.prototype.constructor=b;if(e.prototype.constructor===Object.prototype.constructor){e.prototype.constructor=e}for(var c in d){if(d.hasOwnProperty(c)){b.prototype[c]=d[c]}}};extendWith=function(c,a,d){var b=function(){};b.prototype=c.prototype;a.prototype=new b();a.superclass=c.prototype;a.prototype.constructor=a;if(c.prototype.constructor===Object.prototype.constructor){c.prototype.constructor=c}if(d){for(var e in d){if(d.hasOwnProperty(e)){a.prototype[e]=d[e]}}}};proxy=function(c,g,a,b){if(typeof c==="function"){if(c.__isProxy){return c}return(function(h){var i=function(){if(g){g({fn:h,arguments:Array.prototype.slice.call(arguments)})}var m=null;try{m=h.apply(h,Array.prototype.slice.call(arguments));if(a){m=a({fn:h,arguments:Array.prototype.slice.call(arguments)})}}catch(k){if(b){m=b({fn:h,arguments:Array.prototype.slice.call(arguments),exception:k})}else{throw k}}return m};i.__isProxy=true;for(var j in h){if(h.hasOwnProperty(j)&&typeof h[j]!=="function"){if(j!=="__object"&&j!=="__isProxy"){(function(m,k,n){m.__defineGetter__(n,function(){return k[n]});m.__defineSetter__(n,function(o){k[n]=o})})(i,h,j)}}}return i})(c)}if(typeof c!=="object"||isArray(c)||isString(c)||c.__isProxy){return c}var e=function(){};var d=new e();d.__object=c;d.__isProxy=true;for(var f in c){if(c.hasOwnProperty(f)&&typeof c[f]==="function"){d[f]=(function(h,i,j){return function(){if(g){g({object:h.__object,method:j,arguments:Array.prototype.slice.call(arguments)})}var m=null;try{m=i.apply(h.__object,arguments);if(a){a({object:h.__object,method:j,arguments:Array.prototype.slice.call(arguments)})}}catch(k){if(b){m=b({object:h.__object,method:j,arguments:Array.prototype.slice.call(arguments),exception:k})}else{throw k}}return m}})(d,c[f],f)}else{if(f!=="__object"&&f!=="__isProxy"){(function(h,i){h.__defineGetter__(i,function(){return h.__object[i]});h.__defineSetter__(i,function(j){h.__object[i]=j})})(d,f)}}}return d};proxify=function(g,a,d,h,f,b){var e="__"+g+"__";var c=window;var i=g.split(".");while(i.length>1){c=c[i.shift()]}window[e]=c[i];(function(j,p,o,m,k){var n=function(){console.log("Creating object of type proxy["+k+"]");var r=new j[m](Array.prototype.slice.call(arguments));r.____name=k;return proxyObject(r,a,d,h,f,b)};n.prototype=j[m].prototype;for(var q in p[o]){if(p[o].hasOwnProperty(q)&&typeof p[o][q]!=="function"){if(q!=="__object"&&q!=="__isProxy"){(function(r,t,s){s.__defineGetter__(t,function(){return r[t]});s.__defineSetter__(t,function(u){r[t]=u})})(p[o],q,n)}}}p[o]=n})(window,c,i,e,g)};proxyObject=function(d,h,b,c,a,g){if(typeof d!=="object"||isArray(d)||isString(d)||d.__isProxy){return d}d.$proxy__isProxy=true;for(var f in d){if(!d.hasOwnProperty(f)){continue}if(f==="constructor"){continue}if(typeof d[f]==="function"){var e=d[f];d["$proxy__"+f]=e;d[f]=(function(j,k,i){return function(){var m=Array.prototype.slice.call(arguments);if(h){h({object:j,objectName:j.____name,method:i,arguments:m})}var o=null;try{o=k.apply(j,m);if(b){b({object:j,objectName:j.____name,method:i,arguments:m})}}catch(n){if(c){o=c({object:j,objectName:j.____name,method:i,arguments:m,exception:n})}else{throw n}}return o}})(d,e,f)}else{if(f!=="____name"){(function(j,k,i,m){j["$proxy__"+k]=j[k];j.__defineGetter__(k,function(){if(i){i(j.____name,k)}return j["$proxy__"+k]});j.__defineSetter__(k,function(n){j["$proxy__"+k]=n;if(m){m(j.____name,k,n)}})})(d,f,a,g)}}}return d};CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}});CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:false,applyAsPath:function(a){var b=this.coordlist;if(this.cubic){a.ctx.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}else{a.ctx.quadraticCurveTo(b[1].x,b[1].y,b[2].x,b[2].y)}return this},isQuadric:function(){return !this.cubic},isCubic:function(){return this.cubic},setCubic:function(a,h,c,b,e,d,g,f){this.coordlist=[];this.coordlist.push(new CAAT.Math.Point().set(a,h));this.coordlist.push(new CAAT.Math.Point().set(c,b));this.coordlist.push(new CAAT.Math.Point().set(e,d));this.coordlist.push(new CAAT.Math.Point().set(g,f));this.cubic=true;this.update();return this},setQuadric:function(a,f,c,b,e,d){this.coordlist=[];this.coordlist.push(new CAAT.Math.Point().set(a,f));this.coordlist.push(new CAAT.Math.Point().set(c,b));this.coordlist.push(new CAAT.Math.Point().set(e,d));this.cubic=false;this.update();return this},setPoints:function(a){if(a.length===3){this.coordlist=a;this.cubic=false;this.update()}else{if(a.length===4){this.coordlist=a;this.cubic=true;this.update()}else{throw"points must be an array of 3 or 4 CAAT.Point instances."}}return this},paint:function(a){if(this.cubic){this.paintCubic(a)}else{this.paintCuadric(a)}CAAT.Math.Bezier.superclass.paint.call(this,a)},paintCuadric:function(c){var d,f;d=this.coordlist[0].x;f=this.coordlist[0].y;var b=c.ctx;b.save();b.beginPath();b.moveTo(d,f);var a=new CAAT.Math.Point();for(var e=this.k;e<=1+this.k;e+=this.k){this.solve(a,e);b.lineTo(a.x,a.y)}b.stroke();b.restore()},paintCubic:function(c){var d,f;d=this.coordlist[0].x;f=this.coordlist[0].y;var b=c.ctx;b.save();b.beginPath();b.moveTo(d,f);var a=new CAAT.Math.Point();for(var e=this.k;e<=1+this.k;e+=this.k){this.solve(a,e);b.lineTo(a.x,a.y)}b.stroke();b.restore()},solve:function(a,b){if(this.cubic){return this.solveCubic(a,b)}else{return this.solveQuadric(a,b)}},solveCubic:function(f,i){var b=i*i;var a=i*b;var h=this.coordlist;var g=h[0];var e=h[1];var d=h[2];var c=h[3];f.x=(g.x+i*(-g.x*3+i*(3*g.x-g.x*i)))+i*(3*e.x+i*(-6*e.x+e.x*3*i))+b*(d.x*3-d.x*3*i)+c.x*a;f.y=(g.y+i*(-g.y*3+i*(3*g.y-g.y*i)))+i*(3*e.y+i*(-6*e.y+e.y*3*i))+b*(d.y*3-d.y*3*i)+c.y*a;return f},solveQuadric:function(b,f){var d=this.coordlist;var e=d[0];var c=d[1];var a=d[2];var g=1-f;b.x=g*g*e.x+2*g*f*c.x+f*f*a.x;b.y=g*g*e.y+2*g*f*c.y+f*f*a.y;return b}}}});CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(d,c,b,a){this.coordlist=[];this.coordlist.push(d);this.coordlist.push(c);this.coordlist.push(b);this.coordlist.push(a);this.update();return this},paint:function(c){var d,f;d=this.coordlist[1].x;f=this.coordlist[1].y;var b=c.ctx;b.save();b.beginPath();b.moveTo(d,f);var a=new CAAT.Point();for(var e=this.k;e<=1+this.k;e+=this.k){this.solve(a,e);b.lineTo(a.x,a.y)}b.stroke();b.restore();CAAT.Math.CatmullRom.superclass.paint.call(this,c)},solve:function(a,d){var h=this.coordlist;var b=((-d+2)*d-1)*d*0.5;var e=(((3*d-5)*d)*d+2)*0.5;var f=((-3*d+4)*d+1)*d*0.5;var g=((d-1)*d*d)*0.5;a.x=h[0].x*b+h[1].x*e+h[2].x*f+h[3].x*g;a.y=h[0].y*b+h[1].y*e+h[2].y*f+h[3].y*g;return a},applyAsPath:function(c){var b=c.ctx;var a=new CAAT.Math.Point();for(var d=this.k;d<=1+this.k;d+=this.k){this.solve(a,d);b.lineTo(a.x,a.y)}return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}}}});CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:0.05,length:-1,interpolator:false,HANDLE_SIZE:20,drawHandles:true,paint:function(d){if(false===this.drawHandles){return}var c=this.coordlist;var b=d.ctx;b.save();b.beginPath();b.strokeStyle="#a0a0a0";b.moveTo(c[0].x,c[0].y);b.lineTo(c[1].x,c[1].y);b.stroke();if(this.cubic){b.moveTo(c[2].x,c[2].y);b.lineTo(c[3].x,c[3].y);b.stroke()}b.globalAlpha=0.5;for(var e=0;e<this.coordlist.length;e++){b.fillStyle="#7f7f00";var a=this.HANDLE_SIZE/2;b.beginPath();b.arc(c[e].x,c[e].y,a,0,2*Math.PI,false);b.fill()}b.restore()},update:function(){this.calcLength()},solve:function(a,b){},getContour:function(b){var d=[],c;for(c=0;c<=b;c++){var a=new CAAT.Math.Point();this.solve(a,c/b);d.push(a)}return d},getBoundingBox:function(b){if(!b){b=new CAAT.Math.Rectangle()}b.setEmpty();b.union(this.coordlist[0].x,this.coordlist[0].y);var c=new CAAT.Math.Point();for(var a=this.k;a<=1+this.k;a+=this.k){this.solve(c,a);b.union(c.x,c.y)}return b},calcLength:function(){var a,d;a=this.coordlist[0].x;d=this.coordlist[0].y;var c=0;var e=new CAAT.Math.Point();for(var b=this.k;b<=1+this.k;b+=this.k){this.solve(e,b);c+=Math.sqrt((e.x-a)*(e.x-a)+(e.y-d)*(e.y-d));a=e.x;d=e.y}this.length=c;return c},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(a){},setPoint:function(a,b){if(b>=0&&b<this.coordlist.length){this.coordlist[b]=a}},applyAsPath:function(a){}}}});CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(a,b){this.width=a;this.height=b;return this}}}});CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp;CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},extendsWith:function(){return{matrix:null,__init:function(){this.matrix=[1,0,0,0,1,0,0,0,1];if(typeof Float32Array!=="undefined"){this.matrix=new Float32Array(this.matrix)}return this},transformCoord:function(b){var a=b.x;var d=b.y;var c=this.matrix;b.x=a*c[0]+d*c[1]+c[2];b.y=a*c[3]+d*c[4]+c[5];return b},rotate:function(b){var a=new CAAT.Math.Matrix();a.setRotation(b);return a},setRotation:function(d){this.identity();var a=this.matrix;var e=Math.cos(d);var b=Math.sin(d);a[0]=e;a[1]=-b;a[3]=b;a[4]=e;return this},scale:function(c,b){var a=new CAAT.Math.Matrix();a.matrix[0]=c;a.matrix[4]=b;return a},setScale:function(b,a){this.identity();this.matrix[0]=b;this.matrix[4]=a;return this},translate:function(b,c){var a=new CAAT.Math.Matrix();a.matrix[2]=b;a.matrix[5]=c;return a},setTranslate:function(a,b){this.identity();this.matrix[2]=a;this.matrix[5]=b;return this},copy:function(b){b=b.matrix;var a=this.matrix;a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return this},identity:function(){var a=this.matrix;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this},multiply:function(v){var e=this.matrix;var w=v.matrix;var o=e[0];var k=e[1];var i=e[2];var g=e[3];var f=e[4];var d=e[5];var c=e[6];var b=e[7];var a=e[8];var u=w[0];var t=w[1];var s=w[2];var r=w[3];var q=w[4];var p=w[5];var n=w[6];var j=w[7];var h=w[8];e[0]=o*u+k*r+i*n;e[1]=o*t+k*q+i*j;e[2]=o*s+k*p+i*h;e[3]=g*u+f*r+d*n;e[4]=g*t+f*q+d*j;e[5]=g*s+f*p+d*h;e[6]=c*u+b*r+a*n;e[7]=c*t+b*q+a*j;e[8]=c*s+b*p+a*h;return this},premultiply:function(d){var j=d.matrix[0]*this.matrix[0]+d.matrix[1]*this.matrix[3]+d.matrix[2]*this.matrix[6];var i=d.matrix[0]*this.matrix[1]+d.matrix[1]*this.matrix[4]+d.matrix[2]*this.matrix[7];var h=d.matrix[0]*this.matrix[2]+d.matrix[1]*this.matrix[5]+d.matrix[2]*this.matrix[8];var g=d.matrix[3]*this.matrix[0]+d.matrix[4]*this.matrix[3]+d.matrix[5]*this.matrix[6];var f=d.matrix[3]*this.matrix[1]+d.matrix[4]*this.matrix[4]+d.matrix[5]*this.matrix[7];var e=d.matrix[3]*this.matrix[2]+d.matrix[4]*this.matrix[5]+d.matrix[5]*this.matrix[8];var c=d.matrix[6]*this.matrix[0]+d.matrix[7]*this.matrix[3]+d.matrix[8]*this.matrix[6];var b=d.matrix[6]*this.matrix[1]+d.matrix[7]*this.matrix[4]+d.matrix[8]*this.matrix[7];var a=d.matrix[6]*this.matrix[2]+d.matrix[7]*this.matrix[5]+d.matrix[8]*this.matrix[8];this.matrix[0]=j;this.matrix[1]=i;this.matrix[2]=h;this.matrix[3]=g;this.matrix[4]=f;this.matrix[5]=e;this.matrix[6]=c;this.matrix[7]=b;this.matrix[8]=a;return this},getInverse:function(){var o=this.matrix;var n=o[0];var j=o[1];var i=o[2];var g=o[3];var f=o[4];var e=o[5];var c=o[6];var b=o[7];var a=o[8];var k=new CAAT.Math.Matrix();var h=n*(f*a-b*e)-g*(j*a-b*i)+c*(j*e-f*i);if(h===0){return null}var d=k.matrix;d[0]=f*a-e*b;d[1]=i*b-j*a;d[2]=j*e-i*f;d[3]=e*c-g*a;d[4]=n*a-i*c;d[5]=i*g-n*e;d[6]=g*b-f*c;d[7]=j*c-n*b;d[8]=n*f-j*g;k.multiplyScalar(1/h);return k},multiplyScalar:function(a){var b;for(b=0;b<9;b++){this.matrix[b]*=a}return this},transformRenderingContextSet_NoClamp:function(b){var a=this.matrix;b.setTransform(a[0],a[3],a[1],a[4],a[2],a[5]);return this},transformRenderingContext_NoClamp:function(b){var a=this.matrix;b.transform(a[0],a[3],a[1],a[4],a[2],a[5]);return this},transformRenderingContextSet_Clamp:function(b){var a=this.matrix;b.setTransform(a[0],a[3],a[1],a[4],a[2]>>0,a[5]>>0);return this},transformRenderingContext_Clamp:function(b){var a=this.matrix;b.transform(a[0],a[3],a[1],a[4],a[2]>>0,a[5]>>0);return this}}}});CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this},transformCoord:function(b){var a=b.x;var d=b.y;var c=b.z;b.x=a*this.matrix[0][0]+d*this.matrix[0][1]+c*this.matrix[0][2]+this.matrix[0][3];b.y=a*this.matrix[1][0]+d*this.matrix[1][1]+c*this.matrix[1][2]+this.matrix[1][3];b.z=a*this.matrix[2][0]+d*this.matrix[2][1]+c*this.matrix[2][2]+this.matrix[2][3];return b},initialize:function(c,i,f,b,h,e,a,g,d){this.identity();this.matrix[0][0]=c;this.matrix[0][1]=i;this.matrix[0][2]=f;this.matrix[1][0]=b;this.matrix[1][1]=h;this.matrix[1][2]=e;this.matrix[2][0]=a;this.matrix[2][1]=g;this.matrix[2][2]=d;return this},initWithMatrix:function(a){this.matrix=a;return this},flatten:function(){var b=this.fmatrix;var a=this.matrix;b[0]=a[0][0];b[1]=a[1][0];b[2]=a[2][0];b[3]=a[3][0];b[4]=a[0][1];b[5]=a[1][1];b[6]=a[2][1];b[7]=a[2][1];b[8]=a[0][2];b[9]=a[1][2];b[10]=a[2][2];b[11]=a[3][2];b[12]=a[0][3];b[13]=a[1][3];b[14]=a[2][3];b[15]=a[3][3];return this.fmatrix},identity:function(){for(var b=0;b<4;b++){for(var a=0;a<4;a++){this.matrix[b][a]=(b===a)?1:0}}return this},getMatrix:function(){return this.matrix},rotateXY:function(a){return this.rotate(a,0,0)},rotateXZ:function(a){return this.rotate(0,a,0)},rotateYZ:function(a){return this.rotate(0,0,a)},setRotate:function(c,b,d){var a=this.rotate(c,b,d);this.copy(a);return this},rotate:function(f,e,g){var b=new CAAT.Math.Matrix3();var d,h,a;if(f!==0){a=new CAAT.Math.Math.Matrix3();d=Math.sin(f);h=Math.cos(f);a.matrix[1][1]=h;a.matrix[1][2]=-d;a.matrix[2][1]=d;a.matrix[2][2]=h;b.multiply(a)}if(e!==0){a=new CAAT.Math.Matrix3();d=Math.sin(e);h=Math.cos(e);a.matrix[0][0]=h;a.matrix[0][2]=-d;a.matrix[2][0]=d;a.matrix[2][2]=h;b.multiply(a)}if(g!==0){a=new CAAT.Math.Matrix3();d=Math.sin(g);h=Math.cos(g);a.matrix[0][0]=h;a.matrix[0][1]=-d;a.matrix[1][0]=d;a.matrix[1][1]=h;b.multiply(a)}return b},getClone:function(){var a=new CAAT.Math.Matrix3();a.copy(this);return a},multiply:function(I){var G=this.getClone();var M=G.matrix;var e=M[0][0];var c=M[0][1];var b=M[0][2];var a=M[0][3];var F=M[1][0];var E=M[1][1];var D=M[1][2];var C=M[1][3];var x=M[2][0];var w=M[2][1];var v=M[2][2];var u=M[2][3];var h=M[3][0];var g=M[3][1];var f=M[3][2];var d=M[3][3];var t=I.matrix;var p=t[0][0];var o=t[0][1];var j=t[0][2];var i=t[0][3];var L=t[1][0];var K=t[1][1];var J=t[1][2];var H=t[1][3];var B=t[2][0];var A=t[2][1];var z=t[2][2];var y=t[2][3];var s=t[3][0];var r=t[3][1];var q=t[3][2];var k=t[3][3];this.matrix[0][0]=e*p+c*L+b*B+a*s;this.matrix[0][1]=e*o+c*K+b*A+a*r;this.matrix[0][2]=e*j+c*J+b*z+a*q;this.matrix[0][3]=e*i+c*H+b*y+a*k;this.matrix[1][0]=F*p+E*L+D*B+C*s;this.matrix[1][1]=F*o+E*K+D*A+C*r;this.matrix[1][2]=F*j+E*J+D*z+C*q;this.matrix[1][3]=F*i+E*H+D*y+C*k;this.matrix[2][0]=x*p+w*L+v*B+u*s;this.matrix[2][1]=x*o+w*K+v*A+u*r;this.matrix[2][2]=x*j+w*J+v*z+u*q;this.matrix[2][3]=x*i+w*H+v*y+u*k;return this},premultiply:function(I){var G=this.getClone();var M=G.matrix;var e=M[0][0];var c=M[0][1];var b=M[0][2];var a=M[0][3];var F=M[1][0];var E=M[1][1];var D=M[1][2];var C=M[1][3];var x=M[2][0];var w=M[2][1];var v=M[2][2];var u=M[2][3];var h=M[3][0];var g=M[3][1];var f=M[3][2];var d=M[3][3];var t=I.matrix;var p=t[0][0];var o=t[0][1];var j=t[0][2];var i=t[0][3];var L=t[1][0];var K=t[1][1];var J=t[1][2];var H=t[1][3];var B=t[2][0];var A=t[2][1];var z=t[2][2];var y=t[2][3];var s=t[3][0];var r=t[3][1];var q=t[3][2];var k=t[3][3];this.matrix[0][0]=e*p+c*L+b*B;this.matrix[0][1]=e*o+c*K+b*A;this.matrix[0][2]=e*j+c*J+b*z;this.matrix[0][3]=e*i+c*H+b*y+a;this.matrix[1][0]=F*p+E*L+D*B;this.matrix[1][1]=F*o+E*K+D*A;this.matrix[1][2]=F*j+E*J+D*z;this.matrix[1][3]=F*i+E*H+D*y+C;this.matrix[2][0]=x*p+w*L+v*B;this.matrix[2][1]=x*o+w*K+v*A;this.matrix[2][2]=x*j+w*J+v*z;this.matrix[2][3]=x*i+w*H+v*y+u;return this},setTranslate:function(a,c,b){this.identity();this.matrix[0][3]=a;this.matrix[1][3]=c;this.matrix[2][3]=b;return this},translate:function(b,d,c){var a=new CAAT.Math.Matrix3();a.setTranslate(b,d,c);return a},setScale:function(c,b,a){this.identity();this.matrix[0][0]=c;this.matrix[1][1]=b;this.matrix[2][2]=a;return this},scale:function(d,c,b){var a=new CAAT.Math.Matrix3();a.setScale(d,c,b);return a},rotateModelView:function(i,g,d){var h=Math.sin(i);var f=Math.sin(g);var e=Math.sin(d);var c=Math.cos(i);var b=Math.cos(g);var a=Math.cos(d);this.matrix[0][0]=b*c;this.matrix[0][1]=-b*h;this.matrix[0][2]=f;this.matrix[0][3]=0;this.matrix[1][0]=e*f*c+h*a;this.matrix[1][1]=a*c-e*f*h;this.matrix[1][2]=-e*b;this.matrix[1][3]=0;this.matrix[2][0]=e*h-a*f*c;this.matrix[2][1]=a*f*h+e*c;this.matrix[2][2]=a*b;this.matrix[2][3]=0;this.matrix[3][0]=0;this.matrix[3][1]=0;this.matrix[3][2]=0;this.matrix[3][3]=1;return this},copy:function(a){for(var c=0;c<4;c++){for(var b=0;b<4;b++){this.matrix[c][b]=a.matrix[c][b]}}return this},calculateDeterminant:function(){var f=this.matrix;var n=f[0][0],m=f[0][1],j=f[0][2],h=f[0][3],d=f[1][0],c=f[1][1],b=f[1][2],a=f[1][3],r=f[2][0],q=f[2][1],p=f[2][2],o=f[2][3],k=f[3][0],i=f[3][1],g=f[3][2],e=f[3][3];return h*c*p*k+m*a*p*k+h*b*r*i+j*a*r*i+j*d*o*i+n*b*o*i+h*d*q*g+n*a*q*g+j*c*r*e+m*b*r*e+m*d*p*e+n*c*p*e+h*b*q*k-j*a*q*k-j*c*o*k-m*b*o*k-h*d*p*i-n*a*p*i-h*c*r*g-m*a*r*g-m*d*o*g-n*c*o*g-j*d*q*e-n*b*q*e},getInverse:function(){var j=this.matrix;var q=j[0][0],o=j[0][1],m=j[0][2],k=j[0][3],e=j[1][0],d=j[1][1],c=j[1][2],b=j[1][3],i=j[2][0],h=j[2][1],g=j[2][2],f=j[2][3],s=j[3][0],r=j[3][1],p=j[3][2],n=j[3][3];var a=new CAAT.Math.Matrix3();a.matrix[0][0]=c*f*r+b*h*p+d*g*n-b*g*r-d*f*p-c*h*n;a.matrix[0][1]=k*g*r+o*f*p+m*h*n-o*g*n-m*f*r-k*h*p;a.matrix[0][2]=m*b*r+o*c*n+k*d*p-o*b*p-m*d*n-k*c*r;a.matrix[0][3]=k*c*h+o*b*g+m*d*f-m*b*h-k*d*g-o*c*f;a.matrix[1][0]=b*g*s+e*f*p+c*i*n-c*f*s-b*i*p-e*g*n;a.matrix[1][1]=m*f*s+k*i*p+q*g*n-k*g*s-q*f*p-m*i*n;a.matrix[1][2]=k*c*s+q*b*p+m*e*n-m*b*s-k*e*p-q*c*n;a.matrix[1][3]=m*b*i+k*e*g+q*c*f-k*c*i-q*b*g-m*e*f;a.matrix[2][0]=d*f*s+b*i*r+e*h*n-b*h*s-e*f*r-d*i*n;a.matrix[2][1]=k*h*s+q*f*r+o*i*n-q*h*n-o*f*s-k*i*r;a.matrix[2][2]=m*b*s+k*e*r+q*d*n-k*d*s-q*b*r-o*e*n;a.matrix[2][3]=k*d*i+q*b*h+o*e*f-q*d*f-o*b*i-k*e*h;a.matrix[3][0]=c*h*s+e*g*r+d*i*p-d*g*s-c*i*r-e*h*p;a.matrix[3][1]=o*g*s+m*i*r+q*h*p-m*h*s-q*g*r-o*i*p;a.matrix[3][2]=m*d*s+q*c*r+o*e*p-q*d*p-o*c*s-m*e*r;a.matrix[3][3]=o*c*i+m*e*h+q*d*g-m*d*i-q*c*h-o*e*g;return a.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(a){var c,b;for(c=0;c<4;c++){for(b=0;b<4;b++){this.matrix[c][b]*=a}}return this}}}});CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(a,c,b){this.x=a;this.y=c;this.z=b||0;return this},set:function(a,c,b){this.x=a;this.y=c;this.z=b||0;return this},clone:function(){var a=new CAAT.Math.Point(this.x,this.y,this.z);return a},translate:function(a,c,b){this.x+=a;this.y+=c;this.z+=b;return this},translatePoint:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},subtract:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(a){this.x*=a;this.y*=a;this.z*=a;return this},rotate:function(b){var a=this.x,c=this.y;this.x=a*Math.cos(b)-Math.sin(b)*c;this.y=a*Math.sin(b)+Math.cos(b)*c;this.z=0;return this},setAngle:function(b){var a=this.getLength();this.x=Math.cos(b)*a;this.y=Math.sin(b)*a;this.z=0;return this},setLength:function(b){var a=this.getLength();if(a){this.multiply(b/a)}else{this.x=this.y=this.z=b}return this},normalize:function(){var a=this.getLength();this.x/=a;this.y/=a;this.z/=a;return this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(a){var b=this.getLengthSquared();if(b+0.01>a*a){var c=Math.sqrt(b);this.x=(this.x/c)*a;this.y=(this.y/c)*a;this.z=(this.z/c)*a}return this},getLength:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(a<0.005&&a>-0.005){return 0.000001}return a},getLengthSquared:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;if(a<0.005&&a>-0.005){return 0}return a},getDistance:function(b){var c=this.x-b.x;var a=this.y-b.y;var d=this.z-b.z;return Math.sqrt(c*c+a*a+d*d)},getDistanceSquared:function(b){var c=this.x-b.x;var a=this.y-b.y;var d=this.z-b.z;return c*c+a*a+d*d},toString:function(){return"(CAAT.Math.Point) x:"+String(Math.round(Math.floor(this.x*10))/10)+" y:"+String(Math.round(Math.floor(this.y*10))/10)+" z:"+String(Math.round(Math.floor(this.z*10))/10)}}}});CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(a,d,b,c){this.setLocation(a,d);this.setDimension(b,c)},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){this.width=-1;this.height=-1;this.x=0;this.y=0;this.x1=0;this.y1=0;return this},setLocation:function(a,b){this.x=a;this.y=b;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setDimension:function(a,b){this.width=a;this.height=b;this.x1=this.x+this.width;this.y1=this.y+this.height;return this},setBounds:function(a,d,b,c){this.setLocation(a,d);this.setDimension(b,c);return this},contains:function(b,a){return b>=this.x&&b<this.x1&&a>=this.y&&a<this.y1},isEmpty:function(){return this.width===-1&&this.height===-1},union:function(b,a){if(this.isEmpty()){this.x=b;this.x1=b;this.y=a;this.y1=a;this.width=0;this.height=0;return}this.x1=this.x+this.width;this.y1=this.y+this.height;if(a<this.y){this.y=a}if(b<this.x){this.x=b}if(a>this.y1){this.y1=a}if(b>this.x1){this.x1=b}this.width=this.x1-this.x;this.height=this.y1-this.y},unionRectangle:function(a){this.union(a.x,a.y);this.union(a.x1,a.y);this.union(a.x,a.y1);this.union(a.x1,a.y1);return this},intersects:function(a){if(a.isEmpty()||this.isEmpty()){return false}if(a.x1<=this.x){return false}if(a.x>=this.x1){return false}if(a.y1<=this.y){return false}return a.y<this.y1},intersectsRect:function(a,f,b,e){if(-1===b||-1===e){return false}var c=a+b-1;var d=f+e-1;if(c<this.x){return false}if(a>this.x1){return false}if(d<this.y){return false}return f<=this.y1},intersect:function(a,b){if(typeof b==="undefined"){b=new CAAT.Math.Rectangle()}b.x=Math.max(this.x,a.x);b.y=Math.max(this.y,a.y);b.x1=Math.min(this.x1,a.x1);b.y1=Math.min(this.y1,a.y1);b.width=b.x1-b.x;b.height=b.y1-b.y;return b}}}});CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[new CAAT.Behavior.Interpolator().createLinearInterpolator(false,false),"Linear pingpong=false, inverse=false",new CAAT.Behavior.Interpolator().createLinearInterpolator(true,false),"Linear pingpong=true, inverse=false",new CAAT.Behavior.Interpolator().createLinearInterpolator(false,true),"Linear pingpong=false, inverse=true",new CAAT.Behavior.Interpolator().createLinearInterpolator(true,true),"Linear pingpong=true, inverse=true",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(2,false),"ExponentialIn pingpong=false, exponent=2",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(2,false),"ExponentialOut pingpong=false, exponent=2",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(2,false),"ExponentialInOut pingpong=false, exponent=2",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(2,true),"ExponentialIn pingpong=true, exponent=2",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(2,true),"ExponentialOut pingpong=true, exponent=2",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(2,true),"ExponentialInOut pingpong=true, exponent=2",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(4,false),"ExponentialIn pingpong=false, exponent=4",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(4,false),"ExponentialOut pingpong=false, exponent=4",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(4,false),"ExponentialInOut pingpong=false, exponent=4",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(4,true),"ExponentialIn pingpong=true, exponent=4",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(4,true),"ExponentialOut pingpong=true, exponent=4",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(4,true),"ExponentialInOut pingpong=true, exponent=4",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(6,false),"ExponentialIn pingpong=false, exponent=6",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(6,false),"ExponentialOut pingpong=false, exponent=6",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(6,false),"ExponentialInOut pingpong=false, exponent=6",new CAAT.Behavior.Interpolator().createExponentialInInterpolator(6,true),"ExponentialIn pingpong=true, exponent=6",new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(6,true),"ExponentialOut pingpong=true, exponent=6",new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(6,true),"ExponentialInOut pingpong=true, exponent=6",new CAAT.Behavior.Interpolator().createBounceInInterpolator(false),"BounceIn pingpong=false",new CAAT.Behavior.Interpolator().createBounceOutInterpolator(false),"BounceOut pingpong=false",new CAAT.Behavior.Interpolator().createBounceInOutInterpolator(false),"BounceInOut pingpong=false",new CAAT.Behavior.Interpolator().createBounceInInterpolator(true),"BounceIn pingpong=true",new CAAT.Behavior.Interpolator().createBounceOutInterpolator(true),"BounceOut pingpong=true",new CAAT.Behavior.Interpolator().createBounceInOutInterpolator(true),"BounceInOut pingpong=true",new CAAT.Behavior.Interpolator().createElasticInInterpolator(1.1,0.4,false),"ElasticIn pingpong=false, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1.1,0.4,false),"ElasticOut pingpong=false, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticInOutInterpolator(1.1,0.4,false),"ElasticInOut pingpong=false, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticInInterpolator(1.1,0.4,true),"ElasticIn pingpong=true, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1.1,0.4,true),"ElasticOut pingpong=true, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticInOutInterpolator(1.1,0.4,true),"ElasticInOut pingpong=true, amp=1.1, d=.4",new CAAT.Behavior.Interpolator().createElasticInInterpolator(1,0.2,false),"ElasticIn pingpong=false, amp=1.0, d=.2",new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1,0.2,false),"ElasticOut pingpong=false, amp=1.0, d=.2",new CAAT.Behavior.Interpolator().createElasticInOutInterpolator(1,0.2,false),"ElasticInOut pingpong=false, amp=1.0, d=.2",new CAAT.Behavior.Interpolator().createElasticInInterpolator(1,0.2,true),"ElasticIn pingpong=true, amp=1.0, d=.2",new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1,0.2,true),"ElasticOut pingpong=true, amp=1.0, d=.2",new CAAT.Behavior.Interpolator().createElasticInOutInterpolator(1,0.2,true),"ElasticInOut pingpong=true, amp=1.0, d=.2"]}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){this.interpolated=new CAAT.Math.Point(0,0,0);return this},createLinearInterpolator:function(c,b){this.getPosition=function a(e){var d=e;if(c){if(e<0.5){e*=2}else{e=1-(e-0.5)*2}}if(b!==null&&b){e=1-e}return this.interpolated.set(d,e)};return this},createBackOutInterpolator:function(b){this.getPosition=function a(e){var c=e;if(b){if(e<0.5){e*=2}else{e=1-(e-0.5)*2}}e=e-1;var d=1.70158;return this.interpolated.set(c,e*e*((d+1)*e+d)+1)};return this},createExponentialInInterpolator:function(b,c){this.getPosition=function a(e){var d=e;if(c){if(e<0.5){e*=2}else{e=1-(e-0.5)*2}}return this.interpolated.set(d,Math.pow(e,b))};return this},createExponentialOutInterpolator:function(b,c){this.getPosition=function a(e){var d=e;if(c){if(e<0.5){e*=2}else{e=1-(e-0.5)*2}}return this.interpolated.set(d,1-Math.pow(1-e,b))};return this},createExponentialInOutInterpolator:function(b,c){this.getPosition=function a(e){var d=e;if(c){if(e<0.5){e*=2}else{e=1-(e-0.5)*2}}if(e*2<1){return this.interpolated.set(d,Math.pow(e*2,b)/2)}return this.interpolated.set(d,1-Math.abs(Math.pow(e*2-2,b))/2)};return this},createQuadricBezierInterpolator:function(e,c,b,d){this.getPosition=function a(g){var f=g;if(d){if(g<0.5){g*=2}else{g=1-(g-0.5)*2}}g=(1-g)*(1-g)*e.y+2*(1-g)*g*c.y+g*g*b.y;return this.interpolated.set(f,g)};return this},createCubicBezierInterpolator:function(f,d,c,b,e){this.getPosition=function a(j){var g=j;if(e){if(j<0.5){j*=2}else{j=1-(j-0.5)*2}}var i=j*j;var h=j*i;j=(f.y+j*(-f.y*3+j*(3*f.y-f.y*j)))+j*(3*d.y+j*(-6*d.y+d.y*3*j))+i*(c.y*3-c.y*3*j)+b.y*h;return this.interpolated.set(g,j)};return this},createElasticOutInterpolator:function(a,c,d){this.getPosition=function b(f){if(d){if(f<0.5){f*=2}else{f=1-(f-0.5)*2}}if(f===0){return{x:0,y:0}}if(f===1){return{x:1,y:1}}var e=c/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(f,(a*Math.pow(2,-10*f)*Math.sin((f-e)*(2*Math.PI)/c)+1))};return this},createElasticInInterpolator:function(a,c,d){this.getPosition=function b(f){if(d){if(f<0.5){f*=2}else{f=1-(f-0.5)*2}}if(f===0){return{x:0,y:0}}if(f===1){return{x:1,y:1}}var e=c/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(f,-(a*Math.pow(2,10*(f-=1))*Math.sin((f-e)*(2*Math.PI)/c)))};return this},createElasticInOutInterpolator:function(a,c,d){this.getPosition=function b(f){if(d){if(f<0.5){f*=2}else{f=1-(f-0.5)*2}}var e=c/(2*Math.PI)*Math.asin(1/a);f*=2;if(f<=1){return this.interpolated.set(f,-0.5*(a*Math.pow(2,10*(f-=1))*Math.sin((f-e)*(2*Math.PI)/c)))}return this.interpolated.set(f,1+0.5*(a*Math.pow(2,-10*(f-=1))*Math.sin((f-e)*(2*Math.PI)/c)))};return this},bounce:function(a){if((a/=1)<(1/2.75)){return{x:a,y:7.5625*a*a}}else{if(a<(2/2.75)){return{x:a,y:7.5625*(a-=(1.5/2.75))*a+0.75}}else{if(a<(2.5/2.75)){return{x:a,y:7.5625*(a-=(2.25/2.75))*a+0.9375}}else{return{x:a,y:7.5625*(a-=(2.625/2.75))*a+0.984375}}}}},createBounceOutInterpolator:function(b){this.getPosition=function a(c){if(b){if(c<0.5){c*=2}else{c=1-(c-0.5)*2}}return this.bounce(c)};return this},createBounceInInterpolator:function(b){this.getPosition=function a(d){if(b){if(d<0.5){d*=2}else{d=1-(d-0.5)*2}}var c=this.bounce(1-d);c.y=1-c.y;return c};return this},createBounceInOutInterpolator:function(b){this.getPosition=function a(d){if(b){if(d<0.5){d*=2}else{d=1-(d-0.5)*2}}var c;if(d<0.5){c=this.bounce(1-d*2);c.y=(1-c.y)*0.5;return c}c=this.bounce(d*2-1,b);c.y=c.y*0.5+0.5;return c};return this},paint:function(a){a.save();a.beginPath();a.moveTo(0,this.getPosition(0).y*this.paintScale);for(var b=0;b<=this.paintScale;b++){a.lineTo(b,this.getPosition(b/this.paintScale).y*this.paintScale)}a.strokeStyle="black";a.stroke();a.restore()},getContour:function(c){var b=[];for(var a=0;a<=c;a++){b.push({x:a/c,y:this.getPosition(a/c).y})}return b}}}});CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var a=new CAAT.Behavior.Interpolator().createLinearInterpolator(false);var b=new CAAT.Behavior.Interpolator().createLinearInterpolator(true);return{__init:function(){this.lifecycleListenerList=[];this.setDefaultInterpolator();return this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:false,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:true,solved:true,discardable:false,setValueApplication:function(c){this.doValueApplication=c;return this},setTimeOffset:function(c){this.timeOffset=c;return this},setStatus:function(c){this.status=c;return this},setId:function(c){this.id=c;return this},setDefaultInterpolator:function(){this.interpolator=a;return this},setPingPong:function(){this.interpolator=b;return this},setFrameTime:function(c,d){this.behaviorStartTime=c;this.behaviorDuration=d;this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED;return this},setDelayTime:function(c,d){this.behaviorStartTime=c;this.behaviorDuration=d;this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED;this.solved=false;this.expired=false;return this},setOutOfFrameTime:function(){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED;this.behaviorStartTime=Number.MAX_VALUE;this.behaviorDuration=0;return this},setInterpolator:function(c){this.interpolator=c;return this},apply:function(e,d){if(!this.solved){this.behaviorStartTime+=e;this.solved=true}e+=this.timeOffset*this.behaviorDuration;var c=e;if(this.isBehaviorInTime(e,d)){e=this.normalizeTime(e);this.fireBehaviorAppliedEvent(d,c,e,this.setForTime(e,d))}},setCycle:function(c){this.cycleBehavior=c;return this},addListener:function(c){this.lifecycleListenerList.push(c);return this},emptyListenerList:function(){this.lifecycleListenerList=[];return this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(e,d){var c=CAAT.Behavior.BaseBehavior.Status;if(this.status===c.EXPIRED||this.behaviorStartTime<0){return false}if(this.cycleBehavior){if(e>=this.behaviorStartTime){e=(e-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime}}if(e>this.behaviorStartTime+this.behaviorDuration){if(this.status!==c.EXPIRED){this.setExpired(d,e)}return false}if(this.status===c.NOT_STARTED){this.status=c.STARTED;this.fireBehaviorStartedEvent(d,e)}return this.behaviorStartTime<=e},fireBehaviorStartedEvent:function(f,g){for(var e=0,d=this.lifecycleListenerList.length;e<d;e++){var c=this.lifecycleListenerList[e];if(c.behaviorStarted){c.behaviorStarted(this,g,f)}}},fireBehaviorExpiredEvent:function(f,g){for(var e=0,d=this.lifecycleListenerList.length;e<d;e++){var c=this.lifecycleListenerList[e];if(c.behaviorExpired){c.behaviorExpired(this,g,f)}}},fireBehaviorAppliedEvent:function(g,j,d,h){for(var f=0,e=this.lifecycleListenerList.length;f<e;f++){var c=this.lifecycleListenerList[f];if(c.behaviorApplied){c.behaviorApplied(this,j,d,g,h)}}},normalizeTime:function(c){c=c-this.behaviorStartTime;if(this.cycleBehavior){c%=this.behaviorDuration}return this.interpolator.getPosition(c/this.behaviorDuration).y},setExpired:function(c,d){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED;this.setForTime(this.interpolator.getPosition(1).y,c);this.fireBehaviorExpiredEvent(c,d);if(this.discardable){this.actor.removeBehavior(this)}},setForTime:function(d,c){},initialize:function(d){if(d){for(var c in d){this[c]=d[c]}}return this},getPropertyName:function(){return""}}}});CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,getPropertyName:function(){return"opacity"},setForTime:function(c,a){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,c,a);var b=(this.startAlpha+c*(this.endAlpha-this.startAlpha));if(this.doValueApplication){a.setAlpha(b)}return b},setValues:function(b,a){this.startAlpha=b;this.endAlpha=a;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return(this.startAlpha+a*(this.endAlpha-this.startAlpha))},calculateKeyFramesData:function(f,c,b){if(typeof b==="undefined"){b=100}b>>=0;var d;var a;var e="@-"+f+"-keyframes "+c+" {";for(d=0;d<=b;d++){a=""+(d/b*100)+"%{opacity: "+this.calculateKeyFrameData(d/b)+"}";e+=a}e+="}";return e}}}});CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{behaviors:null,__init:function(){this.__super();this.behaviors=[];return this},conformToDuration:function(d){this.duration=d;var c=d/this.duration;var a;for(var b=0;b<this.behaviors.length;b++){a=this.behaviors[b];a.setFrameTime(a.getStartTime()*c,a.getDuration()*c)}return this},getBehaviorById:function(b){for(var a=0;a<this.behaviors.length;a++){if(this.behaviors[a].id===b){return this.behaviors[a]}}return null},addBehavior:function(a){this.behaviors.push(a);a.addListener(this);return this},apply:function(d,c){if(!this.solved){this.behaviorStartTime+=d;this.solved=true}d+=this.timeOffset*this.behaviorDuration;if(this.isBehaviorInTime(d,c)){d-=this.getStartTime();if(this.cycleBehavior){d%=this.getDuration()}var a=this.behaviors;for(var b=0;b<a.length;b++){a[b].apply(d,c)}}},behaviorExpired:function(b,c,a){if(this.cycleBehavior){b.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)}},setForTime:function(d,c){var a=this.behaviors;for(var b=0;b<a.length;b++){a[b].setForTime(d,c)}return null},setExpired:function(c,d){var a=this.behaviors;for(var b=0;b<a.length;b++){var e=a[b];if(e.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED){e.setExpired(c,d-this.behaviorStartTime)}}CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,c,d);return this},setFrameTime:function(d,c){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,d,c);var a=this.behaviors;for(var b=0;b<a.length;b++){a[b].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED)}return this},setDelayTime:function(d,c){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,d,c);var a=this.behaviors;for(var b=0;b<a.length;b++){a[b].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED)}return this},calculateKeyFrameData:function(k,h,b){var g;var e;var f={};var c;var j;var n;var o;for(g=0;g<this.behaviors.length;g++){e=this.behaviors[g];if(e.status!==CAAT.Behavior.BehaviorConstants.Status.EXPIRED&&!(e instanceof CAAT.Behavior.GenericBehavior)){c=k*this.behaviorDuration;if(e.behaviorStartTime<=c&&e.behaviorStartTime+e.behaviorDuration>=c){c=(c-e.behaviorStartTime)/e.behaviorDuration;j=e.calculateKeyFrameData(c);n=e.getPropertyName(h);if(typeof f[n]==="undefined"){f[n]=""}f[n]+=j+" "}}}var m="";var p;function a(i){if(f[i]){m+=f[i]}else{if(b){p=b[i];if(p){m+=p;f[i]=p}}}}a("translate");a("rotate");a("scale");var d="";if(m){d="-"+h+"-transform: "+m+";"}m="";a("opacity");if(m){d+=" opacity: "+m+";"}return{rules:d,ret:f}},calculateKeyFramesData:function(g,a,b){if(this.duration===Number.MAX_VALUE){return""}if(typeof b==="undefined"){b=100}var f;var c=null;var e="@-"+g+"-keyframes "+a+" {";var h;var d;var j;for(f=0;f<=b;f++){d=this.interpolator.getPosition(f/b).y;h=this.calculateKeyFrameData(d,g,c);j=""+(f/b*100)+"%{"+h.rules+"}\n";c=h.ret;e+=j}e+="}";return e}}}});CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(c,a){var b=this.start+c*(this.end-this.start);if(this.callback){this.callback(b,this.target,a)}if(this.property){this.target[this.property]=b}},setValues:function(e,a,c,b,d){this.start=e;this.end=a;this.target=c;this.property=b;this.callback=d;return this}}}});CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{path:null,autoRotate:false,prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,getPropertyName:function(){return"translate"},setAutoRotate:function(b,a){this.autoRotate=b;if(a!==undefined){this.autoRotateOp=a}return this},setPath:function(a){this.path=a;return this},setValues:function(a){return this.setPath(a)},setTranslation:function(b,a){return this},calculateKeyFrameData:function(b){b=this.interpolator.getPosition(b).y;var a=this.path.getPosition(b);return"translateX("+a.x+"px) translateY("+a.y+"px)"},calculateKeyFramesData:function(f,c,b){if(typeof b==="undefined"){b=100}b>>=0;var d;var a;var g;var e="@-"+f+"-keyframes "+c+" {";for(d=0;d<=b;d++){a=""+(d/b*100)+"%{-"+f+"-transform:"+this.calculateKeyFrameData(d/b)+"}";e+=a}e+="}";return e},setForTime:function(c,e){if(!this.path){return{x:e.x,y:e.y}}var h=this.path.getPosition(c);if(this.autoRotate){if(-1===this.prevX&&-1===this.prevY){this.prevX=h.x;this.prevY=h.y}var a=h.x-this.prevX;var i=h.y-this.prevY;if(a===0&&i===0){e.setLocation(h.x,h.y);return{x:e.x,y:e.y}}var d=Math.atan2(i,a);var f=CAAT.Foundation.SpriteImage;var b=CAAT.Behavior.PathBehavior.autorotate;if(this.autoRotateOp===b.LEFT_TO_RIGHT){if(this.prevX<=h.x){e.setImageTransformation(f.TR_NONE)}else{e.setImageTransformation(f.TR_FLIP_HORIZONTAL);d+=Math.PI}}else{if(this.autoRotateOp===b.RIGHT_TO_LEFT){if(this.prevX<=h.x){e.setImageTransformation(f.TR_FLIP_HORIZONTAL)}else{e.setImageTransformation(f.TR_NONE);d-=Math.PI}}}e.setRotation(d);this.prevX=h.x;this.prevY=h.y;var g=Math.sqrt(a*a+i*i);a/=g;i/=g}if(this.doValueApplication){e.setLocation(h.x,h.y);return{x:e.x,y:e.y}}else{return{x:h.x,y:h.y}}},positionOnTime:function(a){if(this.isBehaviorInTime(a,null)){a=this.normalizeTime(a);return this.path.getPosition(a)}return{x:-1,y:-1}}}}});CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},startAngle:0,endAngle:0,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"rotate"},setForTime:function(b,a){var c=this.startAngle+b*(this.endAngle-this.startAngle);if(this.doValueApplication){a.setRotationAnchored(c,this.anchorX,this.anchorY)}return c},setValues:function(d,c,b,a){this.startAngle=d;this.endAngle=c;if(typeof b!=="undefined"&&typeof a!=="undefined"){this.anchorX=b;this.anchorY=a}return this},setAngles:function(b,a){return this.setValues(b,a)},setAnchor:function(a,c,b){this.anchorX=c/a.width;this.anchorY=b/a.height;return this},calculateKeyFrameData:function(a){a=this.interpolator.getPosition(a).y;return"rotate("+(this.startAngle+a*(this.endAngle-this.startAngle))+"rad)"},calculateKeyFramesData:function(f,c,b){if(typeof b==="undefined"){b=100}b>>=0;var d;var a;var e="@-"+f+"-keyframes "+c+" {";for(d=0;d<=b;d++){a=""+(d/b*100)+"%{-"+f+"-transform:"+this.calculateKeyFrameData(d/b)+"}\n";e+=a}e+="}";return e}}}});CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},startScale:1,endScale:1,anchorX:0.5,anchorY:0.5,sx:1,sy:1,applyOnX:true,applyOnAxis:function(a){if(a===CAAT.Behavior.Scale1Behavior.Axis.X){this.applyOnX=false}else{this.applyOnX=true}},getPropertyName:function(){return"scale"},setForTime:function(b,a){var c=this.startScale+b*(this.endScale-this.startScale);if(0===c){c=0.01}if(this.doValueApplication){if(this.applyOnX){a.setScaleAnchored(c,a.scaleY,this.anchorX,this.anchorY)}else{a.setScaleAnchored(a.scaleX,c,this.anchorX,this.anchorY)}}return c},setValues:function(e,c,d,b,a){this.startScale=e;this.endScale=c;this.applyOnX=!!d;if(typeof b!=="undefined"&&typeof a!=="undefined"){this.anchorX=b;this.anchorY=a}return this},setAnchor:function(b,a,c){this.anchorX=a/b.width;this.anchorY=c/b.height;return this},calculateKeyFrameData:function(a){var b;a=this.interpolator.getPosition(a).y;b=this.startScale+a*(this.endScale-this.startScale);return this.applyOnX?"scaleX("+b+")":"scaleY("+b+")"},calculateKeyFramesData:function(f,c,b){if(typeof b==="undefined"){b=100}b>>=0;var d;var a;var e="@-"+f+"-keyframes "+c+" {";for(d=0;d<=b;d++){a=""+(d/b*100)+"%{-"+f+"-transform:"+this.calculateKeyFrameData(d/b)+"}";e+=a}e+="}";return e}}}});CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){this.__super();this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER;return this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:0.5,anchorY:0.5,getPropertyName:function(){return"scale"},setForTime:function(d,c){var b=this.startScaleX+d*(this.endScaleX-this.startScaleX);var a=this.startScaleY+d*(this.endScaleY-this.startScaleY);if(0===b){b=0.01}if(0===a){a=0.01}if(this.doValueApplication){c.setScaleAnchored(b,a,this.anchorX,this.anchorY)}return{scaleX:b,scaleY:a}},setValues:function(d,f,b,e,c,a){this.startScaleX=d;this.endScaleX=f;this.startScaleY=b;this.endScaleY=e;if(typeof c!=="undefined"&&typeof a!=="undefined"){this.anchorX=c;this.anchorY=a}return this},setAnchor:function(b,a,c){this.anchorX=a/b.width;this.anchorY=c/b.height;return this},calculateKeyFrameData:function(c){var b;var a;c=this.interpolator.getPosition(c).y;b=this.startScaleX+c*(this.endScaleX-this.startScaleX);a=this.startScaleY+c*(this.endScaleY-this.startScaleY);return"scaleX("+b+") scaleY("+a+")"},calculateKeyFramesData:function(f,c,b){if(typeof b==="undefined"){b=100}b>>=0;var d;var a;var e="@-"+f+"-keyframes "+c+" {";for(d=0;d<=b;d++){a=""+(d/b*100)+"%{-"+f+"-transform:"+this.calculateKeyFrameData(d/b)+"}";e+=a}e+="}";return e}}}});CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function e(n){for(var j=0;j<n.length;j++){var k=n[j].string;var m=n[j].prop;this.versionSearchString=n[j].versionSearch||n[j].identity;if(k){if(k.indexOf(n[j].subString)!==-1){return n[j].identity}}else{if(m){return n[j].identity}}}}function a(j){var i=j.indexOf(this.versionSearchString);if(i===-1){return}return parseFloat(j.substring(i+this.versionSearchString.length+1))}var h=[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];var g=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];var d=e(h)||"An unknown browser";var b=a(navigator.userAgent)||a(navigator.appVersion)||"an unknown version";var f=e(g)||"an unknown OS";var c=window.devicePixelRatio||1;return{browser:d,version:b,OS:f,DevicePixelRatio:c}}});CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",depends:["CAAT.Module.Runtime.BrowserInfo"],extendsWith:function(){return{__init:function(){this.browserInfo=CAAT.Module.Runtime.BrowserInfo;return this},musicChannel:null,browserInfo:null,musicEnabled:true,fxEnabled:true,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioTypes:{mp3:"audio/mpeg;",ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',mp4:'audio/mp4; codecs="mp4a.40.2"'},initialize:function(b){this.audioCache=[];this.channels=[];this.workingChannels=[];for(var a=0;a<=b;a++){var d=document.createElement("audio");if(null!==d){d.finished=-1;this.channels.push(d);var c=this;CAAT.bindEvent(d,"ended",function(f){var g=f.target;var e;for(e=0;e<c.workingChannels.length;e++){if(c.workingChannels[e]===g){c.workingChannels.splice(e,1);break}}if(g.caat_callback){g.caat_callback(g.caat_id)}c.channels.push(g)},false)}}this.musicChannel=this.channels.pop();return this},addAudioFromURL:function(f,a,d){var e=null;var c=document.createElement("audio");if(null!==c){if(!c.canPlayType){return false}e=a.substr(a.lastIndexOf(".")+1);var b=c.canPlayType(this.audioTypes[e]);if(b!==""&&b!=="no"){c.src=a;c.preload="auto";c.load();if(d){c.caat_callback=d;c.caat_id=f}this.audioCache.push({id:f,audio:c});return true}}return false},addAudioFromDomNode:function(d,a,b){var c=a.src.substr(a.src.lastIndexOf(".")+1);if(a.canPlayType(this.audioTypes[c])){if(b){a.caat_callback=b;a.caat_id=d}this.audioCache.push({id:d,audio:a});return true}return false},addAudioElement:function(d,a,b){if(typeof a==="string"){return this.addAudioFromURL(d,a,b)}else{try{if(a instanceof HTMLAudioElement){return this.addAudioFromDomNode(d,a,b)}}catch(c){}}return false},addAudio:function(d,b,c){if(b instanceof Array){for(var a=0;a<b.length;a++){if(this.addAudioElement(d,b[a],c)){break}}}else{this.addAudioElement(d,b,c)}return this},getAudio:function(b){for(var a=0;a<this.audioCache.length;a++){if(this.audioCache[a].id===b){return this.audioCache[a].audio}}return null},stopMusic:function(){this.musicChannel.pause()},playMusic:function(c){if(!this.musicEnabled){return this}var a=this.getAudio(c);if(null!==a){var b=this.musicChannel;if(null!==b){b.src=a.src;b.preload="auto";if(this.browserInfo.browser==="Firefox"){CAAT.bindEvent(b,"ended",function(d){var e=d.target;e.currentTime=0},false)}else{b.loop=true}b.load();b.play();return b}}},setVolume:function(c,b){var a=this.getAudio(c);if(null!=a){a.volume=b}return this},play:function(c){if(!this.fxEnabled){return this}var b=this.getAudio(c);if(null!==b&&this.channels.length>0){var a=this.channels.shift();a.src=b.src;a.load();a.volume=b.volume;a.play();this.workingChannels.push(a)}return this},loop:function(c){if(!this.musicEnabled){return this}var a=this.getAudio(c);if(null!==a){var b=document.createElement("audio");if(null!==b){b.src=a.src;b.preload="auto";if(this.browserInfo.browser==="Firefox"){CAAT.bindEvent(b,"ended",function(d){var e=d.target;e.currentTime=0;e.play()},false)}else{b.loop=true}b.load();b.play();this.loopingChannels.push(b);return b}}return null},endSound:function(){var a;for(a=0;a<this.workingChannels.length;a++){this.workingChannels[a].pause();this.channels.push(this.workingChannels[a])}for(a=0;a<this.loopingChannels.length;a++){this.loopingChannels[a].pause()}this.stopMusic();return this},setSoundEffectsEnabled:function(a){this.fxEnabled=a;for(var b=0;b<this.loopingChannels.length;b++){if(a){this.loopingChannels[b].play()}else{this.loopingChannels[b].pause()}}return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(a){this.musicEnabled=a;this.stopMusic();return this},isMusicEnabled:function(){return this.musicEnabled}}}});CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(a,b){try{localStorage.setItem(a,JSON.stringify(b))}catch(c){}return this},load:function(b,c){try{var a=localStorage.getItem(b);return null===a?c:JSON.parse(a)}catch(d){return null}},remove:function(a){try{localStorage.removeItem(a)}catch(b){}return this}},extendsWith:{}});CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(j,w,o){var a,k,n,e,m,d,c,u;j=Math.max(0,Math.min(360,j));w=Math.max(0,Math.min(100,w));o=Math.max(0,Math.min(100,o));w/=100;o/=100;if(w===0){a=k=n=o;return[Math.round(a*255),Math.round(k*255),Math.round(n*255)]}j/=60;e=Math.floor(j);m=j-e;d=o*(1-w);c=o*(1-w*m);u=o*(1-w*(1-m));switch(e){case 0:a=o;k=u;n=d;break;case 1:a=c;k=o;n=d;break;case 2:a=d;k=o;n=u;break;case 3:a=d;k=c;n=o;break;case 4:a=u;k=d;n=o;break;default:a=o;k=d;n=c}return new CAAT.Module.ColorUtil.Color(Math.round(a*255),Math.round(k*255),Math.round(n*255))},interpolate:function(h,d,n,f,c,m,i,e){var a,j,k;if(e<=0){return{r:h,g:d,b:n}}else{if(e>=i){return{r:f,g:c,b:m}}}a=(h+(f-h)/i*e)>>0;j=(d+(c-d)/i*e)>>0;k=(n+(m-n)/i*e)>>0;if(a>255){a=255}else{if(a<0){a=0}}if(j>255){j=255}else{if(j<0){j=0}}if(k>255){k=255}else{if(k<0){k=0}}return{r:a,g:j,b:k}},makeRGBColorRamp:function(q,o,A){var k=[],h=q.length-1,p=o/h,w,u,n,b,e,m,z,E,x,d,g,t,D,v,a,f,C,r,y,B;for(w=0;w<h;w+=1){z=q[w];E=(z>>24)&255;x=(z&16711680)>>16;d=(z&65280)>>8;g=z&255;t=q[w+1];D=(t>>24)&255;v=(t&16711680)>>16;a=(t&65280)>>8;f=t&255;C=(D-E)/p;r=(v-x)/p;y=(a-d)/p;B=(f-g)/p;for(u=0;u<p;u+=1){n=(E+C*u)>>0;b=(x+r*u)>>0;e=(d+y*u)>>0;m=(g+B*u)>>0;var s=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(A){case s.RAMP_RGBA:k.push("argb("+n+","+b+","+e+","+m+")");break;case s.RAMP_RGB:k.push("rgb("+b+","+e+","+m+")");break;case s.RAMP_CHANNEL_RGB:k.push(4278190080|b<<16|e<<8|m);break;case s.RAMP_CHANNEL_RGBA:k.push(n<<24|b<<16|e<<8|m);break;case s.RAMP_CHANNEL_RGBA_ARRAY:k.push([b,e,m,n]);break;case s.RAMP_CHANNEL_RGB_ARRAY:k.push([b,e,m]);break}}}return k},random:function(){var b="0123456789abcdef";var e="#";for(var d=0;d<3;d++){e+=b[(Math.random()*b.length)>>0]}return e}},extendsWith:{__init:function(d,c,a){this.r=d||255;this.g=c||255;this.b=a||255;return this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}});CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:false,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',setScale:function(a){this.scale=a;return this},initialize:function(w,h){w=window.innerWidth;this.width=w;this.height=h;this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1000,fpsMax:0};var debugContainer=document.getElementById("caat-debug");if(!debugContainer){var wrap=document.createElement("div");wrap.innerHTML=this.debugTpl;document.body.appendChild(wrap);eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    CAAT.bindEvent(elem, "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        CAAT.bindEvent(elem, "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')}this.canvas=document.getElementById("caat-debug-canvas");if(null===this.canvas){this.canDebug=false;return}this.canvas.width=w;this.canvas.height=h;this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,this.width,this.height);this.textFPS=document.getElementById("textFPS");this.textDrawTime=document.getElementById("textDrawTime");this.textRAFTime=document.getElementById("textRAFTime");this.textEntitiesTotal=document.getElementById("textEntitiesTotal");this.textEntitiesActive=document.getElementById("textEntitiesActive");this.textDraws=document.getElementById("textDraws");this.textDirtyRects=document.getElementById("textDirtyRects");this.textDiscardDR=document.getElementById("textDiscardDR");this.canDebug=true;return this},debugInfo:function(c){this.statistics=c;var d=CAAT;this.frameTimeAcc+=d.FRAME_TIME;this.frameRAFAcc+=d.REQUEST_ANIMATION_FRAME_TIME;this.framerate.frames++;if(d.RAF>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=((this.framerate.frames*1000)/(d.RAF-this.framerate.timeLastRefresh))|0;this.framerate.fpsMin=this.framerate.frames>0?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin;this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps);this.textFPS.innerHTML=this.framerate.fps;var b=((this.frameTimeAcc*100/this.framerate.frames)|0)/100;this.frameTimeAcc=0;this.textDrawTime.innerHTML=b;var a=((this.frameRAFAcc*100/this.framerate.frames)|0)/100;this.frameRAFAcc=0;this.textRAFTime.innerHTML=a;this.framerate.timeLastRefresh=d.RAF;this.framerate.frames=0;this.paint(a)}this.textEntitiesTotal.innerHTML=this.statistics.size_total;this.textEntitiesActive.innerHTML=this.statistics.size_active;this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects;this.textDraws.innerHTML=this.statistics.draws;this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(b){var a=this.ctx;var c=0;a.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height);a.strokeStyle="black";a.beginPath();a.moveTo(this.width-0.5,0);a.lineTo(this.width-0.5,this.height);a.stroke();a.strokeStyle="#a22";a.beginPath();c=this.height-((20/this.SCALE*this.height)>>0)-0.5;a.moveTo(0.5,c);a.lineTo(this.width+0.5,c);a.stroke();a.strokeStyle="#aa2";a.beginPath();c=this.height-((30/this.SCALE*this.height)>>0)-0.5;a.moveTo(0.5,c);a.lineTo(this.width+0.5,c);a.stroke();var e=Math.min(this.height-(this.framerate.fps/this.SCALE*this.height),59);if(-1===this.framerate.prevFps){this.framerate.prevFps=e|0}a.strokeStyle="#0ff";a.beginPath();a.moveTo(this.width,(e|0)-0.5);a.lineTo(this.width,this.framerate.prevFps-0.5);a.stroke();this.framerate.prevFps=e;var d=((this.height-(b/this.SCALE*this.height))>>0)-0.5;a.strokeStyle="#ff0";a.beginPath();a.moveTo(this.width,d);a.lineTo(this.width,d);a.stroke()}}});CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(a){var b;if(CAAT.CSS_TEXT_METRICS){try{b=CAAT.Module.Font.Font.getFontMetricsCSS(a);return b}catch(c){}}return CAAT.Module.Font.Font.getFontMetricsNoCSS(a)},getFontMetricsNoCSS:function(b){var e=/(\d+)p[x|t]/i;var c=e.exec(b);var a;if(!c){a=32}else{a=c[1]|0}var f=a-1;var d=(a+a*0.2)|0;return{height:d,ascent:f,descent:d-f}},getFontMetricsCSS:function(c){function h(m){var p,j,q,r,o,s,e,n,t,k;var u=m&&m.ownerDocument;j=u.documentElement;p=m.getBoundingClientRect();q=document.body;r=u.nodeType===9?u.defaultView||u.parentWindow:false;o=j.clientTop||q.clientTop||0;s=j.clientLeft||q.clientLeft||0;e=r.pageYOffset||j.scrollTop;n=r.pageXOffset||j.scrollLeft;t=p.top+e-o;k=p.left+n-s;return{top:t,left:k}}try{var g=document.createElement("span");g.style.font=c;g.innerHTML="Hg";var f=document.createElement("div");f.style.display="inline-block";f.style.width="1px";f.style.heigh="0px";var i=document.createElement("div");i.appendChild(g);i.appendChild(f);var b=document.body;b.appendChild(i);try{var a={};f.style.verticalAlign="baseline";a.ascent=h(f).top-h(g).top;f.style.verticalAlign="bottom";a.height=h(f).top-h(g).top;a.ascent=Math.ceil(a.ascent);a.height=Math.ceil(a.height);a.descent=a.height-a.ascent;return a}finally{b.removeChild(i)}}catch(d){return null}}},extendsWith:function(){var a=10;return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,ascent:0,descent:0,setPadding:function(b){this.padding=b;return this},setFontStyle:function(b){this.fontStyle=b;return this},setStrokeSize:function(b){this.strokeSize=b;return this},setFontSize:function(b){this.fontSize=b;this.fontSizeUnit="px";return this},setFont:function(b){this.font=b;return this},setFillStyle:function(b){this.fillStyle=b;return this},setStrokeStyle:function(b){this.strokeStyle=b;return this},createDefault:function(c){var d="";for(var b=32;b<128;b++){d=d+String.fromCharCode(b)}return this.create(d,c)},create:function(n,o){o=o|0;this.padding=o;var d=document.createElement("canvas");var q=d.getContext("2d");q.textBaseline="bottom";q.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;var m=0;var k=[];var f;var p;var h;for(f=0;f<n.length;f++){var e=Math.max(1,(q.measureText(n.charAt(f)).width>>0)+1)+2*o;k.push(e);m+=e}var c=CAAT.Font.getFontMetrics(q.font);var j="alphabetic",b,g;g=c.height;this.ascent=c.ascent;this.descent=c.descent;this.height=c.height;b=c.ascent;d.width=m;d.height=g;q=d.getContext("2d");q.textBaseline=j;q.font=this.fontStyle+" "+this.fontSize+""+this.fontSizeUnit+" "+this.font;q.fillStyle=this.fillStyle;q.strokeStyle=this.strokeStyle;this.charMap={};p=0;for(f=0;f<n.length;f++){h=n.charAt(f);q.fillText(h,p+o,b);if(this.strokeStyle){q.beginPath();q.lineWidth=this.strokeSize;q.strokeText(h,p+o,b)}this.charMap[h]={x:p+o,width:k[f]-2*o};p+=k[f]}this.image=d;return this},setAsSpriteImage:function(){var b=[];var f=0;for(var e in this.charMap){var d=e;var c=this.charMap[e];b[e]={id:f++,height:this.height,xoffset:0,letter:d,yoffset:0,width:c.width,xadvance:c.width,x:c.x,y:0}}this.spriteImage=new CAAT.Foundation.SpriteImage().initializeAsGlyphDesigner(this.image,b);return this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(f){var e,d,b=0,g;for(e=0,d=f.length;e<d;e++){g=this.charMap[f.charAt(e)];if(g){b+=g.width}else{b+=a}}return b},drawText:function(d,j,f,e){var c,b,k,g;var h=this.image.height;for(c=0,b=d.length;c<b;c++){k=this.charMap[d.charAt(c)];if(k){g=k.width;j.drawImage(this.image,k.x,0,g,h,f,e,g,h);f+=g}else{j.strokeStyle="#f00";j.strokeRect(f,e,a,h);f+=a}}},save:function(){var c="image/png";var b=this.image.toDataURL(c);document.location.href=b.replace(c,"image/octet-stream")},drawSpriteText:function(b,c){this.spriteImage.drawSpriteText(b,c)}}}});CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE;this.position=new CAAT.Math.Point(0,0,0);this.offset=new CAAT.Math.Point(0,0,0);this.targetPosition=new CAAT.Math.Point(0,0,0);return this},id:0,delegate:null,position:null,offset:null,targetPosition:null,targetChaseSpeed:0.02,isFixed:false,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(b){var a=this.position.getDistanceSquared(b);return a<this.radiusSquared},getDistanceSquaredFromPosition:function(a){var b=this.position.getDistanceSquared(a);return b<this.radiusSquared},intersects:function(a){var b=this.position.getDistanceSquared(a.position);return(b<this.radiusSquared||b<a.radiusSquared)},setPosition:function(a){this.position=a;return this},setDelegate:function(a){this.delegate=a;return this},setOffset:function(a){this.offset=a;return this},setTargetPosition:function(a){this.targetPosition=a;return this},setTargetChaseSpeed:function(a){this.targetChaseSpeed=a;return this},setIsFixed:function(a){this.isFixed=a;return this},setCollisionMask:function(a){this.collisionMask=a;return this},setCollisionGroup:function(a){this.collisionGroup=a;return this},setRadius:function(a){this.radius=a;this.radiusSquared=this.radius*this.radius;return this},initialize:function(b){if(b){for(var a in b){this[a]=b[a]}}return this},dealloc:function(){this.position=null;this.offset=null;this.delegate=null;this.targetPosition=null}}});CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle()},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(a){a.id=this.allCircles.length;this.allCircles.push(a);return this},removeCircle:function(c){var b=0,d=false,a=this.allCircles.length;if(a===0){throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!"}while(a--){if(this.allCircles[a]===c){d=true;b=a;break}}if(!d){throw"Could not locate circle in allCircles array!"}this.allCircles[b].dealloc();this.allCircles[b]=null;return this},forceCirclesToMatchDelegatePositions:function(){var a=this.allCircles.length;for(var c=0;c<a;c++){var b=this.allCircles[c];if(!b||!b.delegate){continue}b.position.set(b.delegate.x+b.offset.x,b.delegate.y+b.offset.y)}},pushAllCirclesTowardTarget:function(f){var d=new CAAT.Math.Point(0,0,0),b=this.allCircles,a=b.length;for(var h=0;h<this.numberOfTargetingPasses;h++){for(var e=0;e<a;e++){var g=b[e];if(g.isFixed){continue}d.x=g.position.x-(g.targetPosition.x+g.offset.x);d.y=g.position.y-(g.targetPosition.y+g.offset.y);d.multiply(g.targetChaseSpeed);g.position.x-=d.x;g.position.y-=d.y}}},handleCollisions:function(){this.removeExpiredElements();var m=new CAAT.Math.Point(0,0,0),k=this.allCircles,g=k.length;for(var c=0;c<this.numberOfCollisionPasses;c++){for(var f=0;f<g;f++){var s=k[f];for(var e=f+1;e<g;e++){var p=k[e];if(!this.circlesCanCollide(s,p)){continue}var q=p.position.x-s.position.x,o=p.position.y-s.position.y;var b=(s.radius+p.radius)*1.08,h=s.position.getDistanceSquared(p.position);if(h<(b*b)-0.02){m.x=q;m.y=o;m.normalize();var a=(b-Math.sqrt(h))*0.5;m.multiply(a);if(!p.isFixed){if(s.isFixed){m.multiply(2.2)}p.position.translatePoint(m)}if(!s.isFixed){if(p.isFixed){m.multiply(2.2)}s.position.subtract(m)}}}}}},handleBoundaryForCircle:function(j,i){var b=j.position.x;var a=j.position.y;var g=j.radius;var k=g*2;var f=1<<0;var c=1<<2;var h=1<<3;var e=1<<4;var d=1<<5;i=c|h;if(i&f&&b-k>this.bounds.right){j.position.x=this.bounds.left+g}else{if(i&f&&b+k<this.bounds.left){j.position.x=this.bounds.right-g}}if(i&c&&a-k>this.bounds.bottom){j.position.y=this.bounds.top-g}else{if(i&c&&a+k<this.bounds.top){j.position.y=this.bounds.bottom+g}}if(i&h&&b+g>=this.bounds.right){j.position.x=j.position.x=this.bounds.right-g}else{if(i&h&&b-g<this.bounds.left){j.position.x=this.bounds.left+g}}if(i&e&&a+g>this.bounds.bottom){j.position.y=this.bounds.bottom-g}else{if(i&e&&a-g<this.bounds.top){j.position.y=this.bounds.top+g}}},getCircleAt:function(e,b,c){var g=this.allCircles;var f=g.length;var j=new CAAT.Math.Point(e,b,0);var h=null;var m=Number.MAX_VALUE;for(var d=0;d<f;d++){var k=g[d];if(!k){continue}var a=k.position.getDistanceSquared(j);if(a<m&&a<k.radiusSquared+c){m=a;h=k}}return h},circlesCanCollide:function(b,a){if(!b||!a||b===a){return false}return true},setBounds:function(a,d,b,c){this.bounds.x=a;this.bounds.y=d;this.bounds.width=b;this.bounds.height=c},setNumberOfCollisionPasses:function(a){this.numberOfCollisionPasses=a;return this},setNumberOfTargetingPasses:function(a){this.numberOfTargetingPasses=a;return this},sortOnDistanceToTarget:function(c,b){var e=c.getDistanceSquaredFromPosition(c.targetPosition);var d=b.getDistanceSquaredFromPosition(c.targetPosition);var a=0;if(e>d){a=-1}else{if(e<d){a=1}}return a},removeExpiredElements:function(){for(var a=this.allCircles.length;a>=0;a--){if(this.allCircles[a]===null){this.allCircles.splice(a,1)}}},initialize:function(b){if(b){for(var a in b){this[a]=b[a]}}return this}}});CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var a=function(e,d,b){var c=this;this.id=e;this.path=d;this.image=new Image();this.image.onload=function(){b.__onload(c)};this.image.onerror=function(f){b.__onerror(c)};this.load=function(){c.image.src=c.path};return this};return{__init:function(){this.elements=[];return this},elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,addElement:function(c,b){this.elements.push(new a(c,b,this));return this},__onload:function(b){if(this.cloaded){this.cloaded(b.id)}this.loadedCount++;if(this.loadedCount===this.elements.length){if(this.cfinished){this.cfinished(this.elements)}}},__onerror:function(b){if(this.cerrored){this.cerrored(b.id)}},load:function(c,e,b){this.cfinished=c;this.cloaded=e;this.cerroed=b;var d;for(d=0;d<this.elements.length;d++){this.elements[d].load()}return this}}}});CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){this.images=[];return this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(f,d,b){if(!f){if(d){d(0,[])}}var e=this,c;this.notificationCallback=d;this.images=[];for(c=0;c<f.length;c++){this.images.push({id:f[c].id,image:new Image()})}for(c=0;c<f.length;c++){this.images[c].image.onload=function a(){e.imageCounter++;e.notificationCallback(e.imageCounter,e.images)};this.images[c].image.onerror=(function(g){return function(h){if(b){b(h,g)}}})(c);this.images[c].image.src=f[c].url}if(f.length===0){d(0,[])}}}});CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(b,d,a,e,g){if(b<d){var h=b;b=d;d=h}var c=document.createElement("canvas");c.width=e.width;c.height=e.height*a;var j=c.getContext("2d");j.fillStyle=g?g:"rgba(255,255,255,0)";j.fillRect(0,0,e.width,e.height*a);var f;for(f=0;f<a;f++){j.globalAlpha=1-(b-d)/a*(f+1);j.drawImage(e,0,f*e.height)}return c},rotate:function(d,e){e=e||0;if(!e){return d}var c=document.createElement("canvas");c.width=d.height;c.height=d.width;var b=c.getContext("2d");b.globalAlpha=1;b.fillStyle="rgba(0,0,0,0)";b.clearRect(0,0,c.width,c.height);var a=new CAAT.Math.Matrix();a.multiply(new CAAT.Math.Matrix().setTranslate(c.width/2,c.width/2));a.multiply(new CAAT.Math.Matrix().setRotation(e*Math.PI/180));a.multiply(new CAAT.Math.Matrix().setTranslate(-c.width/2,-c.width/2));a.transformRenderingContext(b);b.drawImage(d,0,0);return c},optimize:function(q,k,o){k>>=0;var a=true;var d=true;var c=true;var t=true;if(typeof o!=="undefined"){if(typeof o.top!=="undefined"){a=o.top}if(typeof o.bottom!=="undefined"){d=o.bottom}if(typeof o.left!=="undefined"){c=o.left}if(typeof o.right!=="undefined"){t=o.right}}var f=document.createElement("canvas");f.width=q.width;f.height=q.height;var s=f.getContext("2d");s.fillStyle="rgba(0,0,0,0)";s.fillRect(0,0,q.width,q.height);s.drawImage(q,0,0);var w=s.getImageData(0,0,q.width,q.height);var x=w.data;var v,u;var g=0,e=f.height-1;var m=0,h=f.width-1;var n=false;if(a){for(v=0;v<f.height;v++){for(u=0;u<f.width;u++){if(x[v*f.width*4+3+u*4]>k){n=true;break}}if(n){break}}g=v}if(d){n=false;for(v=f.height-1;v>=g;v--){for(u=0;u<f.width;u++){if(x[v*f.width*4+3+u*4]>k){n=true;break}}if(n){break}}e=v}if(c){n=false;for(u=0;u<f.width;u++){for(v=g;v<=e;v++){if(x[v*f.width*4+3+u*4]>k){n=true;break}}if(n){break}}m=u}if(t){n=false;for(u=f.width-1;u>=m;u--){for(v=g;v<=e;v++){if(x[v*f.width*4+3+u*4]>k){n=true;break}}if(n){break}}h=u}if(0===m&&0===g&&f.width-1===h&&f.height-1===e){return f}var r=h-m+1;var p=e-g+1;var b=s.getImageData(m,g,r,p);f.width=r;f.height=p;s=f.getContext("2d");s.putImageData(b,0,0);return f},createThumb:function(d,i,f,a){i=i||24;f=f||24;var b=document.createElement("canvas");b.width=i;b.height=f;var j=b.getContext("2d");if(a){var g=Math.max(d.width,d.height);var e=d.width/g*i;var c=d.height/g*f;j.drawImage(d,(i-e)/2,(f-c)/2,e,c)}else{j.drawImage(d,0,0,i,f)}return b}}});CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){var b=1;var a=32;return{bgActors:null,quadData:null,create:function(g,k,c,j,i,e,d){if(typeof e==="undefined"){e=a}if(typeof d==="undefined"){d=b}var h=(g+c)/2;var f=(k+j)/2;this.x=g;this.y=k;this.x1=c;this.y1=j;this.width=c-g;this.height=j-k;this.bgActors=this.__getOverlappingActorList(i);if(this.bgActors.length<=d||this.width<=e){return this}this.quadData=new Array(4);this.quadData[0]=new CAAT.Module.Collision.QuadTree().create(g,k,h,f,this.bgActors);this.quadData[1]=new CAAT.Module.Collision.QuadTree().create(h,k,c,f,this.bgActors);this.quadData[2]=new CAAT.Module.Collision.QuadTree().create(g,f,h,j,this.bgActors);this.quadData[3]=new CAAT.Module.Collision.QuadTree().create(h,f,c,j,this.bgActors);return this},__getOverlappingActorList:function(d){var g=[];for(var e=0,c=d.length;e<c;e++){var f=d[e];if(this.intersects(f.AABB)){g.push(f)}}return g},getOverlappingActors:function(f){var e,d,c;var m=[];var k;var h=this.bgActors;var g;if(this.quadData){for(e=0;e<4;e++){if(this.quadData[e].intersects(f)){k=this.quadData[e].getOverlappingActors(f);for(d=0,c=k.length;d<c;d++){m.push(k[d])}}}}else{for(e=0,c=h.length;e<c;e++){g=h[e];if(f.intersects(g.AABB)){m.push(g)}}}return m}}}});CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(a,e,f,d){var c,b;this.elements=[];for(c=0;c<f*d;c++){this.elements.push([])}this.width=a;this.height=e;this.rows=f;this.columns=d;this.xcache=[];for(c=0;c<a;c++){this.xcache.push((c/(a/d))>>0)}this.ycache=[];for(c=0;c<e;c++){this.ycache.push((c/(e/f))>>0)}this.xycache=[];for(c=0;c<this.rows;c++){this.xycache.push([]);for(b=0;b<this.columns;b++){this.xycache[c].push(b+c*d)}}this.rectangle=new CAAT.Math.Rectangle().setBounds(0,0,a,e);this.r0=new CAAT.Math.Rectangle();this.r1=new CAAT.Math.Rectangle();return this},clearObject:function(){var a;for(a=0;a<this.rows*this.columns;a++){this.elements[a]=[]}return this},addObject:function(f){var b=f.x|0;var g=f.y|0;var e=f.width|0;var a=f.height|0;var c=this.__getCells(b,g,e,a);for(var d=0;d<c.length;d++){this.elements[c[d]].push(f)}},__getCells:function(b,h,f,a){var d=[];var e;if(this.rectangle.contains(b,h)){d.push(this.xycache[this.ycache[h]][this.xcache[b]])}if(this.rectangle.contains(b+f-1,h+a-1)){var g=this.xycache[this.ycache[h+a-1]][this.xcache[b+f-1]];if(g===d[0]){return d}d.push(g)}if(this.rectangle.contains(b+f-1,h)){var g=this.xycache[this.ycache[h]][this.xcache[b+f-1]];if(g===d[0]||g===d[1]){return d}d.push(g)}if(this.rectangle.contains(b+f-1,h+a-1)){var g=this.xycache[this.ycache[h+a-1]][this.xcache[b]];d.push(g)}return d},solveCollision:function(e){var d,c,b;for(d=0;d<this.elements.length;d++){var a=this.elements[d];if(a.length>1){this._solveCollisionCell(a,e)}}},_solveCollisionCell:function(a,g){var e,d;for(e=0;e<a.length;e++){var b=a[e];this.r0.setBounds(b.x,b.y,b.width,b.height);for(d=e+1;d<a.length;d++){var f=a[d];if(this.r0.intersects(this.r1.setBounds(f.x,f.y,f.width,f.height))){g(b,f)}}}},collide:function(n,m,o,k,b){n|=0;m|=0;o|=0;k|=0;var q=this.__getCells(n,m,o,k);var f,d,c;var a=this.elements;this.r0.setBounds(n,m,o,k);for(f=0;f<q.length;f++){var p=q[f];var g=a[p];for(d=0,c=g.length;d<c;d++){var e=g[d];this.r1.setBounds(e.x,e.y,e.width,e.height);if(this.r0.intersects(this.r1)){if(b(e)){return}}}}}}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:false,image:null,u:0,v:0,glTexture:null}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(a){this.freeChunks=[{position:0,size:a||1024}];return this},freeChunks:null,findWhereFits:function(c){if(this.freeChunks.length===0){return[]}var a=[];var b;for(b=0;b<this.freeChunks.length;b++){var d=0;while(d+c<=this.freeChunks[b].size){a.push(d+this.freeChunks[b].position);d+=c}}return a},fits:function(a,c){var b=0;for(b=0;b<this.freeChunks.length;b++){var d=this.freeChunks[b];if(d.position<=a&&a+c<=d.position+d.size){return true}}return false},substract:function(a,f){var e=0;for(e=0;e<this.freeChunks.length;e++){var h=this.freeChunks[e];if(h.position<=a&&a+f<=h.position+h.size){var d=0;var b=0;var g=0;var c=0;d=h.position;b=a-h.position;g=a+f;c=h.position+h.size-g;this.freeChunks.splice(e,1);if(b>0){this.freeChunks.splice(e++,0,{position:d,size:b})}if(c>0){this.freeChunks.splice(e,0,{position:g,size:c})}return true}}return false},log:function(a){if(0===this.freeChunks.length){CAAT.log("index "+a+" empty")}else{var d="index "+a;for(var b=0;b<this.freeChunks.length;b++){var c=this.freeChunks[b];d+="["+c.position+","+c.size+"]"}CAAT.log(d)}}}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(a,c){this.scanMapHeight=c;this.scanMapWidth=a;this.scanMap=[];for(var b=0;b<this.scanMapHeight;b++){this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth))}return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(a,k){if(a>this.width||k>this.height){return null}var d,c,b=0;while(b<=this.scanMapHeight-k){var e=null;var h=false;for(;b<=this.scanMapHeight-k;b++){e=this.scanMap[b].findWhereFits(a);if(null!==e&&e.length>0){h=true;break}}if(h){var f=Number.MAX_VALUE;for(c=0;c<e.length;c++){var g=true;for(d=b;d<b+k;d++){if(!this.scanMap[d].fits(e[c],a)){g=false;break}}if(g){return{x:e[c],y:b}}}b++}else{return null}}return null},substract:function(b,e,d,a){for(var c=0;c<a;c++){if(!this.scanMap[c+e].substract(b,d)){CAAT.log("Error: removing chunk ",d,a," at ",b,e)}}},log:function(){for(var a=0;a<this.scanMapHeight;a++){this.scanMap[a].log(a)}}}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(a,b){this.width=a||1024;this.height=b||1024;this.images=[];return this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:false,padding:4,scan:null,images:null,criteria:"area",initialize:function(e){this.gl=e;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true);this.texture=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.texture);e.enable(e.BLEND);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);var a=new Uint8Array(this.width*this.height*4);for(var d=0;d<4*this.width*this.height;){a[d++]=0;a[d++]=0;a[d++]=0;a[d++]=0}e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,a);e.enable(e.BLEND);for(var c=0;c<this.images.length;c++){var b=this.images[c];if(b.inverted){b=CAAT.Module.Image.ImageUtil.rotate(b,-90)}e.texSubImage2D(e.TEXTURE_2D,0,this.images[c].__tx,this.images[c].__ty,e.RGBA,e.UNSIGNED_BYTE,b)}},create:function(d){var a=[];for(var c=0;c<d.length;c++){var b=d[c].image;if(!b.__texturePage){a.push(b)}}this.createFromImages(a)},clear:function(){this.createFromImages([])},update:function(d,c,b,a){this.allowImagesInvertion=d;this.padding=c;if(b<100){b=100}if(a<100){a=100}this.width=b;this.height=a;this.createFromImages(this.images)},createFromImages:function(a){var c;this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height);this.images=[];if(this.allowImagesInvertion){for(c=0;c<a.length;c++){a[c].inverted=this.allowImagesInvertion&&a[c].height<a[c].width}}var d=this;a.sort(function(g,f){var h=g.width*g.height;var e=f.width*f.height;if(d.criteria==="width"){return g.width<f.width?1:g.width>f.width?-1:0}else{if(d.criteria==="height"){return g.height<f.height?1:g.height>f.height?-1:0}}return h<e?1:h>e?-1:0});for(c=0;c<a.length;c++){var b=a[c];this.packImage(b)}},addImage:function(b,c,a){this.allowImagesInvertion=c;this.padding=a;this.images.push(b);this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var a=this.gl;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST);a.generateMipmap(a.TEXTURE_2D)},deletePage:function(){for(var a=0;a<this.images.length;a++){delete this.images[a].__texturePage;delete this.images[a].__u;delete this.images[a].__v}this.gl.deleteTexture(this.texture)},toCanvas:function(d,b){d=d||document.createElement("canvas");d.width=this.width;d.height=this.height;var c=d.getContext("2d");c.fillStyle="rgba(0,0,0,0)";c.fillRect(0,0,this.width,this.height);for(var a=0;a<this.images.length;a++){c.drawImage(!this.images[a].inverted?this.images[a]:CAAT.Modules.Image.ImageUtil.rotate(this.images[a],90),this.images[a].__tx,this.images[a].__ty);if(b){c.strokeStyle="red";c.strokeRect(this.images[a].__tx,this.images[a].__ty,this.images[a].__w,this.images[a].__h)}}if(b){c.strokeStyle="red";c.strokeRect(0,0,this.width,this.height)}return d},packImage:function(c){var g,b;if(c.inverted){g=c.height;b=c.width}else{g=c.width;b=c.height}var a=g;var f=b;var e;if(a&&this.padding){e=this.padding;if(a+e<=this.width){a+=e}}if(f&&this.padding){e=this.padding;if(f+e<=this.height){f+=e}}var d=this.scan.whereFitsChunk(a,f);if(null!==d){this.images.push(c);c.__tx=d.x;c.__ty=d.y;c.__u=d.x/this.width;c.__v=d.y/this.height;c.__u1=(d.x+g)/this.width;c.__v1=(d.y+b)/this.height;c.__texturePage=this;c.__w=g;c.__h=b;this.scan.substract(d.x,d.y,a,f)}else{CAAT.log("Imagen ",c.src," de tamano ",c.width,c.height," no cabe.")}},changeHeuristic:function(a){this.criteria=a}}});CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){this.pages=[];return this},pages:null,createPages:function(g,d,a,f){var b=false;while(!b){var e=new CAAT.Module.TexturePacker.TexturePage(d,a);e.create(f);e.initialize(g);e.endCreation();this.pages.push(e);b=true;for(var c=0;c<f.length;c++){if(!f[c].image.__texturePage){if(f[c].image.width<=d&&f[c].image.height<=a){b=false}break}}}},deletePages:function(){for(var a=0;a<this.pages.length;a++){this.pages[a].deletePage()}this.pages=null}}});CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(h,g,d){var a=h.width;var m=0,k=0,e=0,c=0;var b=-Number.MAX_VALUE,f=Number.MAX_VALUE;for(e=g.length-1;e;e-=1){if(f<g[e].width){f=g[e].width}if(b<g[e].height){b=g[e].height}}if(d.padding_left){m=d.padding_left;a-=m}if(d.padding_right){a-=d.padding_right}if(d.top){var j=parseInt(d.top,10);if(!isNaN(j)){k=j}else{switch(d.top){case"center":k=(h.height-b)/2;break;case"top":k=0;break;case"bottom":k=h.height-b;break;default:k=0}}}var n=a/g.length;for(e=0,c=g.length;e<c;e++){g[e].setLocation(m+e*n+(n-g[e].width)/2,k)}}}});CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(a,h,d,g,c){var e=document.getElementById(d);var b;if(CAAT.__CSS__){if(e){if(false===e instanceof HTMLDivElement){e=null}}if(e===null){e=document.createElement("div");document.body.appendChild(e)}b=new CAAT.Foundation.Director().initialize(a||800,h||600,e)}else{if(e){if(e instanceof HTMLDivElement){var i=document.createElement("canvas");e.appendChild(i);e=i}else{if(false==e instanceof HTMLCanvasElement){var i=document.createElement("canvas");document.body.appendChild(i);e=i}}}else{e=document.createElement("canvas");document.body.appendChild(e)}b=new CAAT.Foundation.Director().initialize(a||800,h||600,e)}new CAAT.Module.Preloader.ImagePreloader().loadImages(g,function f(k,j){if(k===j.length){b.emptyScenes();b.setImagesCache(j);c(b);b.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2000,false,CAAT.Foundation.Actor.ANCHOR_CENTER,new CAAT.Behavior.Interpolator().createElasticOutInterpolator(2.5,0.4));CAAT.loop(60)}})}}});CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(b,n,d,g,m,i,e,p){function k(q,s,x){var t=q.getImage("spinner");var u=q.getImage("splash");var w=q.createScene();var r=s;var v=new Date().getTime();if(u){w.addChild(new CAAT.Foundation.Actor().setBackgroundImage(u,false).setBounds(0,0,q.width,q.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE))}if(t){w.addChild(new CAAT.Foundation.Actor().setBackgroundImage(t).centerAt(w.width/2,w.height/2).addBehavior(new CAAT.Behavior.RotateBehavior().setValues(0,2*Math.PI).setFrameTime(0,1000).setCycle(true)))}w.loadedImage=function(z,y){if(!y||z===y.length){var A=new Date().getTime()-v;if(A<r){A=Math.abs(r-A);if(A>r){A=r}setTimeout(function(){c(q,y,x)},A)}else{c(q,y,x)}}};return w}function c(r,q,s){r.emptyScenes();r.setImagesCache(q);r.setClear(true);s(r);r.setClear(CAAT.Foundation.Director.CLEAR_ALL);r.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2000,false,CAAT.Foundation.Actor.ANCHOR_CENTER,new CAAT.Behavior.Interpolator().createElasticOutInterpolator(2.5,0.4))}var f=document.getElementById(d);var a;if(CAAT.__CSS__){if(f){if(false===f instanceof HTMLDivElement){f=null}}if(f===null){f=document.createElement("div");document.body.appendChild(f)}a=new CAAT.Foundation.Director().initialize(b||800,n||600,f)}else{if(f){if(f instanceof HTMLDivElement){var o=document.createElement("canvas");f.appendChild(o);f=o}else{if(false==f instanceof HTMLCanvasElement){var o=document.createElement("canvas");document.body.appendChild(o);f=o}}}else{f=document.createElement("canvas");document.body.appendChild(f)}a=new CAAT.Foundation.Director().initialize(b||800,n||600,f)}var h=[];if(e){h.push({id:"splash",url:e})}if(p){h.push({id:"spinner",url:p})}a.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS);new CAAT.Module.Preloader.ImagePreloader().loadImages(h,function j(r,q){if(r===q.length){a.setImagesCache(q);var s=k(a,g||5000,i);CAAT.loop(60);if(m&&m.length>0){new CAAT.Module.Preloader.ImagePreloader().loadImages(m,s.loadedImage)}else{s.loadedImage(0,null)}}})}}});CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){this.bbox=new CAAT.Math.Rectangle();return this},color:"#000",length:0,bbox:null,parent:null,setParent:function(a){this.parent=a;return this},setColor:function(a){if(a){this.color=a}return this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(a){},setPoint:function(a,b){},getPosition:function(a){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(a){},endPath:function(){},getContour:function(a){},updatePath:function(a){},applyAsPath:function(a){},transform:function(a){},drawHandle:function(b,a,c){b.beginPath();b.arc(a,c,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,false);b.fill()}}}});CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.newPosition=new CAAT.Math.Point();return this},points:null,length:-1,cw:true,bbox:null,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:false,setRadius:function(a){this.radius=a;return this},isArcTo:function(){return this.arcTo},setArcTo:function(a){this.arcTo=a;return this},initialize:function(a,d,b,c){this.setInitialPosition(a,d);this.setFinalPosition(a+b,d);this.angle=c||2*Math.PI;return this},applyAsPath:function(b){var a=b.ctx;if(!this.arcTo){a.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw)}else{a.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius)}return this},setPoint:function(a,b){if(b>=0&&b<this.points.length){this.points[b]=a}},setPoints:function(a){this.points=[];this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setClockWise:function(a){this.cw=a!==undefined?a:true;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,d){for(var c=0,b=this.points.length;c<b;c++){this.points[0].x=a;this.points[0].y=d}return this},setFinalPosition:function(b,a){this.points[1].x=b;this.points[1].y=a;this.updatePath(this.points[1]);return this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(a>1||a<0){a%=1}if(a<0){a=1+a}if(-1===this.length){this.newPosition.set(this.points[0].x,this.points[0].y)}else{var b=this.angle*a*(this.cw?1:-1)+this.startAngle;this.newPosition.set(this.points[0].x+this.radius*Math.cos(b),this.points[0].y+this.radius*Math.sin(b))}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(b,d){var a=b.ctx;a.save();a.strokeStyle=this.color;a.beginPath();if(!this.arcTo){a.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw)}else{a.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius)}a.stroke();if(d){a.globalAlpha=0.5;a.fillStyle="#7f7f00";for(var c=0;c<this.points.length;c++){this.drawHandle(a,this.points[c].x,this.points[c].y)}}a.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(c){var b=[];for(var a=0;a<c;a++){b.push({x:this.points[0].x+this.radius*Math.cos(a*Math.PI/(c/2)),y:this.points[0].y+this.radius*Math.sin(a*Math.PI/(c/2))})}return b},getPositionFromLength:function(a){var b=a/this.length*(this.cw?1:-1);return this.getPosition(b)},updatePath:function(a){if(this.points[1]===a){if(!this.arcTo){this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))}this.length=this.angle*this.radius;this.startAngle=Math.atan2((this.points[1].y-this.points[0].y),(this.points[1].x-this.points[0].x))}else{if(this.points[0]===a){this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle))}}this.bbox.setEmpty();this.bbox.x=this.points[0].x-this.radius;this.bbox.y=this.points[0].y-this.radius;this.bbox.x1=this.points[0].x+this.radius;this.bbox.y1=this.points[0].y+this.radius;this.bbox.width=2*this.radius;this.bbox.height=2*this.radius;return this}}}});CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.newPosition=new CAAT.Math.Point(0,0,0);return this},curve:null,newPosition:null,applyAsPath:function(a){this.curve.applyAsPath(a);return this},setPoint:function(a,b){if(this.curve){this.curve.setPoint(a,b)}},setPoints:function(a){var b=new CAAT.Math.Bezier();b.setPoints(a);this.curve=b;return this},setQuadric:function(a,g,c,b,e,d){var f=new CAAT.Math.Bezier();f.setQuadric(a,g,c,b,e,d);this.curve=f;this.updatePath();return this},setCubic:function(g,e,b,a,i,h,f,d){var c=new CAAT.Math.Bezier();c.setCubic(g,e,b,a,i,h,f,d);this.curve=c;this.updatePath();return this},updatePath:function(a){this.curve.update();this.length=this.curve.getLength();this.curve.getBoundingBox(this.bbox);return this},getPosition:function(a){if(a>1||a<0){a%=1}if(a<0){a=1+a}this.curve.solve(this.newPosition,a);return this.newPosition},getPositionFromLength:function(a){this.curve.solve(this.newPosition,a/this.length);return this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(a,b){this.curve.drawHandles=b;a.ctx.strokeStyle=this.color;this.curve.paint(a,b)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(a){return this.curve.coordlist[a]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(c){var b=[];for(var a=0;a<=c;a++){b.push({x:a/c,y:this.getPosition(a/c).y})}return b}}}});CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.newPosition=new CAAT.Math.Point(0,0,0);return this},points:null,newPosition:null,applyAsPath:function(a){a.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(a,b){if(b===0){this.points[0]=a}else{if(b===1){this.points[1]=a}}},updatePath:function(b){var a=this.points[1].x-this.points[0].x;var c=this.points[1].y-this.points[0].y;this.length=Math.sqrt(a*a+c*c);this.bbox.setEmpty();this.bbox.union(this.points[0].x,this.points[0].y);this.bbox.union(this.points[1].x,this.points[1].y);return this},setPoints:function(a){this.points[0]=a[0];this.points[1]=a[1];this.updatePath();return this},setInitialPosition:function(a,b){this.points[0].x=a;this.points[0].y=b;this.newPosition.set(a,b);return this},setFinalPosition:function(b,a){this.points[1].x=b;this.points[1].y=a;return this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if(a>1||a<0){a%=1}if(a<0){a=1+a}this.newPosition.set((this.points[0].x+(this.points[1].x-this.points[0].x)*a),(this.points[0].y+(this.points[1].y-this.points[0].y)*a));return this.newPosition},getPositionFromLength:function(a){return this.getPosition(a/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(b,c){var a=b.ctx;a.save();a.strokeStyle=this.color;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);a.lineTo(this.points[1].x,this.points[1].y);a.stroke();if(c){a.globalAlpha=0.5;a.fillStyle="#7f7f00";a.beginPath();this.drawHandle(a,this.points[0].x,this.points[0].y);this.drawHandle(a,this.points[1].x,this.points[1].y)}a.restore()},numControlPoints:function(){return 2},getControlPoint:function(a){if(0===a){return this.points[0]}else{if(1===a){return this.points[1]}}},getContour:function(b){var a=[];a.push(this.getPosition(0).clone());a.push(this.getPosition(1).clone());return a}}}});CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){this.__super();this.points=[];this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.points.push(new CAAT.Math.Point());this.newPosition=new CAAT.Math.Point();return this},points:null,length:-1,cw:true,bbox:null,newPosition:null,applyAsPath:function(b){var a=b.ctx;if(this.cw){a.lineTo(this.points[0].x,this.points[0].y);a.lineTo(this.points[1].x,this.points[1].y);a.lineTo(this.points[2].x,this.points[2].y);a.lineTo(this.points[3].x,this.points[3].y);a.lineTo(this.points[4].x,this.points[4].y)}else{a.lineTo(this.points[4].x,this.points[4].y);a.lineTo(this.points[3].x,this.points[3].y);a.lineTo(this.points[2].x,this.points[2].y);a.lineTo(this.points[1].x,this.points[1].y);a.lineTo(this.points[0].x,this.points[0].y)}return this},setPoint:function(a,b){if(b>=0&&b<this.points.length){this.points[b]=a}},setPoints:function(a){this.points=[];this.points.push(a[0]);this.points.push(new CAAT.Math.Point().set(a[1].x,a[0].y));this.points.push(a[1]);this.points.push(new CAAT.Math.Point().set(a[0].x,a[1].y));this.points.push(a[0].clone());this.updatePath();return this},setClockWise:function(a){this.cw=a!==undefined?a:true;return this},isClockWise:function(){return this.cw},setInitialPosition:function(a,d){for(var c=0,b=this.points.length;c<b;c++){this.points[c].x=a;this.points[c].y=d}return this},setFinalPosition:function(b,a){this.points[2].x=b;this.points[2].y=a;this.points[1].x=b;this.points[1].y=this.points[0].y;this.points[3].x=this.points[0].x;this.points[3].y=a;this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y;this.updatePath();return this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(b){if(b>1||b<0){b%=1}if(b<0){b=1+b}if(-1===this.length){this.newPosition.set(0,0)}else{var f=this.bbox.width/this.length;var c=this.bbox.height/this.length;var j=0;var a;var d;var e=0;if(this.cw){d=[0,1,2,3,4];a=[f,c,f,c]}else{d=[4,3,2,1,0];a=[c,f,c,f]}while(e<a.length){if(j+a[e]<b){j+=a[e];e++}else{break}}b-=j;var i=d[e];var g=d[e+1];this.newPosition.set((this.points[i].x+(this.points[g].x-this.points[i].x)*b/a[e]),(this.points[i].y+(this.points[g].y-this.points[i].y)*b/a[e]))}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(b,d){var a=b.ctx;a.save();a.strokeStyle=this.color;a.beginPath();a.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height);if(d){a.globalAlpha=0.5;a.fillStyle="#7f7f00";for(var c=0;c<this.points.length;c++){this.drawHandle(a,this.points[c].x,this.points[c].y)}}a.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(){var b=[];for(var a=0;a<this.points.length;a++){b.push(this.points[a])}return b},updatePath:function(a){if(a){if(a===this.points[0]){this.points[1].y=a.y;this.points[3].x=a.x}else{if(a===this.points[1]){this.points[0].y=a.y;this.points[2].x=a.x}else{if(a===this.points[2]){this.points[3].y=a.y;this.points[1].x=a.x}else{if(a===this.points[3]){this.points[0].x=a.x;this.points[2].y=a.y}}}}this.points[4].x=this.points[0].x;this.points[4].y=this.points[0].y}this.bbox.setEmpty();for(var b=0;b<4;b++){this.bbox.union(this.points[b].x,this.points[b].y)}this.length=2*this.bbox.width+2*this.bbox.height;this.points[0].x=this.bbox.x;this.points[0].y=this.bbox.y;this.points[1].x=this.bbox.x+this.bbox.width;this.points[1].y=this.bbox.y;this.points[2].x=this.bbox.x+this.bbox.width;this.points[2].y=this.bbox.y+this.bbox.height;this.points[3].x=this.bbox.x;this.points[3].y=this.bbox.y+this.bbox.height;this.points[4].x=this.bbox.x;this.points[4].y=this.bbox.y;return this},getPositionFromLength:function(a){return this.getPosition(a/(this.bbox.width*2+this.bbox.height*2))}}}});CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:["CAAT.PathUtil.PathSegment","CAAT.PathUtil.ArcPath","CAAT.PathUtil.CurvePath","CAAT.PathUtil.LinearPath","CAAT.PathUtil.RectPath","CAAT.Math.Bezier","CAAT.Math.CatmullRom","CAAT.Math.Point","CAAT.Math.Matrix"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){this.__super();this.newPosition=new CAAT.Math.Point(0,0,0);this.pathSegments=[];this.behaviorList=[];this.matrix=new CAAT.Math.Matrix();this.tmpMatrix=new CAAT.Math.Matrix();return this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:true,behaviorList:null,rb_angle:0,rb_rotateAnchorX:0.5,rb_rotateAnchorY:0.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:0.5,sb_scaleAnchorY:0.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,applyAsPath:function(b){var a=b.ctx;b.modelViewMatrix.transformRenderingContext(a);a.beginPath();a.globalCompositeOperation="source-out";a.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var c=0;c<this.pathSegments.length;c++){this.pathSegments[c].applyAsPath(b)}a.globalCompositeOperation="source-over";return this},setInteractive:function(a){this.interactive=a;return this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){if(this.pathSegments.length){return this.pathSegments[this.pathSegments.length-1].endCurvePosition()}else{return new CAAT.Math.Point().set(this.beginPathX,this.beginPathY)}},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(b,d,a,c){this.pathSegments=[];this.beginPath(b,d);this.addLineTo(a,c);this.endPath();return this},setQuadric:function(d,f,b,e,a,c){this.beginPath(d,f);this.addQuadricTo(b,e,a,c);this.endPath();return this},setCubic:function(f,h,d,g,b,e,a,c){this.beginPath(f,h);this.addCubicTo(d,g,b,e,a,c);this.endPath();return this},setRectangle:function(b,d,a,c){this.beginPath(b,d);this.addRectangleTo(a,c);this.endPath();return this},setCatmullRom:function(d,b){if(b){d=d.slice(0);d.unshift(d[d.length-1]);d.push(d[1]);d.push(d[2])}for(var c=1;c<d.length-2;c++){var e=new CAAT.PathUtil.CurvePath().setColor("#000").setParent(this);var a=new CAAT.Math.CatmullRom().setCurve(d[c-1],d[c],d[c+1],d[c+2]);e.curve=a;this.pathSegments.push(e)}return this},addSegment:function(a){a.setParent(this);this.pathSegments.push(a);return this},addArcTo:function(e,g,d,f,a,b,c){var h=new CAAT.PathUtil.ArcPath();h.setArcTo(true);h.setRadius(a);h.setInitialPosition(e,g).setFinalPosition(d,f);h.setParent(this);h.setColor(c);this.pathSegments.push(h);return this},addRectangleTo:function(c,d,a,b){var e=new CAAT.PathUtil.RectPath();e.setPoints([this.endCurvePosition(),new CAAT.Math.Point().set(c,d)]);e.setClockWise(a);e.setColor(b);e.setParent(this);this.pathSegments.push(e);return this},addQuadricTo:function(d,f,b,e,a){var g=new CAAT.Math.Bezier();g.setPoints([this.endCurvePosition(),new CAAT.Math.Point().set(d,f),new CAAT.Math.Point().set(b,e)]);this.trackPathX=b;this.trackPathY=e;var c=new CAAT.PathUtil.CurvePath().setColor(a).setParent(this);c.curve=g;this.pathSegments.push(c);return this},addCubicTo:function(h,c,g,b,f,a,e){var d=new CAAT.Math.Bezier();d.setPoints([this.endCurvePosition(),new CAAT.Math.Point().set(h,c),new CAAT.Math.Point().set(g,b),new CAAT.Math.Point().set(f,a)]);this.trackPathX=f;this.trackPathY=a;var i=new CAAT.PathUtil.CurvePath().setColor(e).setParent(this);i.curve=d;this.pathSegments.push(i);return this},addCatmullTo:function(h,c,g,b,f,a,e){var d=new CAAT.Math.CatmullRom().setColor(e);d.setCurve(this.trackPathX,this.trackPathY,h,c,g,b,f,a);this.trackPathX=f;this.trackPathY=a;var i=new CAAT.PathUtil.CurvePath().setParent(this);i.curve=d;this.pathSegments.push(i);return this},addLineTo:function(c,d,a){var b=new CAAT.PathUtil.LinearPath().setColor(a);b.setPoints([this.endCurvePosition(),new CAAT.Math.Point().set(c,d)]);b.setParent(this);this.trackPathX=c;this.trackPathY=d;this.pathSegments.push(b);return this},beginPath:function(a,b){this.trackPathX=a;this.trackPathY=b;this.beginPathX=a;this.beginPathY=b;return this},closePath:function(){this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1);this.trackPathX=this.beginPathX;this.trackPathY=this.beginPathY;this.endPath();return this},endPath:function(){this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];this.updatePath();return this},getPosition:function(c){if(c>1||c<0){c%=1}if(c<0){c=1+c}var a=this.pathSegments;var f=this.pathSegmentStartTime;var j=this.pathSegmentDurationTime;var e=0;var b=a.length;var d;var h=this.newPosition;var g;while(e!==b){d=((b+e)/2)|0;g=f[d];if(g<=c&&c<=g+j[d]){c=j[d]?(c-g)/j[d]:0;if(c>1){c=1}else{if(c<0){c=0}}var i=a[d].getPosition(c);h.x=i.x;h.y=i.y;return h}else{if(c<g){b=d}else{e=d+1}}}return this.endCurvePosition()},getPositionFromLength:function(c){c%=this.getLength();if(c<0){c+=this.getLength()}var b=0;for(var a=0;a<this.pathSegments.length;a++){if(b<=c&&c<=this.pathSegments[a].getLength()+b){c-=b;var d=this.pathSegments[a].getPositionFromLength(c);this.newPosition.x=d.x;this.newPosition.y=d.y;break}b+=this.pathSegments[a].getLength()}return this.newPosition},paint:function(a){for(var b=0;b<this.pathSegments.length;b++){this.pathSegments[b].paint(a,this.interactive)}},release:function(){this.ax=-1;this.ay=-1},getNumSegments:function(){return this.pathSegments.length},getSegment:function(a){return this.pathSegments[a]},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},updatePath:function(a,g){var d,b;this.length=0;this.bbox.setEmpty();this.points=[];var e=Number.MAX_VALUE,c=Number.MAX_VALUE;for(d=0;d<this.pathSegments.length;d++){this.pathSegments[d].updatePath(a);this.length+=this.pathSegments[d].getLength();this.bbox.unionRectangle(this.pathSegments[d].bbox);for(b=0;b<this.pathSegments[d].numControlPoints();b++){var f=this.pathSegments[d].getControlPoint(b);this.points.push(f);if(f.x<e){e=f.x}if(f.y<c){c=f.y}}}this.clipOffsetX=-e;this.clipOffsetY=-c;this.width=this.bbox.width;this.height=this.bbox.height;this.setLocation(this.bbox.x,this.bbox.y);this.pathSegmentStartTime=[];this.pathSegmentDurationTime=[];var d;for(d=0;d<this.pathSegments.length;d++){this.pathSegmentStartTime.push(0);this.pathSegmentDurationTime.push(0)}for(d=0;d<this.pathSegments.length;d++){this.pathSegmentDurationTime[d]=this.getLength()?this.pathSegments[d].getLength()/this.getLength():0;if(d>0){this.pathSegmentStartTime[d]=this.pathSegmentStartTime[d-1]+this.pathSegmentDurationTime[d-1]}else{this.pathSegmentStartTime[0]=0}this.pathSegments[d].endPath()}this.extractPathPoints();if(g){g(this)}return this},press:function(b,f){if(!this.interactive){return}var e=CAAT.Math.Curve.prototype.HANDLE_SIZE/2;for(var d=0;d<this.pathSegments.length;d++){for(var c=0;c<this.pathSegments[d].numControlPoints();c++){var a=this.pathSegments[d].getControlPoint(c);if(b>=a.x-e&&f>=a.y-e&&b<a.x+e&&f<a.y+e){this.point=a;return}}}this.point=null},drag:function(a,c,b){if(!this.interactive){return}if(null===this.point){return}if(-1===this.ax||-1===this.ay){this.ax=a;this.ay=c}this.point.x+=a-this.ax;this.point.y+=c-this.ay;this.ax=a;this.ay=c;this.updatePath(this.point,b)},getContour:function(c){var b=[];for(var a=0;a<=c;a++){b.push(new CAAT.Math.Point().set(a/c,this.getPosition(a/c).y,0))}return b},setPoints:function(b){if(this.points.length===b.length){for(var a=0;a<b.length;a++){this.points[a].x=b[a].x;this.points[a].y=b[a].y}}return this},setPoint:function(a,b){if(b>=0&&b<this.points.length){this.points[b].x=a.x;this.points[b].y=a.y}return this},emptyBehaviorList:function(){this.behaviorList=[];return this},extractPathPoints:function(){if(!this.pathPoints){var a;this.pathPoints=[];for(a=0;a<this.numControlPoints();a++){this.pathPoints.push(this.getControlPoint(a).clone())}}return this},addBehavior:function(a){this.behaviorList.push(a);return this},removeBehaviour:function(a){var b=this.behaviorList.length-1;while(b){if(this.behaviorList[b]===a){this.behaviorList.splice(b,1);return this}}return this},removeBehaviorById:function(b){for(var a=0;a<this.behaviorList.length;a++){if(this.behaviorList[a].id===b){this.behaviorList.splice(a,1)}}return this},applyBehaviors:function(b){for(var a=0;a<this.behaviorList.length;a++){this.behaviorList[a].apply(b,this)}this.setATMatrix();for(a=0;a<this.numControlPoints();a++){this.setPoint(this.matrix.transformCoord(this.pathPoints[a].clone().translate(this.clipOffsetX,this.clipOffsetY)),a)}return this},setATMatrix:function(){this.matrix.identity();var t=this.tmpMatrix.identity();var w=this.matrix.matrix;var z,r,v,u,f,e;var o,n,j,i,h,g;var b=this.bbox;var d=b.width;var k=b.height;var a=b.x;var A=b.y;o=1;n=0;i=0;h=1;j=this.tb_x-a-this.tAnchorX*d;g=this.tb_y-A-this.tAnchorY*k;if(this.rb_angle){var y=(this.rb_rotateAnchorX*d+a);var x=(this.rb_rotateAnchorY*k+A);j+=o*y+n*x;g+=i*y+h*x;z=Math.cos(this.rb_angle);r=Math.sin(this.rb_angle);v=o;u=n;f=i;e=h;o=v*z+u*r;n=-v*r+u*z;i=f*z+e*r;h=-f*r+e*z;j+=-o*y-n*x;g+=-i*y-h*x}if(this.sb_scaleX!=1||this.sb_scaleY!=1){var q=(this.sb_scaleAnchorX*d+a);var p=(this.sb_scaleAnchorY*k+A);j+=o*q+n*p;g+=i*q+h*p;o=o*this.sb_scaleX;n=n*this.sb_scaleY;i=i*this.sb_scaleX;h=h*this.sb_scaleY;j+=-o*q-n*p;g+=-i*q-h*p}w[0]=o;w[1]=n;w[2]=j;w[3]=i;w[4]=h;w[5]=g;return this},setRotationAnchored:function(c,b,a){this.rb_angle=c;this.rb_rotateAnchorX=b;this.rb_rotateAnchorY=a;return this},setRotationAnchor:function(b,a){this.rb_rotateAnchorX=b;this.rb_rotateAnchorY=a},setRotation:function(a){this.rb_angle=a},setScaleAnchored:function(b,a,d,c){this.sb_scaleX=b;this.sb_scaleAnchorX=d;this.sb_scaleY=a;this.sb_scaleAnchorY=c;return this},setScale:function(b,a){this.sb_scaleX=b;this.sb_scaleY=a;return this},setScaleAnchor:function(b,a){this.sb_scaleAnchorX=b;this.sb_scaleAnchorY=a;return this},setPositionAnchor:function(b,a){this.tAnchorX=b;this.tAnchorY=a;return this},setPositionAnchored:function(a,d,c,b){this.tb_x=a;this.tb_y=d;this.tAnchorX=c;this.tAnchorY=b;return this},setPosition:function(a,b){this.tb_x=a;this.tb_y=b;return this},setLocation:function(a,b){this.tb_x=a;this.tb_y=b;return this},flatten:function(d,b){var a=this.getPositionFromLength(0);var e=new CAAT.PathUtil.Path().beginPath(a.x,a.y);for(var c=0;c<d;c++){a=this.getPositionFromLength(c/d*this.length);e.addLineTo(a.x,a.y)}if(b){e.closePath()}else{e.endPath()}return e}}});CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],onCreate:function(){makePerspective=function(d,a,i,g,f){var c=i*Math.tan(d*Math.PI/360);var h=-c;var b=h*a;var e=c*a;return makeFrustum(b,e,h,c,i,g,f)};makeFrustum=function(h,m,b,k,n,j,i){var g=2*n/(m-h);var e=2*n/(k-b);var f=(m+h)/(m-h);var d=(k+b)/(k-b);var c=-(j+n)/(j-n);var a=-2*j*n/(j-n);return new CAAT.Math.Matrix3().initWithMatrix([[g,0,f,-i/2],[0,-e,d,i/2],[0,0,c,a],[0,0,-1,0]])};makeOrtho=function(b,h,a,g,i,f){var e=-(h+b)/(h-b);var d=-(g+a)/(g-a);var c=-(f+i)/(f-i);return new CAAT.Math.Matrix3().initWithMatrix([[2/(h-b),0,0,e],[0,2/(g-a),0,d],[0,0,-2/(f-i),c],[0,0,0,1]])}}});CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(a){this.gl=a;return this},shaderProgram:null,gl:null,setAlpha:function(a){},getShader:function(d,a,c){var b;if(a==="x-shader/x-fragment"){b=d.createShader(d.FRAGMENT_SHADER)}else{if(a==="x-shader/x-vertex"){b=d.createShader(d.VERTEX_SHADER)}else{return null}}d.shaderSource(b,c);d.compileShader(b);if(!d.getShaderParameter(b,d.COMPILE_STATUS)){alert(d.getShaderInfoLog(b));return null}return b},getDomShader:function(e,f){var b=document.getElementById(f);if(!b){return null}var d="";var a=b.firstChild;while(a){if(a.nodeType===3){d+=a.textContent}a=a.nextSibling}var c;if(b.type==="x-shader/x-fragment"){c=e.createShader(e.FRAGMENT_SHADER)}else{if(b.type==="x-shader/x-vertex"){c=e.createShader(e.VERTEX_SHADER)}else{return null}}e.shaderSource(c,d);e.compileShader(c);if(!e.getShaderParameter(c,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(c));return null}return c},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var a=this.gl;this.shaderProgram=a.createProgram();a.attachShader(this.shaderProgram,this.getVertexShader());a.attachShader(this.shaderProgram,this.getFragmentShader());a.linkProgram(this.shaderProgram);a.useProgram(this.shaderProgram);return this},setMatrixUniform:function(a){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,false,new Float32Array(a.flatten()))},useProgram:function(){this.gl.useProgram(this.shaderProgram);return this}}});CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){this.__super(a);return this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor");this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.useProgram();this.colorBuffer=this.gl.createBuffer();this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);var a=512,b;this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(a*12);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,0,0);return CAAT.ColorProgram.superclass.initialize.call(this)},setColor:function(a){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,false,0,0)}}});CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){this.__super(a);return this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var d;this.linesBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var b=[];for(d=0;d<1024;d++){b[d]=d}this.linesBufferArray=new Uint16Array(b);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW);this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition");this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute);this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord");this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute);this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix");this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler");this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha");this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,"uUseColor");this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor");this.setAlpha(1);this.setUseColor(false);var a=4096;this.vertexPositionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer);this.vertexPositionArray=new Float32Array(a*12);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,false,0,0);this.vertexUVBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer);this.vertexUVArray=new Float32Array(a*8);this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW);this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,false,0,0);this.vertexIndexBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer);var c=[];for(d=0;d<a;d++){c.push(0+d*4);c.push(1+d*4);c.push(2+d*4);c.push(0+d*4);c.push(2+d*4);c.push(3+d*4)}this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),this.gl.DYNAMIC_DRAW);return CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(e,h,f,c,d){this.gl.uniform1i(this.shaderProgram.useColor,e?1:0);if(e){if(this.prevA!==d||this.prevR!==h||this.prevG!==f||this.prevB!==c){this.gl.uniform4f(this.shaderProgram.color,h,f,c,d);this.prevA=d;this.prevR=h;this.prevG=f;this.prevB=c}}},setTexture:function(a){if(this.prevTexture!==a){var b=this.gl;b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,a);b.uniform1i(this.shaderProgram.samplerUniform,0);this.prevTexture=a}return this},updateVertexBuffer:function(b){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.vertexPositionBuffer);a.bufferSubData(a.ARRAY_BUFFER,0,b);return this},updateUVBuffer:function(b){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.vertexUVBuffer);a.bufferSubData(a.ARRAY_BUFFER,0,b);return this},setAlpha:function(a){if(this.prevAlpha!==a){this.gl.uniform1f(this.shaderProgram.alphaUniform,a);this.prevAlpha=a}return this},drawLines:function(k,f,i,h,d,e,c){var j=this.gl;this.setAlpha(e);j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,this.linesBuffer);j.lineWidth(c);this.updateVertexBuffer(k);this.setUseColor(true,i,h,d,1);j.drawElements(j.LINES,f,j.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(f,h,j,i,d,e,c){var k=this.gl;k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.linesBuffer);k.lineWidth(c);this.setAlpha(e);this.updateVertexBuffer(f);this.setUseColor(true,j,i,d,1);k.drawElements(k.LINE_STRIP,h,k.UNSIGNED_SHORT,0);this.setAlpha(1);this.setUseColor(false);k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}});CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(d,a,c,b){this.identifier=d;this.clientX=a;this.pageX=a;this.clientY=c;this.pageY=c;this.target=b;this.time=new Date().getTime();return this}}});CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){this.touches=[];this.changedTouches=[];return this},time:0,source:null,sourceEvent:null,shift:false,control:false,alt:false,meta:false,touches:null,changedTouches:null,init:function(a,b,c){this.source=b;this.alt=a.altKey;this.control=a.ctrlKey;this.shift=a.shiftKey;this.meta=a.metaKey;this.sourceEvent=a;this.time=c;return this},addTouch:function(a){if(-1===this.touches.indexOf(a)){this.touches.push(a)}return this},addChangedTouch:function(a){if(-1===this.changedTouches.indexOf(a)){this.changedTouches.push(a)}return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}});CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){this.point=new CAAT.Math.Point(0,0,0);this.screenPoint=new CAAT.Math.Point(0,0,0);this.touches=[];return this},screenPoint:null,point:null,time:0,source:null,shift:false,control:false,alt:false,meta:false,sourceEvent:null,touches:null,init:function(a,f,c,d,b,e){this.point.set(a,f);this.source=d;this.screenPoint=b;this.alt=c.altKey;this.control=c.ctrlKey;this.shift=c.shiftKey;this.meta=c.metaKey;this.sourceEvent=c;this.x=a;this.y=f;this.time=e;return this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}});CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(d,c,b,a){this.keyCode=d;this.action=c;this.modifiers=b;this.sourceEvent=a;this.preventDefault=function(){this.sourceEvent.preventDefault()};this.getKeyCode=function(){return this.keyCode};this.getAction=function(){return this.action};this.modifiers=function(){return this.modifiers};this.isShiftPressed=function(){return this.modifiers.shift};this.isControlPressed=function(){return this.modifiers.control};this.isAltPressed=function(){return this.modifiers.alt};this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.Keys={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222};CAAT.SHIFT_KEY=16;CAAT.CONTROL_KEY=17;CAAT.ALT_KEY=18;CAAT.ENTER_KEY=13;CAAT.KEY_MODIFIERS={alt:false,control:false,shift:false}}});CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){(function(){CAAT.setCursor=function(a){if(navigator.browser!=="iOS"){document.body.style.cursor=a}}})();(function(){CAAT.TOUCH_AS_MOUSE=1;CAAT.TOUCH_AS_MULTITOUCH=2;CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE})();(function(){CAAT.windowResizeListeners=[];CAAT.registerResizeListener=function(a){CAAT.windowResizeListeners.push(a)};CAAT.unregisterResizeListener=function(a){for(var b=0;b<CAAT.windowResizeListeners.length;b++){if(a===CAAT.windowResizeListeners[b]){CAAT.windowResizeListeners.splice(b,1);return}}}})();(function(){CAAT.keyListeners=[];CAAT.registerKeyListener=function(a){CAAT.keyListeners.push(a)}})();CAAT.enableDeviceMotion=function(){CAAT.prevOnDeviceMotion=null;CAAT.onDeviceMotion=null;CAAT.accelerationIncludingGravity={x:0,y:0,z:0};CAAT.rotationRate={alpha:0,beta:0,gamma:0};function a(b){CAAT.rotationRate={alpha:0,beta:b[0],gamma:b[1]}}if(window.DeviceOrientationEvent){CAAT.bindEvent(window,"deviceorientation",function(b){a([b.beta,b.gamma])},true)}else{if(window.DeviceMotionEvent){CAAT.bindEvent(window,"devicemotion",function(b){a([b.acceleration.x*2,b.acceleration.y*2])},true)}else{CAAT.bindEvent(window,"MozOrientation",function(b){a([-b.y*45,b.x*45])},true)}}};(function(){CAAT.bindEvent(window,"keydown",function(a){var c=(a.which)?a.which:a.keyCode;if(c===CAAT.SHIFT_KEY){CAAT.KEY_MODIFIERS.shift=true}else{if(c===CAAT.CONTROL_KEY){CAAT.KEY_MODIFIERS.control=true}else{if(c===CAAT.ALT_KEY){CAAT.KEY_MODIFIERS.alt=true}else{for(var b=0;b<CAAT.keyListeners.length;b++){CAAT.keyListeners[b](new CAAT.KeyEvent(c,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))}}}}},false);CAAT.bindEvent(window,"keyup",function(a){var c=(a.which)?a.which:a.keyCode;if(c===CAAT.SHIFT_KEY){CAAT.KEY_MODIFIERS.shift=false}else{if(c===CAAT.CONTROL_KEY){CAAT.KEY_MODIFIERS.control=false}else{if(c===CAAT.ALT_KEY){CAAT.KEY_MODIFIERS.alt=false}else{for(var b=0;b<CAAT.keyListeners.length;b++){CAAT.keyListeners[b](new CAAT.KeyEvent(c,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))}}}}},false);CAAT.bindEvent(window,"resize",function(a){for(var b=0;b<CAAT.windowResizeListeners.length;b++){CAAT.windowResizeListeners[b].windowResized(window.innerWidth,window.innerHeight)}},false)})()},extendsWith:{}});CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=false;CAAT.INTERVAL_ID=null;CAAT.renderEnabled=false;CAAT.FPS=60;CAAT.NO_RAF=0;CAAT.FPS_REFRESH=500;CAAT.RAF=0;CAAT.REQUEST_ANIMATION_FRAME_TIME=0;CAAT.SET_INTERVAL=0;CAAT.FRAME_TIME=0;CAAT.currentDirector=null;CAAT.director=[];CAAT.RegisterDirector=function(a){if(!CAAT.currentDirector){CAAT.currentDirector=a}CAAT.director.push(a)};CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()};CAAT.getCurrentSceneTime=function(){return CAAT.currentDirector.getCurrentScene().time};CAAT.endLoop=function(){if(CAAT.NO_RAF){if(CAAT.INTERVAL_ID!==null){clearInterval(CAAT.INTERVAL_ID)}}else{CAAT.ENDRAF=true}CAAT.renderEnabled=false};CAAT.loop=function(c){if(CAAT.renderEnabled){return}for(var b=0,a=CAAT.director.length;b<a;b++){CAAT.director[b].timeline=new Date().getTime()}CAAT.FPS=c||60;CAAT.renderEnabled=true;if(CAAT.NO_RAF){CAAT.INTERVAL_ID=setInterval(function(){var f=new Date().getTime();for(var e=0,d=CAAT.director.length;e<d;e++){var g=CAAT.director[e];if(g.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||g.needsRepaint){g.renderFrame()}}CAAT.FRAME_TIME=f-CAAT.SET_INTERVAL;if(CAAT.RAF){CAAT.REQUEST_ANIMATION_FRAME_TIME=new Date().getTime()-CAAT.RAF}CAAT.RAF=new Date().getTime();CAAT.SET_INTERVAL=f},1000/CAAT.FPS)}else{CAAT.renderFrameRAF()}};CAAT.renderFrameRAF=function(){if(typeof CAAT==="undefined"){return}var e=CAAT;if(e.ENDRAF){e.ENDRAF=false;return}var d=new Date().getTime();for(var b=0,a=e.director.length;b<a;b++){e.director[b].renderFrame()}d=new Date().getTime()-d;e.FRAME_TIME=d;if(e.RAF){e.REQUEST_ANIMATION_FRAME_TIME=new Date().getTime()-e.RAF}e.RAF=new Date().getTime();CAAT.RAF_ID=window.requestAnimFrame(e.renderFrameRAF,0)};window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function a(c,b){window.setTimeout(c,1000/CAAT.FPS)}})();window.cancelAnimFrame=(function(){return window.cancelAnimationFrame||window.mozCancelAnimationFrame||clearTimeout})()},extendsWith:function(){return{}}});CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,scene:null,taskId:0,remove:false,create:function(b,d,c,a,e){this.startTime=b;this.duration=d;this.callback_timeout=c;this.callback_tick=a;this.callback_cancel=e;return this},checkTask:function(b){var a=b;a-=this.startTime;if(a>=this.duration){this.remove=true;if(this.callback_timeout){this.callback_timeout(b,a,this)}}else{if(this.callback_tick){this.callback_tick(b,a,this)}}return this},reset:function(a){this.remove=false;this.startTime=a;this.scene.ensureTimerTask(this);return this},cancel:function(){this.remove=true;if(null!=this.callback_cancel){this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this)}return this},addTime:function(a){this.duration+=a;return this}}});CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){this.timerList=[];return this},timerList:null,timerSequence:0,checkTimers:function(c){var a=this.timerList;var b=a.length-1;while(b>=0){if(!a[b].remove){a[b].checkTask(c)}b--}},ensureTimerTask:function(a){if(!this.hasTimer(a)){this.timerList.push(a)}return this},hasTimer:function(c){var a=this.timerList;var b=a.length-1;while(b>=0){if(a[b]===c){return true}b--}return false},createTimer:function(c,e,d,a,f){var b=new CAAT.Foundation.Timer.TimerTask().create(c,e,d,a,f);b.taskId=this.timerSequence++;b.sceneTime=this.time;b.scene=this;this.timerList.push(b);return b},removeExpiredTimers:function(){var b;var a=this.timerList;for(b=0;b<a.length;b++){if(a[b].remove){a.splice(b,1)}}}}});CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){this.newChildren=[];this.padding={left:2,right:2,top:2,bottom:2};return this},newElementInterpolator:new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1.1,0.7),moveElementInterpolator:new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(2),padding:null,invalid:true,hgap:2,vgap:2,animated:false,newChildren:null,setAnimated:function(a){this.animated=a;return this},setHGap:function(a){this.hgap=a;this.invalidateLayout();return this},setVGap:function(a){this.vgap=a;this.invalidateLayout();return this},setAllPadding:function(a){this.padding.left=a;this.padding.right=a;this.padding.top=a;this.padding.bottom=a;this.invalidateLayout();return this},setPadding:function(c,e,d,a){this.padding.left=c;this.padding.right=e;this.padding.top=d;this.padding.bottom=a;this.invalidateLayout();return this},addChild:function(b,a){this.newChildren.push(b)},removeChild:function(a){},doLayout:function(a){this.newChildren=[];this.invalid=false},invalidateLayout:function(a){this.invalid=true},getMinimumLayoutSize:function(a){},getPreferredLayoutSize:function(a){},isValid:function(){return !this.invalid},isInvalidated:function(){return this.invalid}}}});CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(a){this.axis=a;this.invalidateLayout();return this},setHorizontalAlignment:function(a){this.halign=a;this.invalidateLayout();return this},setVerticalAlignment:function(a){this.valign=a;this.invalidateLayout();return this},doLayout:function(a){if(this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y){this.doLayoutVertical(a)}else{this.doLayoutHorizontal(a)}CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,a)},doLayoutHorizontal:function(c){var g=0,b=0;var h=0,f;var d,a,e;for(d=0,a=c.getNumChildren();d<a;d+=1){e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){if(b<e.height){b=e.height}g+=e.width;if(d>0){g+=this.hgap}}}switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:f=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:f=c.width-g-this.padding.right;break;default:f=(c.width-g)/2}for(d=0,a=c.getNumChildren();d<a;d+=1){e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:h=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:h=c.height-this.padding.bottom-e.height;break;default:h=(c.height-e.height)/2}this.__setActorPosition(e,f,h);f+=e.width+this.hgap}}},__setActorPosition:function(a,b,c){if(this.animated){if(this.newChildren.indexOf(a)!==-1){a.setPosition(b,c);a.setScale(0,0);a.scaleTo(1,1,500,0,0.5,0.5,this.newElementInterpolator)}else{a.moveTo(b,c,500,0,this.moveElementInterpolator)}}else{a.setPosition(b,c)}},doLayoutVertical:function(c){var g=0,b=0;var h,f;var d,a,e;for(d=0,a=c.getNumChildren();d<a;d+=1){e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){if(g<e.width){g=e.width}b+=e.height;if(d>0){b+=this.vgap}}}switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:h=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:h=c.height-b-this.padding.bottom;break;default:h=(c.height-b)/2}for(d=0,a=c.getNumChildren();d<a;d+=1){e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:f=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:f=c.width-this.padding.right-e.width;break;default:f=(c.width-e.width)/2}this.__setActorPosition(e,f,h);h+=e.height+this.vgap}}},getPreferredLayoutSize:function(c){var g=new CAAT.Math.Dimension();var f=0,b=0;var d,a;for(d=0,a=c.getNumChildren();d<a;d+=1){var e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){var h=e.getPreferredSize();if(b<h.height){b=h.height}f+=h.width}}g.width=f;g.height=b;return g},getMinimumLayoutSize:function(c){var g=new CAAT.Math.Dimension();var f=0,b=0;var d,a;for(d=0,a=c.getNumChildren();d<a;d+=1){var e=c.getChildAt(d);if(!e.preventLayout&&e.isVisible()&&e.isInAnimationFrame(CAAT.getCurrentSceneTime())){var h=e.getMinimumSize();if(b<h.height){b=h.height}f+=h.width}}g.width=f;g.height=b;return g}}}});CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){this.__super();return this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(b,a){if(typeof a==="undefined"){a="center"}CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,b,a);if(a==="left"){this.left=b}else{if(a==="right"){this.right=b}else{if(a==="top"){this.top=b}else{if(a==="bottom"){this.bottom=b}else{this.center=b}}}}},removeChild:function(a){if(this.center===a){this.center=null}else{if(this.left===a){this.left=null}else{if(this.right===a){this.right=null}else{if(this.top===a){this.top=null}else{if(this.bottom===a){this.bottom=null}}}}}},__getChild:function(a){if(a==="center"){return this.center}else{if(a==="left"){return this.left}else{if(a==="right"){return this.right}else{if(a==="top"){return this.top}else{if(a==="bottom"){return this.bottom}}}}}},getMinimumLayoutSize:function(a){var f,e;var b=new CAAT.Math.Dimension();if((f=this.__getChild("right"))!=null){e=f.getMinimumSize();b.width+=e.width+this.hgap;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("left"))!=null){e=f.getMinimumSize();b.width+=e.width+this.hgap;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("center"))!=null){e=f.getMinimumSize();b.width+=e.width;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("top"))!=null){e=f.getMinimumSize();b.width=Math.max(e.width,b.width);b.height+=e.height+this.vgap}if((f=this.__getChild("bottom"))!=null){e=f.getMinimumSize();b.width=Math.max(e.width,b.width);b.height+=e.height+this.vgap}b.width+=this.padding.left+this.padding.right;b.height+=this.padding.top+this.padding.bottom;return b},getPreferredLayoutSize:function(a){var f,e;var b=new CAAT.Dimension();if((f=this.__getChild("left"))!=null){e=f.getPreferredSize();b.width+=e.width+this.hgap;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("right"))!=null){e=f.getPreferredSize();b.width+=e.width+this.hgap;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("center"))!=null){e=f.getPreferredSize();b.width+=e.width;b.height=Math.max(e.height,b.height)}if((f=this.__getChild("top"))!=null){e=f.getPreferredSize();b.width=Math.max(e.width,b.width);b.height+=e.height+this.vgap}if((f=this.__getChild("bottom"))!=null){e=f.getPreferredSize();b.width=Math.max(e.width,b.width);b.height+=e.height+this.vgap}b.width+=this.padding.left+this.padding.right;b.height+=this.padding.top+this.padding.bottom;return b},doLayout:function(a){var g=this.padding.top;var b=a.height-this.padding.bottom;var f=this.padding.left;var e=a.width-this.padding.right;var i,h;if((i=this.__getChild("top"))!=null){i.setSize(e-f,i.height);h=i.getPreferredSize();i.setBounds(f,g,e-f,h.height);g+=h.height+this.vgap}if((i=this.__getChild("bottom"))!=null){i.setSize(e-f,i.height);h=i.getPreferredSize();i.setBounds(f,b-h.height,e-f,h.height);b-=h.height+this.vgap}if((i=this.__getChild("right"))!=null){i.setSize(i.width,b-g);h=i.getPreferredSize();i.setBounds(e-h.width,g,h.width,b-g);e-=h.width+this.hgap}if((i=this.__getChild("left"))!=null){i.setSize(i.width,b-g);h=i.getPreferredSize();i.setBounds(f,g,h.width,b-g);f+=h.width+this.hgap}if((i=this.__getChild("center"))!=null){i.setBounds(f,g,e-f,b-g)}CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,a)}}});CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(b,a){this.__super();this.rows=b;this.columns=a;return this},rows:0,columns:2,doLayout:function(m){var f=m.getNumChildren();if(f===0){return}var d=this.rows;var e=this.columns;if(d>0){e=Math.floor((f+d-1)/d)}else{d=Math.floor((f+e-1)/e)}var p=(e-1)*this.hgap;var k=m.width-(this.padding.left+this.padding.right);var a=Math.floor((k-p)/e);var n=Math.floor((k-(a*e+p))/2);var t=(d-1)*this.vgap;var g=m.height-(this.padding.top+this.padding.bottom);var s=Math.floor((g-t)/d);var q=Math.floor((g-(s*d+t))/2);for(var v=0,j=this.padding.left+n;v<e;v++,j+=a+this.hgap){for(var o=0,h=this.padding.top+q;o<d;o++,h+=s+this.vgap){var u=o*e+v;if(u<f){var b=m.getChildAt(u);if(!b.preventLayout&&b.isVisible()&&b.isInAnimationFrame(CAAT.getCurrentSceneTime())){if(!this.animated){b.setBounds(j,h,a,s)}else{if(b.width!==a||b.height!==s){b.setSize(a,s);if(this.newChildren.indexOf(b)!==-1){b.setPosition(j,h);b.setScale(0.01,0.01);b.scaleTo(1,1,500,0,0.5,0.5,this.newElementInterpolator)}else{b.moveTo(j,h,500,0,this.moveElementInterpolator)}}}}}}}CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,m)},getMinimumLayoutSize:function(a){var e=this.rows;var b=this.columns;var m=a.getNumChildren();var k=0,g=0,f;if(e>0){b=Math.ceil((m+e-1)/e)}else{e=Math.ceil((m+b-1)/b)}for(f=0;f<m;f+=1){var c=a.getChildAt(f);if(!c.preventLayout&&c.isVisible()&&c.isInAnimationFrame(CAAT.getCurrentSceneTime())){var j=c.getMinimumSize();if(k<j.width){k=j.width}if(g<j.height){g=j.height}}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+b*k+(b-1)*this.hgap,this.padding.top+this.padding.bottom+e*g+(e-1)*this.vgap)},getPreferredLayoutSize:function(a){var e=this.rows;var b=this.columns;var m=a.getNumChildren();var k=0,g=0,f;if(e>0){b=Math.ceil((m+e-1)/e)}else{e=Math.ceil((m+b-1)/b)}for(f=0;f<m;f+=1){var c=a.getChildAt(f);if(!c.preventLayout&&c.isVisible()&&c.isInAnimationFrame(CAAT.getCurrentSceneTime())){var j=c.getPreferredSize();if(k<j.width){k=j.width}if(g<j.height){g=j.height}}}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+b*k+(b-1)*this.hgap,this.padding.top+this.padding.bottom+e*g+(e-1)*this.vgap)}}});CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(a,f,b,d,c,e){this.x=parseFloat(a);this.y=parseFloat(f);this.width=parseFloat(b);this.height=parseFloat(d);this.setGL(a/c,f/e,(a+b-1)/c,(f+d-1)/e);return this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(b,a,c,d){this.u=b;this.v=a;this.u1=c;this.v1=d;return this}}});CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(b,c,a){this.animation=b;this.time=c;this.onEndPlayCallback=a;return this},animation:null,time:0,onEndPlayCallback:null}}});CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){this.paint=this.paintN;this.setAnimationImageIndex([0]);this.mapInfo={};this.animationsMap={};if(arguments.length===3){this.initialize.apply(this,arguments)}return this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1000,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(a,d,b,c){this.animationsMap[a]=new CAAT.Foundation.SpriteImageAnimationHelper(d,b,c);return this},setAnimationEndCallback:function(a){this.callback=a},playAnimation:function(a){if(a===this.currentAnimation){return this}var b=this.animationsMap[a];if(!b){return this}this.currentAnimation=a;this.setAnimationImageIndex(b.animation);this.changeFPS=b.time;this.callback=b.onEndPlayCallback;return this},setOwner:function(a){this.ownerActor=a;return this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){var a=this.mapInfo[this.spriteIndex];return a.width},getHeight:function(){var a=this.mapInfo[this.spriteIndex];return a.height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var a=new CAAT.Foundation.SpriteImage();a.image=this.image;a.rows=this.rows;a.columns=this.columns;a.width=this.width;a.height=this.height;a.singleWidth=this.singleWidth;a.singleHeight=this.singleHeight;a.mapInfo=this.mapInfo;a.offsetX=this.offsetX;a.offsetY=this.offsetY;a.scaleX=this.scaleX;a.scaleY=this.scaleY;a.animationsMap=this.animationsMap;a.parentOffsetX=this.parentOffsetX;a.parentOffsetY=this.parentOffsetY;a.scaleFont=this.scaleFont;return a},setOffsetX:function(a){this.offsetX=a;return this},setOffsetY:function(a){this.offsetY=a;return this},setOffset:function(a,b){this.offsetX=a;this.offsetY=b;return this},initialize:function(q,g,b){if(!q){console.log("Null image for SpriteImage.")}if(isString(q)){q=CAAT.currentDirector.getImage(q)}this.parentOffsetX=0;this.parentOffsetY=0;this.rows=g;this.columns=b;if(q instanceof CAAT.Foundation.SpriteImage||q instanceof CAAT.SpriteImage){this.image=q.image;var s=q.mapInfo[0];this.width=s.width;this.height=s.height;this.parentOffsetX=s.x;this.parentOffsetY=s.y;this.width=q.mapInfo[0].width;this.height=q.mapInfo[0].height}else{this.image=q;this.width=q.width;this.height=q.height;this.mapInfo={}}this.singleWidth=Math.floor(this.width/b);this.singleHeight=Math.floor(this.height/g);var y,j,A;var a;if(q.__texturePage){q.__du=this.singleWidth/q.__texturePage.width;q.__dv=this.singleHeight/q.__texturePage.height;var k=this.singleWidth;var B=this.singleHeight;var D=this.columns;if(q.inverted){var o=k;k=B;B=o;D=this.rows}var f=this.image.__tx;var x=this.image.__ty;var d=this.image.__texturePage;for(y=0;y<g*b;y++){var C=((y%D)>>0);var p=((y/D)>>0);var n=f+C*k;var m=x+p*B;var z=n+k;var e=m+B;a=new CAAT.Foundation.SpriteImageHelper(n,m,(z-n),(e-m),d.width,d.height).setGL(n/d.width,m/d.height,z/d.width,e/d.height);this.mapInfo[y]=a}}else{for(y=0;y<g*b;y++){j=((y%this.columns)|0)*this.singleWidth+this.parentOffsetX;A=((y/this.columns)|0)*this.singleHeight+this.parentOffsetY;a=new CAAT.Foundation.SpriteImageHelper(j,A,this.singleWidth,this.singleHeight,q.width,q.height);this.mapInfo[y]=a}}return this},paintTiled:function(b,e,p,o){var c=this.mapInfo[this.spriteIndex];var a=new CAAT.Math.Rectangle();this.ownerActor.AABB.intersect(b.AABB,a);var q=this.getWidth();var k=this.getHeight();var s=(this.offsetX-this.ownerActor.x)%q;if(s>0){s=s-q}var n=(this.offsetY-this.ownerActor.y)%k;if(n>0){n=n-k}var m=(((a.width-s)/q)>>0)+1;var d=(((a.height-n)/k)>>0)+1;var g,f;var t=b.ctx;for(g=0;g<d;g++){for(f=0;f<m;f++){t.drawImage(this.image,c.x,c.y,c.width,c.height,(a.x-this.ownerActor.x+s+f*c.width)>>0,(a.y-this.ownerActor.y+n+g*c.height)>>0,c.width,c.height)}}},paintInvertedH:function(c,e,a,f){var d=this.mapInfo[this.spriteIndex];var b=c.ctx;b.save();b.translate((a|0)+d.width,f|0);b.scale(-1,1);b.drawImage(this.image,d.x,d.y,d.width,d.height,this.offsetX>>0,this.offsetY>>0,d.width,d.height);b.restore();return this},paintInvertedV:function(c,e,a,f){var d=this.mapInfo[this.spriteIndex];var b=c.ctx;b.save();b.translate(a|0,(f+d.height)|0);b.scale(1,-1);b.drawImage(this.image,d.x,d.y,d.width,d.height,this.offsetX>>0,this.offsetY>>0,d.width,d.height);b.restore();return this},paintInvertedHV:function(c,e,a,f){var d=this.mapInfo[this.spriteIndex];var b=c.ctx;b.save();b.translate(a|0,(f+d.height)|0);b.scale(1,-1);b.translate(d.width,0);b.scale(-1,1);b.drawImage(this.image,d.x,d.y,d.width,d.height,this.offsetX>>0,this.offsetY>>0,d.width,d.height);b.restore();return this},paintN:function(b,d,a,e){var c=this.mapInfo[this.spriteIndex];b.ctx.drawImage(this.image,c.x,c.y,c.width,c.height,(this.offsetX+a)>>0,(this.offsetY+e)>>0,c.width,c.height);return this},paintAtRect:function(c,f,a,g,b,e){var d=this.mapInfo[this.spriteIndex];c.ctx.drawImage(this.image,d.x,d.y,d.width,d.height,(this.offsetX+a)>>0,(this.offsetY+g)>>0,b,e);return this},paintScaledWidth:function(b,d,a,e){var c=this.mapInfo[this.spriteIndex];b.ctx.drawImage(this.image,c.x,c.y,c.width,c.height,(this.offsetX+a)>>0,(this.offsetY+e)>>0,this.ownerActor.width,c.height);return this},paintChunk:function(d,e,c,a,g,b,f){d.drawImage(this.image,a,g,b,f,e,c,b,f)},paintTile:function(b,c,a,e){var d=this.mapInfo[c];b.drawImage(this.image,d.x,d.y,d.width,d.height,(this.offsetX+a)>>0,(this.offsetY+e)>>0,d.width,d.height);return this},paintScaled:function(b,d,a,e){var c=this.mapInfo[this.spriteIndex];b.ctx.drawImage(this.image,c.x,c.y,c.width,c.height,(this.offsetX+a)>>0,(this.offsetY+e)>>0,this.ownerActor.width,this.ownerActor.height);return this},getCurrentSpriteImageCSSPosition:function(){var b=this.mapInfo[this.spriteIndex];var a=-(b.x+this.parentOffsetX-this.offsetX);var c=-(b.y+this.parentOffsetY-this.offsetY);return""+a+"px "+c+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(e,r){var i=this.image;if(!i.__texturePage){return}var f=r;var g=this.spriteIndex;var b=this.mapInfo[this.spriteIndex];var s=b.u;var q=b.v;var a=b.u1;var o=b.v1;if(this.offsetX||this.offsetY){var n=this.ownerActor.width;var d=this.ownerActor.height;var j=i.__texturePage;var p=-this.offsetX/j.width;var m=-this.offsetY/j.height;var k=(n-this.offsetX)/j.width;var c=(d-this.offsetY)/j.height;s=p+i.__u;q=m+i.__v;a=k+i.__u;o=c+i.__v}if(i.inverted){e[f++]=a;e[f++]=q;e[f++]=a;e[f++]=o;e[f++]=s;e[f++]=o;e[f++]=s;e[f++]=q}else{e[f++]=s;e[f++]=q;e[f++]=a;e[f++]=q;e[f++]=a;e[f++]=o;e[f++]=s;e[f++]=o}},setChangeFPS:function(a){this.changeFPS=a;return this},setSpriteTransformation:function(b){this.transformation=b;var a=CAAT.Foundation.SpriteImage;switch(b){case a.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case a.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case a.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case a.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case a.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case a.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}this.ownerActor.invalidate();return this},resetAnimationTime:function(){this.prevAnimationTime=-1;return this},setAnimationImageIndex:function(a){this.animationImageIndex=a;this.spriteIndex=a[0];this.prevAnimationTime=-1;return this},setSpriteIndex:function(a){this.spriteIndex=a;return this},setSpriteIndexAtTime:function(c){if(this.animationImageIndex.length>1){if(this.prevAnimationTime===-1){this.prevAnimationTime=c;this.spriteIndex=this.animationImageIndex[0];this.prevIndex=0;this.ownerActor.invalidate()}else{var b=c;b-=this.prevAnimationTime;b/=this.changeFPS;b%=this.animationImageIndex.length;var a=Math.floor(b);if(a<this.prevIndex){if(this.callback){this.callback(this,c)}}this.prevIndex=a;this.spriteIndex=this.animationImageIndex[a];this.ownerActor.invalidate()}}},getMapInfo:function(a){return this.mapInfo[a]},initializeFromMap:function(f,e){this.initialize(f,1,1);var a;var c;var b=0;for(a in e){var d=e[a];c=new CAAT.Foundation.SpriteImageHelper(parseFloat(d.x)+this.parentOffsetX,parseFloat(d.y)+this.parentOffsetY,parseFloat(d.width),parseFloat(d.height),f.width,f.height);this.mapInfo[a]=c;if(!b){this.setAnimationImageIndex([a])}b++}return this},addElement:function(a,c){var b=new CAAT.Foundation.SpriteImageHelper(parseFloat(c.x)+this.parentOffsetX,parseFloat(c.y)+this.parentOffsetY,parseFloat(c.width),parseFloat(c.height),this.image.width,this.image.height);b.xoffset=typeof c.xoffset==="undefined"?0:parseFloat(c.xoffset);b.yoffset=typeof c.yoffset==="undefined"?0:parseFloat(c.yoffset);b.xadvance=typeof c.xadvance==="undefined"?c.width:parseFloat(c.xadvance);this.mapInfo[a]=b;return this},initializeAsGlyphDesigner:function(f,e){this.initialize(f,1,1);var a;var c;var b=0;for(a in e){var d=e[a];c=new CAAT.Foundation.SpriteImageHelper(parseFloat(d.x)+this.parentOffsetX,parseFloat(d.y)+this.parentOffsetX,parseFloat(d.width),parseFloat(d.height),f.width,f.height);c.xoffset=typeof d.xoffset==="undefined"?0:d.xoffset;c.yoffset=typeof d.yoffset==="undefined"?0:d.yoffset;c.xadvance=typeof d.xadvance==="undefined"?d.width:d.xadvance;this.mapInfo[a]=c;if(!b){this.setAnimationImageIndex([a])}b++}return this},initializeAsFontMap:function(f,d){this.initialize(f,1,1);var c;var a=0;for(var b=0;b<d.length;b++){var e=d[b];c=new CAAT.Foundation.SpriteImageHelper(parseFloat(a)+this.parentOffsetX,0+this.parentOffsetY,parseFloat(e.width),f.height,f.width,f.height);c.xoffset=0;c.yoffset=0;c.xadvance=e.width;a+=e.width;this.mapInfo[d[b].c]=c;if(!b){this.setAnimationImageIndex([d[b].c])}}return this},initializeAsMonoTypeFontMap:function(f,c){var e=[];var d=c.split("");var a=f.width/d.length>>0;for(var b=0;b<d.length;b++){e.push({c:d[b],width:a})}return this.initializeAsFontMap(f,e)},stringWidth:function(e){var d,b,a=0,c;for(d=0,b=e.length;d<b;d++){c=this.mapInfo[e.charAt(d)];if(c){a+=c.xadvance*this.fontScale}}return a},stringHeight:function(){if(this.fontHeight){return this.fontHeight*this.fontScale}var d=0;for(var b in this.mapInfo){var a=this.mapInfo[b];var c=a.height+a.yoffset;if(c>d){d=c}}this.fontHeight=d;return this.fontHeight*this.fontScale},drawText:function(g,d,a,h){var f,c,e,b;for(f=0;f<g.length;f++){e=this.mapInfo[g.charAt(f)];if(e){b=e.width;d.drawImage(this.image,e.x,e.y,b,e.height,a+e.xoffset*this.fontScale,h+e.yoffset*this.fontScale,b*this.fontScale,e.height*this.fontScale);a+=e.xadvance*this.fontScale}}},getFontData:function(){var a=(this.stringHeight()*0.8)>>0;return{height:this.stringHeight(),ascent:a,descent:this.stringHeight()-a}}}}});CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:["CAAT.Event.AnimationLoop","CAAT.Foundation.SpriteImage","CAAT.Core.Constants","CAAT.Behavior.PathBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.Scale1Behavior","CAAT.PathUtil.LinearPath","CAAT.Event.AnimationLoop"],constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var a=0;return{__init:function(){this.behaviorList=[];this.lifecycleListenerList=[];this.AABB=new CAAT.Math.Rectangle();this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)];this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER;this.modelViewMatrix=new CAAT.Math.Matrix();this.worldModelViewMatrix=new CAAT.Math.Matrix();this.resetTransform();this.setScale(1,1);this.setRotation(0);this.id=a++;return this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:false,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:0.5,scaleTY:0.5,scaleAnchor:0,rotationAngle:0,rotationY:0.5,rotationX:0.5,alpha:1,isGlobalAlpha:false,frameAlpha:1,expired:false,discardable:false,pointed:false,mouseEnabled:true,visible:true,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:false,dirty:true,wdirty:true,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:false,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:false,invalid:true,cached:0,collides:false,collidesAsRect:true,preventLayout:false,isAA:true,setPreventLayout:function(c){this.preventLayout=c;return this},invalidateLayout:function(){if(this.parent&&!this.parent.layoutInvalidated){this.parent.invalidateLayout()}return this},__validateLayout:function(){},setPreferredSize:function(b,c){if(!this.preferredSize){this.preferredSize=new CAAT.Math.Dimension()}this.preferredSize.width=b;this.preferredSize.height=c;return this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(b,c){if(!this.minimumSize){this.minimumSize=new CAAT.Math.Dimension()}this.minimumSize.width=b;this.minimumSize.height=c;return this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(d,j,f,e,g,i){if(d===this.x&&j===this.y){return}var h="__moveTo";var c=this.getBehavior(h);if(!c){c=new CAAT.Behavior.PathBehavior().setId(h).setValues(new CAAT.PathUtil.LinearPath());this.addBehavior(c)}c.path.setInitialPosition(this.x,this.y).setFinalPosition(d,j);c.setDelayTime(e?e:0,f);if(g){c.setInterpolator(g)}if(i){c.lifecycleListenerList=[];c.addListener({behaviorExpired:function(k,m,b){i(k,m,b)}})}return this},rotateTo:function(h,f,e,d,j,g){if(h===this.rotationAngle){return}var i="__rotateTo";var c=this.getBehavior(i);if(!c){c=new CAAT.Behavior.RotateBehavior().setId(i).setValues(0,0,0.5,0.5);this.addBehavior(c)}c.setValues(this.rotationAngle,h,d,j).setDelayTime(e?e:0,f);if(g){c.setInterpolator(g)}return this},scaleTo:function(k,j,f,g,e,d,h){if(this.scaleX===k&&this.scaleY===j){return}var c="__scaleTo";var i=this.getBehavior(c);if(!i){i=new CAAT.Behavior.ScaleBehavior().setId(c).setValues(1,1,1,1,0.5,0.5);this.addBehavior(i)}i.setValues(this.scaleX,k,this.scaleY,j,e,d).setDelayTime(g?g:0,f);if(h){i.setInterpolator(h)}return this},scaleXTo:function(d,e,c,b,g,f){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,d,e,c,b,g,f)},scaleYTo:function(c,e,d,b,g,f){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,c,e,d,b,g,f)},__scale1To:function(e,g,h,i,f,d,j){if((e===CAAT.Behavior.Scale1Behavior.AXIS_X&&g===this.scaleX)||(e===CAAT.Behavior.Scale1Behavior.AXIS_Y&&g===this.scaleY)){return}var c="__scaleXTo";var k=this.getBehavior(c);if(!k){k=new CAAT.Behavior.Scale1Behavior().setId(c).setValues(1,1,e===CAAT.Behavior.Scale1Behavior.AXIS_X,0.5,0.5);this.addBehavior(k)}k.setValues(e?this.scaleX:this.scaleY,g,f,d).setDelayTime(i?i:0,h);if(j){k.setInterpolator(j)}return this},touchStart:function(b){},touchMove:function(b){},touchEnd:function(b){},gestureStart:function(d,c,b){},gestureChange:function(d,c,b){if(this.gestureEnabled){this.setRotation(d);this.setScale(c,b)}return this},gestureEnd:function(d,c,b){},isVisible:function(){return this.visible},setupCollission:function(c,b){this.collides=c;this.collidesAsRect=!b},invalidate:function(){this.invalid=true;return this},setGestureEnabled:function(b){this.gestureEnabled=!!b;return this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(b){this.id=b;return this},setParent:function(b){this.parent=b;return this},setBackgroundImage:function(c,b){if(c){if(!(c instanceof CAAT.Foundation.SpriteImage)){if(isString(c)){c=new CAAT.Foundation.SpriteImage().initialize(CAAT.currentDirector.getImage(c),1,1)}else{c=new CAAT.Foundation.SpriteImage().initialize(c,1,1)}}else{c=c.getRef()}c.setOwner(this);this.backgroundImage=c;if(typeof b==="undefined"||b){this.width=c.getWidth();this.height=c.getHeight()}this.glEnabled=true;this.invalidate()}else{this.backgroundImage=null}return this},setSpriteIndex:function(b){if(this.backgroundImage){this.backgroundImage.setSpriteIndex(b);this.invalidate()}return this},setBackgroundImageOffset:function(c,b){if(this.backgroundImage){this.backgroundImage.setOffset(c,b)}return this},setAnimationImageIndex:function(b){if(this.backgroundImage){this.backgroundImage.resetAnimationTime();this.backgroundImage.setAnimationImageIndex(b);this.invalidate()}return this},addAnimation:function(b,e,c,d){if(this.backgroundImage){this.backgroundImage.addAnimation(b,e,c,d)}return this},playAnimation:function(b){if(this.backgroundImage){this.backgroundImage.playAnimation(b)}return this},setAnimationEndCallback:function(b){if(this.backgroundImage){this.backgroundImage.setAnimationEndCallback(b)}return this},resetAnimationTime:function(){if(this.backgroundImage){this.backgroundImage.resetAnimationTime();this.invalidate()}return this},setChangeFPS:function(b){if(this.backgroundImage){this.backgroundImage.setChangeFPS(b)}return this},setImageTransformation:function(b){if(this.backgroundImage){this.backgroundImage.setSpriteTransformation(b)}return this},centerOn:function(b,c){this.setPosition(b-this.width/2,c-this.height/2);return this},centerAt:function(b,c){this.setPosition(b-this.width/2,c-this.height/2);return this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(b){this.invalidate();if(CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!b&&this.visible){CAAT.currentDirector.scheduleDirtyRect(this.AABB)}this.visible=b;return this},setOutOfFrameTime:function(){this.setFrameTime(-1,0);return this},addListener:function(b){this.lifecycleListenerList.push(b);return this},removeListener:function(b){var c=this.lifecycleListenerList.length;while(c--){if(this.lifecycleListenerList[c]===b){this.lifecycleListenerList.splice(c,1);return}}},setGlobalAlpha:function(b){this.isGlobalAlpha=b;return this},fireEvent:function(d,c){for(var b=0;b<this.lifecycleListenerList.length;b++){this.lifecycleListenerList[b].actorLifeCycleEvent(this,d,c)}},setExpired:function(b){this.expired=true;this.fireEvent("expired",b);return this},enableEvents:function(b){this.mouseEnabled=b;return this},emptyBehaviorList:function(){this.behaviorList=[];return this},setFillStyle:function(b){this.fillStyle=b;this.invalidate();return this},setStrokeStyle:function(b){this.strokeStyle=b;this.invalidate();return this},setPaint:function(b){return this.setFillStyle(b)},setAlpha:function(b){this.alpha=b;this.invalidate();return this},resetTransform:function(){this.rotationAngle=0;this.rotationX=0.5;this.rotationY=0.5;this.scaleX=1;this.scaleY=1;this.scaleTX=0.5;this.scaleTY=0.5;this.scaleAnchor=0;this.oldX=-1;this.oldY=-1;this.dirty=true;return this},setFrameTime:function(b,c){this.start_time=b;this.duration=c;this.expired=false;this.dirty=true;return this},paint:function(c,d){if(this.backgroundImage){this.backgroundImage.paint(c,d,0,0)}else{if(this.fillStyle){var b=c.ctx;b.fillStyle=this.fillStyle;b.fillRect(0,0,this.width,this.height)}}},setScale:function(c,b){this.scaleX=c;this.scaleY=b;this.dirty=true;return this},getAnchorPercent:function(b){var c=[0.5,0.5,0.5,0,0.5,1,0,0.5,1,0.5,0,0,1,0,0,1,1,1];return{x:c[b*2],y:c[b*2+1]}},getAnchor:function(e){var d=0,c=0;var b=CAAT.Foundation.Actor;switch(e){case b.ANCHOR_CENTER:d=0.5;c=0.5;break;case b.ANCHOR_TOP:d=0.5;c=0;break;case b.ANCHOR_BOTTOM:d=0.5;c=1;break;case b.ANCHOR_LEFT:d=0;c=0.5;break;case b.ANCHOR_RIGHT:d=1;c=0.5;break;case b.ANCHOR_TOP_RIGHT:d=1;c=0;break;case b.ANCHOR_BOTTOM_LEFT:d=0;c=1;break;case b.ANCHOR_BOTTOM_RIGHT:d=1;c=1;break;case b.ANCHOR_TOP_LEFT:d=0;c=0;break}return{x:d,y:c}},setGlobalAnchor:function(c,b){this.tAnchorX=c;this.rotationX=c;this.scaleTX=c;this.tAnchorY=b;this.rotationY=b;this.scaleTY=b;this.dirty=true;return this},setScaleAnchor:function(c,b){this.scaleTX=c;this.scaleTY=b;this.dirty=true;return this},setScaleAnchored:function(e,d,c,b){this.scaleTX=c;this.scaleTY=b;this.scaleX=e;this.scaleY=d;this.dirty=true;return this},setRotationAnchor:function(c,b){this.rotationX=b;this.rotationY=c;this.dirty=true;return this},setRotation:function(b){this.rotationAngle=b;this.dirty=true;return this},setRotationAnchored:function(d,c,b){this.rotationAngle=d;this.rotationX=c;this.rotationY=b;this.dirty=true;return this},setSize:function(b,c){this.width=b;this.height=c;this.dirty=true;return this},setBounds:function(b,e,c,d){this.x=b;this.y=e;this.width=c;this.height=d;this.dirty=true;return this},setLocation:function(b,c){this.x=b;this.y=c;this.oldX=b;this.oldY=c;this.dirty=true;return this},setPosition:function(b,c){return this.setLocation(b,c)},setPositionAnchor:function(c,b){this.tAnchorX=c;this.tAnchorY=b;return this},setPositionAnchored:function(b,e,d,c){this.setLocation(b,e);this.tAnchorX=d;this.tAnchorY=c;return this},isInAnimationFrame:function(b){if(this.expired){return false}if(this.duration===Number.MAX_VALUE){return this.start_time<=b}if(b>=this.start_time+this.duration){if(!this.expired){this.setExpired(b)}return false}return this.start_time<=b&&b<this.start_time+this.duration},contains:function(b,c){return b>=0&&c>=0&&b<this.width&&c<this.height},addBehavior:function(b){this.behaviorList.push(b);return this},removeBehaviour:function(b){var e=this.behaviorList;var d=e.length-1;while(d){if(e[d]===b){e.splice(d,1);return this}}return this},removeBehaviorById:function(e){var d=this.behaviorList;for(var b=0;b<d.length;b++){if(d[b].id===e){d.splice(b,1)}}return this},getBehavior:function(f){var e=this.behaviorList;for(var d=0;d<e.length;d++){var b=e[d];if(b.id===f){return b}}return null},setDiscardable:function(b){this.discardable=b;return this},destroy:function(b){if(this.parent){this.parent.removeChild(this)}this.fireEvent("destroyed",b)},modelToView:function(c){var b,g,f,d;if(this.dirty){this.setModelViewMatrix()}d=this.worldModelViewMatrix.matrix;if(c instanceof Array){for(var e=0;e<c.length;e++){f=c[e];b=f.x;g=f.y;f.x=b*d[0]+g*d[1]+d[2];f.y=b*d[3]+g*d[4]+d[5]}}else{b=c.x;g=c.y;c.x=b*d[0]+g*d[1]+d[2];c.y=b*d[3]+g*d[4]+d[5]}return c},modelToModel:function(b,c){if(this.dirty){this.setModelViewMatrix()}return c.viewToModel(this.modelToView(b))},viewToModel:function(b){if(this.dirty){this.setModelViewMatrix()}this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse();this.worldModelViewMatrixI.transformCoord(b);return b},findActorAtPosition:function(b){if(this.scaleX===0||this.scaleY===0){return null}if(!this.visible||!this.mouseEnabled||!this.isInAnimationFrame(this.time)){return null}this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.modelViewMatrixI.transformCoord(b);return this.contains(b.x,b.y)?this:null},enableDrag:function(){this.ax=0;this.ay=0;this.asx=1;this.asy=1;this.ara=0;this.screenx=0;this.screeny=0;this.mouseEnter=function(b){this.__d_ax=-1;this.__d_ay=-1;this.pointed=true;CAAT.setCursor("move")};this.mouseExit=function(b){this.__d_ax=-1;this.__d_ay=-1;this.pointed=false;CAAT.setCursor("default")};this.mouseMove=function(b){};this.mouseUp=function(b){this.__d_ax=-1;this.__d_ay=-1};this.mouseDrag=function(h){var f;f=this.modelToView(new CAAT.Math.Point(h.x,h.y));this.parent.viewToModel(f);if(this.__d_ax===-1||this.__d_ay===-1){this.__d_ax=f.x;this.__d_ay=f.y;this.__d_asx=this.scaleX;this.__d_asy=this.scaleY;this.__d_ara=this.rotationAngle;this.__d_screenx=h.screenPoint.x;this.__d_screeny=h.screenPoint.y}if(h.isShiftDown()){var c=(h.screenPoint.x-this.__d_screenx)/100;var b=(h.screenPoint.y-this.__d_screeny)/100;if(!h.isAltDown()){var g=Math.max(c,b);c=g;b=g}this.setScale(c+this.__d_asx,b+this.__d_asy)}else{if(h.isControlDown()){var e=h.screenPoint.x-this.__d_screenx;var d=h.screenPoint.y-this.__d_screeny;this.setRotation(-Math.atan2(e,d)+this.__d_ara)}else{this.x+=f.x-this.__d_ax;this.y+=f.y-this.__d_ay}}this.__d_ax=f.x;this.__d_ay=f.y};return this},disableDrag:function(){this.mouseEnter=function(b){};this.mouseExit=function(b){};this.mouseMove=function(b){};this.mouseUp=function(b){};this.mouseDrag=function(b){};return this},mouseClick:function(b){},mouseDblClick:function(b){},mouseEnter:function(b){this.pointed=true},mouseExit:function(b){this.pointed=false},mouseMove:function(b){},mouseDown:function(b){},mouseUp:function(b){},mouseOut:function(b){},mouseOver:function(b){},mouseDrag:function(b){},drawScreenBoundingBox:function(c,f){if(null!==this.AABB&&this.inFrame){var d=this.AABB;var b=c.ctx;b.strokeStyle=CAAT.DEBUGAABBCOLOR;b.strokeRect(0.5+(d.x|0),0.5+(d.y|0),d.width|0,d.height|0);if(CAAT.DEBUGBB){var e=this.viewVertices;b.beginPath();b.lineTo(e[0].x,e[0].y);b.lineTo(e[1].x,e[1].y);b.lineTo(e[2].x,e[2].y);b.lineTo(e[3].x,e[3].y);b.closePath();b.strokeStyle=CAAT.DEBUGBBCOLOR;b.stroke()}}},animate:function(b,d){if(!this.visible){return false}var c;if(!this.isInAnimationFrame(d)){this.inFrame=false;this.dirty=true;return false}if(this.x!==this.oldX||this.y!==this.oldY){this.dirty=true;this.oldX=this.x;this.oldY=this.y}for(c=0;c<this.behaviorList.length;c++){this.behaviorList[c].apply(d,this)}if(this.clipPath){this.clipPath.applyBehaviors(d)}this.setModelViewMatrix();if(this.dirty||this.wdirty||this.invalid){if(b.dirtyRectsEnabled){b.addDirtyRect(this.AABB)}this.setScreenBounds();if(b.dirtyRectsEnabled){b.addDirtyRect(this.AABB)}}this.dirty=false;this.invalid=false;this.inFrame=true;if(this.backgroundImage){this.backgroundImage.setSpriteIndexAtTime(d)}return this.AABB.intersects(b.AABB)},setModelViewMatrix:function(){var v,o,t,r,e,d;var n,m,k,j,i,h;var u;this.wdirty=false;u=this.modelViewMatrix.matrix;if(this.dirty){n=1;m=0;j=0;i=1;k=this.x-this.tAnchorX*this.width;h=this.y-this.tAnchorY*this.height;if(this.rotationAngle){var g=this.rotationX*this.width;var f=this.rotationY*this.height;k+=n*g+m*f;h+=j*g+i*f;v=Math.cos(this.rotationAngle);o=Math.sin(this.rotationAngle);t=n;r=m;e=j;d=i;n=t*v+r*o;m=-t*o+r*v;j=e*v+d*o;i=-e*o+d*v;k+=-n*g-m*f;h+=-j*g-i*f}if(this.scaleX!=1||this.scaleY!=1){var q=this.scaleTX*this.width;var p=this.scaleTY*this.height;k+=n*q+m*p;h+=j*q+i*p;n=n*this.scaleX;m=m*this.scaleY;j=j*this.scaleX;i=i*this.scaleY;k+=-n*q-m*p;h+=-j*q-i*p}u[0]=n;u[1]=m;u[2]=k;u[3]=j;u[4]=i;u[5]=h}if(this.parent){this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1&&this.parent.isAA;if(this.dirty||this.parent.wdirty){this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix);if(this.isAA){var b=this.worldModelViewMatrix.matrix;b[2]+=u[2];b[5]+=u[5]}else{this.worldModelViewMatrix.multiply(this.modelViewMatrix)}this.wdirty=true}}else{if(this.dirty){this.wdirty=true}this.worldModelViewMatrix.identity();this.isAA=this.rotationAngle===0&&this.scaleX===1&&this.scaleY===1}},setScreenBounds:function(){var e=this.AABB;var o=this.viewVertices;var g,d,k,j,p,i;if(this.isAA){d=this.worldModelViewMatrix.matrix;k=d[2];j=d[5];p=this.width;i=this.height;e.x=k;e.y=j;e.x1=k+p;e.y1=j+i;e.width=p;e.height=i;if(CAAT.GLRENDER){g=o[0];g.x=k;g.y=j;g=o[1];g.x=k+p;g.y=j;g=o[2];g.x=k+p;g.y=j+i;g=o[3];g.x=k;g.y=j+i}return this}g=o[0];g.x=0;g.y=0;g=o[1];g.x=this.width;g.y=0;g=o[2];g.x=this.width;g.y=this.height;g=o[3];g.x=0;g.y=this.height;this.modelToView(this.viewVertices);var b=Number.MAX_VALUE,f=-Number.MAX_VALUE;var n=Number.MAX_VALUE,c=-Number.MAX_VALUE;g=o[0];if(g.x<b){b=g.x}if(g.x>f){f=g.x}if(g.y<n){n=g.y}if(g.y>c){c=g.y}g=o[1];if(g.x<b){b=g.x}if(g.x>f){f=g.x}if(g.y<n){n=g.y}if(g.y>c){c=g.y}g=o[2];if(g.x<b){b=g.x}if(g.x>f){f=g.x}if(g.y<n){n=g.y}if(g.y>c){c=g.y}g=o[3];if(g.x<b){b=g.x}if(g.x>f){f=g.x}if(g.y<n){n=g.y}if(g.y>c){c=g.y}e.x=b;e.y=n;e.x1=f;e.y1=c;e.width=(f-b);e.height=(c-n);return this},paintActor:function(c,d){if(!this.visible||!c.inDirtyRect(this)){return true}var b=c.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;b.globalAlpha=this.frameAlpha;c.modelViewMatrix.transformRenderingContextSet(b);this.worldModelViewMatrix.transformRenderingContext(b);if(this.clip){b.beginPath();if(!this.clipPath){b.rect(0,0,this.width,this.height)}else{this.clipPath.applyAsPath(c)}b.clip()}this.paint(c,d);return true},__paintActor:function(d,e){if(!this.visible){return true}var c=d.ctx;this.frameAlpha=this.alpha;var b=this.worldModelViewMatrix.matrix;c.setTransform(b[0],b[3],b[1],b[4],b[2],b[5],this.frameAlpha);this.paint(d,e);return true},paintActorGL:function(b,e){this.frameAlpha=this.parent.frameAlpha*this.alpha;if(!this.glEnabled||!this.visible){return}if(this.glNeedsFlush(b)){b.glFlush();this.glSetShader(b);if(!this.__uv){this.__uv=new Float32Array(8)}if(!this.__vv){this.__vv=new Float32Array(12)}this.setGLCoords(this.__vv,0);this.setUV(this.__uv,0);b.glRender(this.__vv,12,this.__uv);return}var d=b.coords;var c=b.coordsIndex;this.setGLCoords(d,c);b.coordsIndex=c+12;this.setUV(b.uv,b.uvIndex);b.uvIndex+=8},setGLCoords:function(d,b){var c=this.viewVertices;d[b++]=c[0].x;d[b++]=c[0].y;d[b++]=0;d[b++]=c[1].x;d[b++]=c[1].y;d[b++]=0;d[b++]=c[2].x;d[b++]=c[2].y;d[b++]=0;d[b++]=c[3].x;d[b++]=c[3].y;d[b]=0},setUV:function(b,c){this.backgroundImage.setUV(b,c)},glNeedsFlush:function(b){if(this.getTextureGLPage()!==b.currentTexturePage){return true}if(this.frameAlpha!==b.currentOpacity){return true}return false},glSetShader:function(b){var c=this.getTextureGLPage();if(c!==b.currentTexturePage){b.setGLTexturePage(c)}if(this.frameAlpha!==b.currentOpacity){b.setGLCurrentOpacity(this.frameAlpha)}},endAnimate:function(b,c){return this},initialize:function(c){if(c){for(var b in c){this[b]=c[b]}}return this},setClip:function(b,c){this.clip=b;this.clipPath=c;return this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){if(this.cached){this.backgroundImage=null;this.cached=CAAT.Foundation.Actor.CACHE_NONE}},cacheAsBitmap:function(g,h){if(this.width<=0||this.height<=0){return this}g=g||0;var f=document.createElement("canvas");f.width=this.width;f.height=this.height;var c=f.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,g);var b={ctx:c,modelViewMatrix:new CAAT.Math.Matrix(),worldModelViewMatrix:new CAAT.Math.Matrix(),dirtyRectsEnabled:false,inDirtyRect:function(){return true},AABB:new CAAT.Math.Rectangle(0,0,this.width,this.height)};var e=this.modelViewMatrix;var d=this.worldModelViewMatrix;this.modelViewMatrix=new CAAT.Math.Matrix();this.worldModelViewMatrix=new CAAT.Math.Matrix();this.cached=CAAT.Foundation.Actor.CACHE_NONE;if(typeof h==="undefined"){h=CAAT.Foundation.Actor.CACHE_SIMPLE}if(h===CAAT.Foundation.Actor.CACHE_DEEP){this.animate(b,g);this.paintActor(b,g)}else{if(this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer){CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,b,g)}else{this.animate(b,g);this.paintActor(b,g)}}this.setBackgroundImage(f);this.cached=h;this.modelViewMatrix=e;this.worldModelViewMatrix=d;return this},resetAsButton:function(){this.actionPerformed=null;this.mouseEnter=function(){};this.mouseExit=function(){};this.mouseDown=function(){};this.mouseUp=function(){};this.mouseClick=function(){};this.mouseDrag=function(){};return this},setAsButton:function(b,e,f,g,h,c){var d=this;this.setBackgroundImage(b,true);this.iNormal=e||0;this.iOver=f||this.iNormal;this.iPress=g||this.iNormal;this.iDisabled=h||this.iNormal;this.fnOnClick=c;this.enabled=true;this.setSpriteIndex(e);this.setEnabled=function(i){this.enabled=i;this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled);return this};this.actionPerformed=function(i){if(this.enabled&&this.fnOnClick){this.fnOnClick(this)}};this.mouseEnter=function(i){if(!this.enabled){return}if(this.dragging){this.setSpriteIndex(this.iPress)}else{this.setSpriteIndex(this.iOver)}CAAT.setCursor("pointer")};this.mouseExit=function(i){if(!this.enabled){return}this.setSpriteIndex(this.iNormal);CAAT.setCursor("default")};this.mouseDown=function(i){if(!this.enabled){return}this.setSpriteIndex(this.iPress)};this.mouseUp=function(i){if(!this.enabled){return}this.setSpriteIndex(this.iNormal);this.dragging=false};this.mouseClick=function(i){};this.mouseDrag=function(i){if(!this.enabled){return}this.dragging=true};this.setButtonImageIndex=function(i,m,j,k){this.iNormal=i||0;this.iOver=m||this.iNormal;this.iPress=j||this.iNormal;this.iDisabled=k||this.iNormal;this.setSpriteIndex(this.iNormal);return this};return this},findActorById:function(b){return this.id===b?this:null}}}});CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var c=CAAT.Foundation.Actor.CACHE_DEEP;var f=CAAT.Foundation.ActorContainer.superclass;var d=f.drawScreenBoundingBox;var e=f.paintActor;var h=f.paintActorGL;var a=f.animate;var g=f.findActorAtPosition;var b=f.destroy;return{__init:function(i){this.__super();this.childrenList=[];this.activeChildren=[];this.pendingChildrenList=[];if(typeof i!=="undefined"){this.addHint=i;this.boundingBox=new CAAT.Math.Rectangle()}return this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle(),layoutManager:null,layoutInvalidated:true,setLayout:function(i){this.layoutManager=i;return this},setBounds:function(i,m,j,k){CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,i,m,j,k);if(CAAT.currentDirector&&!CAAT.currentDirector.inValidation){this.invalidateLayout()}return this},__validateLayout:function(){this.__validateTree();this.layoutInvalidated=false},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=true;this.layoutManager.doLayout(this);for(var j=0;j<this.getNumChildren();j+=1){this.getChildAt(j).__validateLayout()}}},invalidateLayout:function(){this.layoutInvalidated=true;if(this.layoutManager){this.layoutManager.invalidateLayout(this);for(var j=0;j<this.getNumChildren();j+=1){this.getChildAt(j).invalidateLayout()}}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(k,n){if(!this.inFrame){return}var j=this.childrenList;for(var m=0;m<j.length;m++){j[m].drawScreenBoundingBox(k,n)}d.call(this,k,n)},emptyChildren:function(){this.childrenList=[];return this},paintActor:function(m,p){if(!this.visible){return false}var k=m.ctx;k.save();if(!e.call(this,m,p)){return false}if(this.cached===c){return false}if(!this.isGlobalAlpha){this.frameAlpha=this.parent?this.parent.frameAlpha:1}for(var n=0,j=this.activeChildren.length;n<j;++n){var o=this.activeChildren[n];if(o.visible){k.save();o.paintActor(m,p);k.restore()}}k.restore();return true},__paintActor:function(o,r){if(!this.visible){return true}var n=o.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var j=this.worldModelViewMatrix.matrix;n.setTransform(j[0],j[3],j[1],j[4],j[2],j[5],this.frameAlpha);this.paint(o,r);if(!this.isGlobalAlpha){this.frameAlpha=this.parent?this.parent.frameAlpha:1}for(var p=0,k=this.activeChildren.length;p<k;++p){var q=this.activeChildren[p];q.paintActor(o,r)}return true},paintActorGL:function(k,n){var m,j,o;if(!this.visible){return true}h.call(this,k,n);if(!this.isGlobalAlpha){this.frameAlpha=this.parent.frameAlpha}for(m=0,j=this.activeChildren.length;m<j;++m){o=this.activeChildren[m];o.paintActorGL(k,n)}},animate:function(j,n){if(!this.visible){return false}this.activeChildren=[];var u=null;if(false===a.call(this,j,n)){return false}if(this.cached===c){return true}this.__validateLayout();CAAT.currentDirector.inValidation=false;var q,o;var m=this.pendingChildrenList;for(q=0;q<m.length;q++){var k=m[q];this.addChildImmediately(k.child,k.constraint)}this.pendingChildrenList=[];var r=[];var t=this.childrenList;this.size_active=1;this.size_total=1;for(q=0;q<t.length;q++){var p=t[q];p.time=n;this.size_total+=p.size_total;if(p.animate(j,n)){this.activeChildren.push(p);this.size_active+=p.size_active}else{if(p.expired&&p.discardable){r.push(p)}}}for(q=0,o=r.length;q<o;q++){var s=r[q];s.destroy(n);if(j.dirtyRectsEnabled){j.addDirtyRect(s.AABB)}}return true},endAnimate:function(i,j){},addChildImmediately:function(j,i){return this.addChild(j,i)},addChild:function(j,i){if(j.parent!=null){throw ("adding to a container an element with parent.")}j.parent=this;this.childrenList.push(j);j.dirty=true;if(this.layoutManager){this.layoutManager.addChild(j,i);this.invalidateLayout()}else{if(this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM){this.recalcSize()}}return this},recalcSize:function(){var n=this.boundingBox;n.setEmpty();var j=this.childrenList;var m;for(var k=0;k<j.length;k++){m=j[k];this.runion.setBounds(m.x<0?0:m.x,m.y<0?0:m.y,m.width,m.height);n.unionRectangle(this.runion)}this.setSize(n.x1,n.y1);return this},addChildDelayed:function(j,i){this.pendingChildrenList.push({child:j,constraint:i});return this},addChildAt:function(j,i){if(i<=0){j.parent=this;j.dirty=true;this.childrenList.splice(0,0,j);this.invalidateLayout();return this}else{if(i>=this.childrenList.length){i=this.childrenList.length}}j.parent=this;j.dirty=true;this.childrenList.splice(i,0,j);this.invalidateLayout();return this},findActorById:function(o){var k=this.childrenList;for(var n=0,j=k.length;n<j;n++){var m=k[n].findActorById(o);if(null!=m){return m}}return null},findChild:function(n){var k=this.childrenList;var m;var j=k.length;for(m=0;m<j;m++){if(k[m]===n){return m}}return -1},removeChildAt:function(k){var i=this.childrenList;var j;if(-1!==k&&k>=0&&k<this.childrenList.length){i[k].setParent(null);j=i.splice(k,1);if(j[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled){CAAT.currentDirector.scheduleDirtyRect(j[0].AABB)}this.invalidateLayout();return j[0]}return null},removeChild:function(k){var j=this.findChild(k);var i=this.removeChildAt(j);return i},removeFirstChild:function(){var i=this.childrenList.shift();i.parent=null;if(i.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled){CAAT.currentDirector.scheduleDirtyRect(i.AABB)}this.invalidateLayout();return i},removeLastChild:function(){if(this.childrenList.length){var i=this.childrenList.pop();i.parent=null;if(i.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled){CAAT.currentDirector.scheduleDirtyRect(i.AABB)}this.invalidateLayout();return i}return null},findActorAtPosition:function(j){if(null===g.call(this,j)){return null}var k=this.childrenList;for(var n=k.length-1;n>=0;n--){var p=this.childrenList[n];var o=new CAAT.Math.Point(j.x,j.y,0);var m=p.findActorAtPosition(o);if(null!==m){return m}}return this},destroy:function(){var j=this.childrenList;for(var k=j.length-1;k>=0;k--){j[k].destroy()}b.call(this);return this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(i){return this.childrenList[i]},setZOrder:function(m,k){var n=this.findChild(m);if(-1!==n){var i=this.childrenList;if(k===n){return}if(k>=i.length){i.splice(n,1);i.push(m)}else{var j=i.splice(n,1);if(k<0){k=0}else{if(k>i.length){k=i.length}}i.splice(k,0,j[0])}this.invalidateLayout()}}}}});CAAT.Module({defines:"CAAT.Foundation.Scene",depends:["CAAT.Math.Point","CAAT.Math.Matrix","CAAT.PathUtil.Path","CAAT.Behavior.GenericBehavior","CAAT.Behavior.ContainerBehavior","CAAT.Behavior.ScaleBehavior","CAAT.Behavior.AlphaBehavior","CAAT.Behavior.RotateBehavior","CAAT.Behavior.PathBehavior","CAAT.Foundation.ActorContainer","CAAT.Foundation.Timer.TimerManager"],aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){this.__super();this.timerManager=new CAAT.TimerManager();this.fillStyle=null;this.isGlobalAlpha=true;return this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:false,paused:false,timerManager:null,isPaused:function(){return this.paused},setPaused:function(a){this.paused=a},createTimer:function(b,d,c,a,e){return this.timerManager.createTimer(b,d,c,a,e)},createAlphaBehaviour:function(c,b){var a=new CAAT.Behavior.AlphaBehavior();a.setFrameTime(0,c);a.startAlpha=b?0:1;a.endAlpha=b?1:0;this.easeContainerBehaviour.addBehavior(a)},easeTranslationIn:function(c,b,a,d){this.easeTranslation(c,b,a,true,d)},easeTranslationOut:function(c,b,a,d){this.easeTranslation(c,b,a,false,d)},easeTranslation:function(e,d,a,c,f){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior();this.easeIn=c;var b=new CAAT.Behavior.PathBehavior();if(f){b.setInterpolator(f)}b.setFrameTime(0,e);if(a<1){a=1}else{if(a>4){a=4}}switch(a){case CAAT.Foundation.Actor.ANCHOR_TOP:if(c){b.setPath(new CAAT.PathUtil.Path().setLinear(0,-this.height+1,0,0));this.setPosition(0,-this.height+1)}else{b.setPath(new CAAT.PathUtil.Path().setLinear(0,0,0,-this.height+1));this.setPosition(0,0)}break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:if(c){b.setPath(new CAAT.PathUtil.Path().setLinear(0,this.height-1,0,0));this.setPosition(0,this.height-1)}else{b.setPath(new CAAT.PathUtil.Path().setLinear(0,0,0,this.height-1));this.setPosition(0,0)}break;case CAAT.Foundation.Actor.ANCHOR_LEFT:if(c){b.setPath(new CAAT.PathUtil.Path().setLinear(-this.width+1,0,0,0));this.setPosition(-this.width+1,0)}else{b.setPath(new CAAT.PathUtil.Path().setLinear(0,0,-this.width+1,0));this.setPosition(0,0)}break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:if(c){b.setPath(new CAAT.PathUtil.Path().setLinear(this.width-1,0,0,0));this.setPosition(this.width-1,0)}else{b.setPath(new CAAT.PathUtil.Path().setLinear(0,0,this.width-1,0));this.setPosition(0,0)}break}if(d){this.createAlphaBehaviour(e,c)}this.easeContainerBehaviour.addBehavior(b);this.easeContainerBehaviour.setFrameTime(this.time,e);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(d,c,b,a,e){this.easeScale(d,c,b,a,true,e);this.easeIn=true},easeScaleOut:function(d,c,b,a,e){this.easeScale(d,c,b,a,false,e);this.easeIn=false},easeScale:function(m,b,c,f,e,g){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior();var k=0;var j=0;var a=0;var i=0;switch(f){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:a=1;i=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:k=1;a=1;j=0;i=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:j=1;i=1;k=0;a=1;break;default:alert("scale anchor ?? "+f)}if(!e){var d;d=k;k=a;a=d;d=j;j=i;i=d}if(c){this.createAlphaBehaviour(b,e)}var n=this.getAnchorPercent(f);var h=new CAAT.Behavior.ScaleBehavior().setFrameTime(m,b).setValues(k,a,j,i,n.x,n.y);if(g){h.setInterpolator(g)}this.easeContainerBehaviour.addBehavior(h);this.easeContainerBehaviour.setFrameTime(this.time,b);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(a){return this},easeRotationIn:function(c,b,a,d){this.easeRotation(c,b,a,true,d);this.easeIn=true},easeRotationOut:function(c,b,a,d){this.easeRotation(c,b,a,false,d);this.easeIn=false},easeRotation:function(c,d,h,f,i){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior();var b=0;var e=0;if(h==CAAT.Foundation.Actor.ANCHOR_CENTER){h=CAAT.Foundation.Actor.ANCHOR_TOP}switch(h){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:b=Math.PI*(Math.random()<0.5?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:b=Math.PI/2*(Math.random()<0.5?1:-1);break;default:alert("rot anchor ?? "+h)}if(false===f){var g=b;b=e;e=g}if(d){this.createAlphaBehaviour(c,f)}var j=this.getAnchorPercent(h);var a=new CAAT.Behavior.RotateBehavior().setFrameTime(0,c).setValues(b,e,j.x,j.y);if(i){a.setInterpolator(i)}this.easeContainerBehaviour.addBehavior(a);this.easeContainerBehaviour.setFrameTime(this.time,c);this.easeContainerBehaviour.addListener(this);this.emptyBehaviorList();CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(a){this.easeContainerBehaviourListener=a},behaviorExpired:function(a){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(a){this.expired=a},paint:function(b,c){if(this.fillStyle){var a=b.ctx;a.fillStyle=this.fillStyle;a.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(a){var d,c;var g=new CAAT.Math.Point();if(this.inputList){var b=this.inputList;for(d=0;d<b.length;d++){var e=b[d];for(c=0;c<e.length;c++){g.set(a.x,a.y);var f=e[c].worldModelViewMatrix.getInverse();f.transformCoord(g);if(e[c].contains(g.x,g.y)){return e[c]}}}}g.set(a.x,a.y);return CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,g)},enableInputList:function(b){this.inputList=[];for(var a=0;a<b;a++){this.inputList.push([])}return this},addActorToInputList:function(d,c,a){if(c<0){c=0}else{if(c>=this.inputList.length){c=this.inputList.length-1}}var b=this.inputList[c];if(typeof a==="undefined"||a>=b.length){b.push(d)}else{if(a<=0){b.unshift(d)}else{b.splice(a,0,d)}}return this},emptyInputList:function(a){if(a<0){a=0}else{if(a>=this.inputList.length){a=this.inputList.length-1}}this.inputList[a]=[];return this},removeActorFromInputList:function(e,c){if(typeof c==="undefined"){var d,b;for(d=0;d<this.inputList.length;d++){var a=this.inputList[d];for(b=0;b<a.length;b++){if(a[b]==e){a.splice(b,1)}}}return this}if(c<0){c=0}else{if(c>=this.inputList.length){c=this.inputList.length-1}}var a=this.inputList[c];for(b=0;b<a.length;b++){if(a[b]==e){a.splice(b,1)}}return this},getIn:function(a){},goOut:function(a){}}}});CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Core.Class","CAAT.Core.Constants","CAAT.Foundation.ActorContainer","CAAT.Module.Audio.AudioManager","CAAT.Module.Runtime.BrowserInfo","CAAT.Module.Debug.Debug","CAAT.Math.Point","CAAT.Math.Rectangle","CAAT.Math.Matrix","CAAT.Foundation.Timer.TimerManager","CAAT.Foundation.Actor","CAAT.Foundation.Scene","CAAT.Event.AnimationLoop","CAAT.Event.Input","CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent","CAAT.WebGL.Program","CAAT.WebGL.ColorProgram","CAAT.WebGL.TextureProgram","CAAT.WebGL.GLU","CAAT.Module.TexturePacker.TexturePageManager"],constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:true,CLEAR_NONE:false,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super();this.browserInfo=CAAT.Module.Runtime.BrowserInfo;this.audioManager=new CAAT.Module.Audio.AudioManager().initialize(8);this.scenes=[];this.mousePoint=new CAAT.Math.Point(0,0,0);this.prevMousePoint=new CAAT.Math.Point(0,0,0);this.screenMousePoint=new CAAT.Math.Point(0,0,0);this.isMouseDown=false;this.lastSelectedActor=null;this.dragging=false;this.cDirtyRects=[];this.sDirtyRects=[];this.dirtyRects=[];for(var a=0;a<64;a++){this.dirtyRects.push(new CAAT.Math.Rectangle())}this.dirtyRectsIndex=0;this.touches={};this.timerManager=new CAAT.Foundation.Timer.TimerManager();this.__map={};return this},debug:false,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:false,lastSelectedActor:null,dragging:false,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:false,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:false,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:false,nDirtyRects:0,drDiscarded:0,stopped:false,needsRepaint:false,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){this.scenes=null;this.currentScene=null;this.imagesCache=null;this.audioManager=null;this.isMouseDown=false;this.lastSelectedActor=null;this.dragging=false;this.__gestureScale=0;this.__gestureRotation=0;this.dirty=true;this.dirtyRects=null;this.cDirtyRects=null;this.dirtyRectsIndex=0;this.dirtyRectsEnabled=false;this.nDirtyRects=0;this.onResizeCallback=null;this.__map={};return this},setValueForKey:function(a,b){this.__map[a]=b;return this},getValueForKey:function(a){return this.__map[a];return this},createTimer:function(b,d,c,a,e){this.timerManager.createTimer(b,d,c,a,e);return this},requestRepaint:function(){this.needsRepaint=true},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var a=new CAAT.Module.Debug.Debug().initialize(this.width,60);this.debugInfo=a.debugInfo.bind(a)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(a,b){var d=CAAT.Foundation.Director;switch(this.resize){case d.RESIZE_WIDTH:this.setBounds(0,0,a,this.height);break;case d.RESIZE_HEIGHT:this.setBounds(0,0,this.width,b);break;case d.RESIZE_BOTH:this.setBounds(0,0,a,b);break;case d.RESIZE_PROPORTIONAL:this.setScaleProportional(a,b);break}if(this.glEnabled){this.glReset()}if(this.onResizeCallback){this.onResizeCallback(this,a,b)}},setScaleProportional:function(a,c){var b=Math.min(a/this.referenceWidth,c/this.referenceHeight);this.canvas.width=this.referenceWidth*b;this.canvas.height=this.referenceHeight*b;this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.__setupRetina();this.setScaleAnchored(b*this.scaleX,b*this.scaleY,0,0);if(this.glEnabled){this.glReset()}},enableResizeEvents:function(c,b){var a=CAAT.Foundation.Director;if(c===a.RESIZE_BOTH||c===a.RESIZE_WIDTH||c===a.RESIZE_HEIGHT||c===a.RESIZE_PROPORTIONAL){this.referenceWidth=this.width;this.referenceHeight=this.height;this.resize=c;CAAT.registerResizeListener(this);this.onResizeCallback=b;this.windowResized(window.innerWidth,window.innerHeight)}else{CAAT.unregisterResizeListener(this);this.onResizeCallback=null}return this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var a=CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio;var e=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;var d=a/e;if(a!==e){var b=this.canvas.width;var f=this.canvas.height;this.canvas.width=b*d;this.canvas.height=f*d;this.canvas.style.width=b+"px";this.canvas.style.height=f+"px";this.setScaleAnchored(d,d,0,0)}else{this.setScaleAnchored(1,1,0,0)}this.SCREEN_RATIO=d}else{this.setScaleAnchored(1,1,0,0)}for(var c=0;c<this.scenes.length;c++){this.scenes[c].setBounds(0,0,this.width,this.height)}},setBounds:function(a,d,b,c){CAAT.Foundation.Director.superclass.setBounds.call(this,a,d,b,c);if(this.canvas.width!==b){this.canvas.width=b}if(this.canvas.height!==c){this.canvas.height=c}this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d");this.__setupRetina();if(this.glEnabled){this.glReset()}return this},initialize:function(e,a,c,d){if(typeof c!=="undefined"){if(isString(c)){c=document.getElementById(c)}else{if(!(c instanceof HTMLCanvasElement)){console.log("Canvas is a: "+c+" ???")}}}if(!c){c=document.createElement("canvas");document.body.appendChild(c)}this.canvas=c;if(typeof d==="undefined"){d=c}this.setBounds(0,0,e,a);this.enableEvents(d);this.timeline=new Date().getTime();this.transitionScene=new CAAT.Foundation.Scene().setBounds(0,0,e,a);var f=document.createElement("canvas");f.width=e;f.height=a;var b=new CAAT.Foundation.Actor().setBackgroundImage(f);this.transitionScene.ctx=f.getContext("2d");this.transitionScene.addChildImmediately(b);this.transitionScene.setEaseListener(this);this.checkDebug();return this},glReset:function(){this.pMatrix=makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1);this.gl.viewport(0,0,this.canvas.width,this.canvas.height);this.glColorProgram.setMatrixUniform(this.pMatrix);this.glTextureProgram.setMatrixUniform(this.pMatrix);this.gl.viewportWidth=this.canvas.width;this.gl.viewportHeight=this.canvas.height},initializeGL:function(g,b,c,f){if(!c){c=document.createElement("canvas");document.body.appendChild(c)}c.width=g;c.height=b;if(typeof f==="undefined"){f=c}this.referenceWidth=g;this.referenceHeight=b;var d;try{this.gl=c.getContext("experimental-webgl");this.gl.viewportWidth=g;this.gl.viewportHeight=b;CAAT.GLRENDER=true}catch(h){}if(this.gl){this.canvas=c;this.setBounds(0,0,g,b);this.enableEvents(c);this.timeline=new Date().getTime();this.glColorProgram=new CAAT.WebGL.ColorProgram(this.gl).create().initialize();this.glTextureProgram=new CAAT.WebGL.TextureProgram(this.gl).create().initialize();this.glTextureProgram.useProgram();this.glReset();var a=512;this.coords=new Float32Array(a*12);this.uv=new Float32Array(a*8);this.gl.clearColor(0,0,0,255);if(this.front_to_back){this.gl.clearDepth(1);this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LESS)}else{this.gl.disable(this.gl.DEPTH_TEST)}this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this.glEnabled=true;this.checkDebug()}else{return this.initialize(g,b,c)}return this},createScene:function(){var a=new CAAT.Scene();this.addScene(a);return a},setImagesCache:function(e,a,d){var b;if(null!==this.glTextureManager){this.glTextureManager.deletePages();this.glTextureManager=null}if(this.imagesCache){var c=[];for(b=0;b<this.imagesCache.length;b++){c.push(this.imagesCache[b].id)}for(b=0;b<c.length;b++){delete this.imagesCache[c[b]]}}this.imagesCache=e;if(e){for(b=0;b<e.length;b++){this.imagesCache[e[b].id]=e[b].image}}this.tpW=a||2048;this.tpH=d||2048;this.updateGLPages();return this},updateGLPages:function(){if(this.glEnabled){this.glTextureManager=new CAAT.Module.TexturePacker.TexturePageManager();this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache);this.currentTexturePage=this.glTextureManager.pages[0];this.glTextureProgram.setTexture(this.currentTexturePage.texture)}},setGLTexturePage:function(a){this.currentTexturePage=a;this.glTextureProgram.setTexture(a.texture);return this},addImage:function(d,c,b){if(this.getImage(d)){for(var a=0;a<this.imagesCache.length;a++){if(this.imagesCache[a].id===d){this.imagesCache[a].image=c;break}}this.imagesCache[d]=c}else{this.imagesCache.push({id:d,image:c});this.imagesCache[d]=c}if(!!!b){this.updateGLPages()}},deleteImage:function(c,b){for(var a=0;a<this.imagesCache.length;a++){if(this.imagesCache[a].id===c){delete this.imagesCache[c];this.imagesCache.splice(a,1);break}}if(!!!b){this.updateGLPages()}},setGLCurrentOpacity:function(a){this.currentOpacity=a;this.glTextureProgram.setAlpha(a)},glRender:function(e,d,b){e=e||this.coords;b=b||this.uv;d=d||this.coordsIndex;var f=this.gl;var c=d/12*2;var a=d/3;this.glTextureProgram.updateVertexBuffer(e);this.glTextureProgram.updateUVBuffer(b);f.drawElements(f.TRIANGLES,3*c,f.UNSIGNED_SHORT,0)},glFlush:function(){if(this.coordsIndex!==0){this.glRender(this.coords,this.coordsIndex,this.uv)}this.coordsIndex=0;this.uvIndex=0;this.statistics.draws++},findActorAtPosition:function(a){var b=this.childrenList;for(var d=b.length-1;d>=0;d--){var f=this.childrenList[d];var e=new CAAT.Math.Point(a.x,a.y,0);var c=f.findActorAtPosition(e);if(null!==c){return c}}return this},resetStats:function(){this.statistics.size_total=0;this.statistics.size_active=0;this.statistics.draws=0;this.statistics.size_discarded_by_dirty_rects=0},render:function(g){if(this.currentScene&&this.currentScene.isPaused()){return}this.time+=g;for(b=0,l=this.childrenList.length;b<l;b++){var j=this.childrenList[b];if(j.isInAnimationFrame(this.time)&&!j.isPaused()){var d=j.time-j.start_time;j.timerManager.checkTimers(d);j.timerManager.removeExpiredTimers()}}this.animate(this,this.time);if(!navigator.isCocoonJS&&CAAT.DEBUG){this.resetStats()}var f=this.childrenList.length;var b,d,j;var a=this.ctx;if(this.glEnabled){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.coordsIndex=0;this.uvIndex=0;for(b=0;b<f;b++){j=this.childrenList[b];if(j.isInAnimationFrame(this.time)){d=j.time-j.start_time;if(j.onRenderStart){j.onRenderStart(d)}j.paintActorGL(this,d);if(j.onRenderEnd){j.onRenderEnd(d)}if(!j.isPaused()){j.time+=g}if(!navigator.isCocoonJS&&CAAT.DEBUG){this.statistics.size_total+=j.size_total;this.statistics.size_active+=j.size_active}}}this.glFlush()}else{a.globalAlpha=1;a.globalCompositeOperation="source-over";a.save();if(this.dirtyRectsEnabled){this.modelViewMatrix.transformRenderingContext(a);if(!CAAT.DEBUG_DIRTYRECTS){a.beginPath();this.nDirtyRects=0;var e=this.cDirtyRects;for(b=0;b<e.length;b++){var h=e[b];if(!h.isEmpty()){a.rect(h.x|0,h.y|0,1+(h.width|0),1+(h.height|0));this.nDirtyRects++}}a.clip()}else{a.clearRect(0,0,this.canvas.width,this.canvas.height)}}else{if(this.clear===CAAT.Foundation.Director.CLEAR_ALL){a.clearRect(0,0,this.canvas.width,this.canvas.height)}}for(b=0;b<f;b++){j=this.childrenList[b];if(j.isInAnimationFrame(this.time)){d=j.time-j.start_time;a.save();if(j.onRenderStart){j.onRenderStart(d)}if(!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled){if(this.nDirtyRects){j.paintActor(this,d)}}else{j.paintActor(this,d)}if(j.onRenderEnd){j.onRenderEnd(d)}a.restore();if(CAAT.DEBUGAABB){a.globalAlpha=1;a.globalCompositeOperation="source-over";this.modelViewMatrix.transformRenderingContextSet(a);j.drawScreenBoundingBox(this,d)}if(!j.isPaused()){j.time+=g}if(!navigator.isCocoonJS&&CAAT.DEBUG){this.statistics.size_total+=j.size_total;this.statistics.size_active+=j.size_active;this.statistics.size_dirtyRects=this.nDirtyRects}}}if(this.nDirtyRects>0&&(!navigator.isCocoonJS&&CAAT.DEBUG)&&CAAT.DEBUG_DIRTYRECTS){a.beginPath();this.nDirtyRects=0;var e=this.cDirtyRects;for(b=0;b<e.length;b++){var h=e[b];if(!h.isEmpty()){a.rect(h.x|0,h.y|0,1+(h.width|0),1+(h.height|0));this.nDirtyRects++}}a.clip();a.fillStyle="rgba(160,255,150,.4)";a.fillRect(0,0,this.canvas.width,this.canvas.height)}a.restore()}this.frameCounter++},inDirtyRect:function(c){if(!this.dirtyRectsEnabled||CAAT.DEBUG_DIRTYRECTS){return true}var d=this.cDirtyRects;var b;var a=c.AABB;for(b=0;b<d.length;b++){if(d[b].intersects(a)){return true}}this.statistics.size_discarded_by_dirty_rects+=c.size_total;return false},animate:function(d,g){this.timerManager.checkTimers(g);this.setModelViewMatrix(this);this.modelViewMatrixI=this.modelViewMatrix.getInverse();this.setScreenBounds();this.dirty=false;this.invalid=false;this.dirtyRectsIndex=-1;this.cDirtyRects=[];var c=this.childrenList;var a;var e,b;if(this.dirtyRectsEnabled){var h=this.sDirtyRects;if(h.length){for(e=0,b=h.length;e<b;e++){this.addDirtyRect(h[e])}this.sDirtyRects=[]}}for(e=0;e<c.length;e++){a=c[e];var f=a.time-a.start_time;a.animate(this,f)}this.timerManager.removeExpiredTimers();return this},scheduleDirtyRect:function(a){this.sDirtyRects.push(a)},addDirtyRect:function(c){if(c.isEmpty()){return}var b,h,a,f;var g=this.cDirtyRects;for(b=0;b<g.length;b++){h=g[b];if(!h.isEmpty()&&h.intersects(c)){var d=true;while(d){h.unionRectangle(c);for(a=0;a<g.length;a++){if(a!==b){f=g[a];if(!f.isEmpty()&&f.intersects(h)){h.unionRectangle(f);f.setEmpty();break}}}if(a==g.length){d=false}}for(a=0;a<g.length;a++){if(g[a].isEmpty()){g.splice(a,1)}}return}}this.dirtyRectsIndex++;if(this.dirtyRectsIndex>=this.dirtyRects.length){for(b=0;b<32;b++){this.dirtyRects.push(new CAAT.Math.Rectangle())}}var e=this.dirtyRects[this.dirtyRectsIndex];e.x=c.x;e.y=c.y;e.x1=c.x1;e.y1=c.y1;e.width=c.width;e.height=c.height;this.cDirtyRects.push(e)},renderToContext:function(a,c){if(c.isInAnimationFrame(this.time)){a.setTransform(1,0,0,1,0,0);a.globalAlpha=1;a.globalCompositeOperation="source-over";a.clearRect(0,0,this.width,this.height);var e=this.ctx;this.ctx=a;a.save();var d=this.modelViewMatrix;var b=this.worldModelViewMatrix;this.worldModelViewMatrix=new CAAT.Math.Matrix();this.modelViewMatrix=this.worldModelViewMatrix;this.wdirty=true;c.animate(this,c.time);if(c.onRenderStart){c.onRenderStart(c.time)}c.paintActor(this,c.time);if(c.onRenderEnd){c.onRenderEnd(c.time)}this.worldModelViewMatrix=b;this.modelViewMatrix=d;a.restore();this.ctx=e}},addScene:function(a){a.setBounds(0,0,this.width,this.height);this.scenes.push(a);a.setEaseListener(this);if(null===this.currentScene){this.setScene(0)}},getNumScenes:function(){return this.scenes.length},easeInOut:function(b,i,d,c,f,m,e,g,a,k){if(b===this.getCurrentSceneIndex()){return}var j=this.scenes[b];var h=this.scenes[c];if(!CAAT.__CSS__&&!this.glEnabled){this.renderToContext(this.transitionScene.ctx,h);h=this.transitionScene}j.setExpired(false);h.setExpired(false);j.mouseEnabled=false;h.mouseEnabled=false;j.resetTransform();h.resetTransform();j.setLocation(0,0);h.setLocation(0,0);j.alpha=1;h.alpha=1;if(i===CAAT.Foundation.Scene.EASE_ROTATION){j.easeRotationIn(e,g,d,a)}else{if(i===CAAT.Foundation.Scene.EASE_SCALE){j.easeScaleIn(0,e,g,d,a)}else{j.easeTranslationIn(e,g,d,a)}}if(f===CAAT.Foundation.Scene.EASE_ROTATION){h.easeRotationOut(e,g,m,k)}else{if(f===CAAT.Foundation.Scene.EASE_SCALE){h.easeScaleOut(0,e,g,m,k)}else{h.easeTranslationOut(e,g,m,k)}}this.childrenList=[];h.goOut(j);j.getIn(h);this.addChild(h);this.addChild(j)},easeInOutRandom:function(j,g,d,e){var b=Math.random();var c=Math.random();var h;var a;if(b<0.33){h=CAAT.Foundation.Scene.EASE_ROTATION;a=new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(4)}else{if(b<0.66){h=CAAT.Foundation.Scene.EASE_SCALE;a=new CAAT.Behavior.Interpolator().createElasticOutInterpolator(1.1,0.4)}else{h=CAAT.Foundation.Scene.EASE_TRANSLATE;a=new CAAT.Behavior.Interpolator().createBounceOutInterpolator()}}var f;var i;if(c<0.33){f=CAAT.Foundation.Scene.EASE_ROTATION;i=new CAAT.Behavior.Interpolator().createExponentialInOutInterpolator(4)}else{if(c<0.66){f=CAAT.Foundation.Scene.EASE_SCALE;i=new CAAT.Behavior.Interpolator().createExponentialOutInterpolator(4)}else{f=CAAT.Foundation.Scene.EASE_TRANSLATE;i=new CAAT.Behavior.Interpolator().createBounceOutInterpolator()}}this.easeInOut(j,h,(Math.random()*8.99)>>0,g,f,(Math.random()*8.99)>>0,d,e,a,i)},easeIn:function(c,d,f,e,b,g){var a=this.scenes[c];if(d===CAAT.Foundation.Scene.EASE_ROTATION){a.easeRotationIn(f,e,b,g)}else{if(d===CAAT.Foundation.Scene.EASE_SCALE){a.easeScaleIn(0,f,e,b,g)}else{a.easeTranslationIn(f,e,b,g)}}this.childrenList=[];this.addChild(a);a.resetTransform();a.setLocation(0,0);a.alpha=1;a.mouseEnabled=false;a.setExpired(false)},setScene:function(b){var a=this.scenes[b];this.childrenList=[];this.addChild(a);this.currentScene=a;a.setExpired(false);a.mouseEnabled=true;a.resetTransform();a.setLocation(0,0);a.alpha=1;a.getIn();a.activated()},switchToScene:function(d,c,b,e){var a=this.getSceneIndex(this.currentScene);if(!e){this.setScene(d)}else{this.easeInOutRandom(d,a,c,b)}},switchToPrevScene:function(c,b,d){var a=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||a===0){return}if(!d){this.setScene(a-1)}else{this.easeInOutRandom(a-1,a,c,b)}},switchToNextScene:function(c,b,d){var a=this.getSceneIndex(this.currentScene);if(this.getNumScenes()<=1||a===this.getNumScenes()-1){return}if(!d){this.setScene(a+1)}else{this.easeInOutRandom(a+1,a,c,b)}},mouseEnter:function(a){},mouseExit:function(a){},mouseMove:function(a){},mouseDown:function(a){},mouseUp:function(a){},mouseDrag:function(a){},easeEnd:function(b,a){if(!a){b.setExpired(true)}else{this.currentScene=b;this.currentScene.activated()}b.mouseEnabled=true;b.emptyBehaviorList()},getSceneIndex:function(b){for(var a=0;a<this.scenes.length;a++){if(this.scenes[a]===b){return a}}return -1},getScene:function(a){return this.scenes[a]},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(b){var a=this.imagesCache[b];if(a){return a}for(var c=0;c<this.imagesCache.length;c++){if(this.imagesCache[c].id===b){return this.imagesCache[c].image}}return null},musicPlay:function(a){this.audioManager.playMusic(a)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(b,a){this.audioManager.addAudio(b,a);return this},audioPlay:function(a){this.audioManager.play(a)},audioLoop:function(a){return this.audioManager.loop(a)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(a){return this.audioManager.setSoundEffectsEnabled(a)},setMusicEnabled:function(a){return this.audioManager.setMusicEnabled(a)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(b,a){return this.audioManager.setVolume(b,a)},emptyScenes:function(){this.scenes=[]},addChild:function(a){a.parent=this;this.childrenList.push(a)},loop:function(b,c,a){if(a){this.onRenderStart=c;this.onRenderEnd=a}else{if(c){this.onRenderEnd=c}}CAAT.loop()},renderFrame:function(){CAAT.currentDirector=this;if(this.stopped){return}var a=new Date().getTime(),b=a-this.timeline;if(b>500){b=500}if(this.onRenderStart){this.onRenderStart(b)}this.render(b);if(this.debugInfo){this.debugInfo(this.statistics)}this.timeline=a;if(this.onRenderEnd){this.onRenderEnd(b)}this.needsRepaint=false},resetTimeline:function(){this.timeline=new Date().getTime()},endLoop:function(){},setClear:function(a){this.clear=a;if(this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS){this.dirtyRectsEnabled=true}else{this.dirtyRectsEnabled=false}return this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(d,c,h){var f=h+"Left";var e=h+"Top";var a=0,g=0,b;while(navigator.browser!=="iOS"&&d&&d.style){if(d.currentStyle){b=d.currentStyle.position}else{b=(d.ownerDocument.defaultView||d.ownerDocument.parentWindow).getComputedStyle(d,null);b=b?b.getPropertyValue("position"):null}if(!/^(fixed)$/.test(b)){a+=d[f];g+=d[e];d=d[c]}else{break}}return{x:a,y:g,style:b}},getOffset:function(c){var a=this.cumulateOffset(c,"offsetParent","offset");if(a.style==="fixed"){var b=this.cumulateOffset(c,c.parentNode?"parentNode":"parentElement","scroll");return{x:a.x+b.x,y:a.y+b.y}}return{x:a.x,y:a.y}},getCanvasCoord:function(b,d){var c=new CAAT.Math.Point();var a=0;var g=0;if(!d){d=window.event}if(d.pageX||d.pageY){a=d.pageX;g=d.pageY}else{if(d.clientX||d.clientY){a=d.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;g=d.clientY+document.body.scrollTop+document.documentElement.scrollTop}}var f=this.getOffset(this.canvas);a-=f.x;g-=f.y;a*=this.SCREEN_RATIO;g*=this.SCREEN_RATIO;c.x=a;c.y=g;if(!this.modelViewMatrixI){this.modelViewMatrixI=this.modelViewMatrix.getInverse()}this.modelViewMatrixI.transformCoord(c);a=c.x;g=c.y;b.set(a,g);this.screenMousePoint.set(a,g)},__mouseDownHandler:function(a){if(this.dragging&&this.lastSelectedActor){this.__mouseUpHandler(a);return}this.getCanvasCoord(this.mousePoint,a);this.isMouseDown=true;var b=this.findActorAtPosition(this.mousePoint);if(null!==b){var c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));b.mouseDown(new CAAT.Event.MouseEvent().init(c.x,c.y,a,b,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=b},__mouseUpHandler:function(a){this.isMouseDown=false;this.getCanvasCoord(this.mousePoint,a);var c=null;var b=this.lastSelectedActor;if(null!==b){c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(b.actionPerformed&&b.contains(c.x,c.y)){b.actionPerformed(a)}b.mouseUp(new CAAT.Event.MouseEvent().init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene?this.currentScene.time:0))}if(!this.dragging&&null!==b){if(b.contains(c.x,c.y)){b.mouseClick(new CAAT.Event.MouseEvent().init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene?this.currentScene.time:0))}}this.dragging=false;this.in_=false},__mouseMoveHandler:function(f){var g;var h;var d=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){g=this.lastSelectedActor;h=g.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(!this.dragging){if(Math.abs(this.prevMousePoint.x-h.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(this.prevMousePoint.y-h.y)<CAAT.DRAG_THRESHOLD_Y){return}}this.dragging=true;var c=g.x;var a=g.y;g.mouseDrag(new CAAT.Event.MouseEvent().init(h.x,h.y,f,g,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),d));this.prevMousePoint.x=h.x;this.prevMousePoint.y=h.y;if(c===g.x&&a===g.y){var b=g.contains(h.x,h.y);if(this.in_&&!b){g.mouseExit(new CAAT.Event.MouseEvent().init(h.x,h.y,f,g,this.screenMousePoint,d));this.in_=false}if(!this.in_&&b){g.mouseEnter(new CAAT.Event.MouseEvent().init(h.x,h.y,f,g,this.screenMousePoint,d));this.in_=true}}return}this.in_=true;g=this.findActorAtPosition(this.mousePoint);if(g!==this.lastSelectedActor){if(null!==this.lastSelectedActor){h=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));this.lastSelectedActor.mouseExit(new CAAT.Event.MouseEvent().init(h.x,h.y,f,this.lastSelectedActor,this.screenMousePoint,d))}if(null!==g){h=g.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));g.mouseEnter(new CAAT.Event.MouseEvent().init(h.x,h.y,f,g,this.screenMousePoint,d))}}h=g.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));if(null!==g){g.mouseMove(new CAAT.Event.MouseEvent().init(h.x,h.y,f,g,this.screenMousePoint,d))}this.prevMousePoint.x=h.x;this.prevMousePoint.y=h.y;this.lastSelectedActor=g},__mouseOutHandler:function(b){if(this.dragging){return}if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,b);var c=new CAAT.Math.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(c);var a=new CAAT.Event.MouseEvent().init(c.x,c.y,b,this.lastSelectedActor,this.screenMousePoint,this.currentScene?this.currentScene.time:0);this.lastSelectedActor.mouseExit(a);this.lastSelectedActor.mouseOut(a);if(!this.dragging){this.lastSelectedActor=null}}else{this.isMouseDown=false;this.in_=false}},__mouseOverHandler:function(b){if(this.dragging){return}var c;var d,a;if(null==this.lastSelectedActor){c=this.findActorAtPosition(this.mousePoint);if(null!==c){d=c.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));a=new CAAT.Event.MouseEvent().init(d.x,d.y,b,c,this.screenMousePoint,this.currentScene?this.currentScene.time:0);c.mouseOver(a);c.mouseEnter(a)}this.lastSelectedActor=c}else{c=this.lastSelectedActor;d=c.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));a=new CAAT.Event.MouseEvent().init(d.x,d.y,b,c,this.screenMousePoint,this.currentScene?this.currentScene.time:0);c.mouseOver(a);c.mouseEnter(a)}},__mouseDBLClickHandler:function(a){this.getCanvasCoord(this.mousePoint,a);if(null!==this.lastSelectedActor){this.lastSelectedActor.mouseDblClick(new CAAT.Event.MouseEvent().init(this.mousePoint.x,this.mousePoint.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene?this.currentScene.time:0))}},__touchStartHandler:function(b){if(b.target===this.canvas){b.preventDefault();b=b.targetTouches[0];var a=this.mousePoint;this.getCanvasCoord(a,b);if(a.x<0||a.y<0||a.x>=this.width||a.y>=this.height){return}this.touching=true;this.__mouseDownHandler(b)}},__touchEndHandler:function(b){if(this.touching){b.preventDefault();b=b.changedTouches[0];var a=this.mousePoint;this.getCanvasCoord(a,b);this.touching=false;this.__mouseUpHandler(b)}},__touchMoveHandler:function(d){if(this.touching){d.preventDefault();if(this.gesturing){return}for(var b=0;b<d.targetTouches.length;b++){var a=d.targetTouches[b];var c=this.mousePoint;this.getCanvasCoord(c,a);this.__mouseMoveHandler(a)}}},__gestureStart:function(b,a){this.gesturing=true;this.__gestureRotation=this.lastSelectedActor.rotationAngle;this.__gestureSX=this.lastSelectedActor.scaleX-1;this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(b,a){if(typeof b==="undefined"||typeof a==="undefined"){return}if(this.lastSelectedActor!==null&&this.lastSelectedActor.isGestureEnabled()){this.lastSelectedActor.setRotation(a*Math.PI/180+this.__gestureRotation);this.lastSelectedActor.setScale(this.__gestureSX+b,this.__gestureSY+b)}},__gestureEnd:function(b,a){this.gesturing=false;this.__gestureRotation=0;this.__gestureScale=0},__touchEndHandlerMT:function(n){n.preventDefault();var k,f;var s=[];for(k=0;k<n.changedTouches.length;k++){var o=n.changedTouches[k];var b=o.identifier;s.push(b)}var d={};for(k=0;k<s.length;k++){var q=s[k];if(this.touches[q]){var c=this.touches[q].actor;if(!d[c.id]){d[c.id]={actor:c,touch:new CAAT.Event.TouchEvent().init(n,c,this.currentScene&&this.currentScene.time)}}var p=d[c.id].touch;p.addChangedTouch(this.touches[q].touch)}}for(k=0;k<n.changedTouches.length;k++){var h=n.changedTouches[k];var b=h.identifier;delete this.touches[b]}for(var a in d){var g=d[a];var c=g.actor;var h=g.touch;for(var r in this.touches){var m=this.touches[r];if(m.actor.id===c.id){h.addTouch(m.touch)}}c.touchEnd(h)}},__touchMoveHandlerMT:function(m){m.preventDefault();var j;var q=[];for(j=0;j<m.changedTouches.length;j++){var h=m.changedTouches[j];var b=h.identifier;if(this.touches[b]){var c=this.mousePoint;this.getCanvasCoord(c,h);var f=this.touches[b].actor;c=f.viewToModel(c);this.touches[b]={actor:f,touch:new CAAT.Event.TouchInfo(b,c.x,c.y,f)};q.push(b)}}var d={};for(j=0;j<q.length;j++){var o=q[j];var f=this.touches[o].actor;if(!d[f.id]){d[f.id]={actor:f,touch:new CAAT.Event.TouchEvent().init(m,f,this.currentScene&&this.currentScene.time)}}var n=d[f.id].touch;n.addTouch(this.touches[o].touch);n.addChangedTouch(this.touches[o].touch)}for(var a in d){var g=d[a];var f=g.actor;var h=g.touch;for(var p in this.touches){var k=this.touches[p];if(k.actor.id===f.id){h.addTouch(k.touch)}}f.touchMove(h)}},__touchCancelHandleMT:function(a){this.__touchEndHandlerMT(a)},__touchStartHandlerMT:function(n){n.preventDefault();var j;var r=[];var k=true;for(j=0;j<n.changedTouches.length;j++){var h=n.changedTouches[j];var b=h.identifier;var c=this.mousePoint;this.getCanvasCoord(c,h);if(c.x<0||c.y<0||c.x>=this.width||c.y>=this.height){k=false;continue}var f=this.findActorAtPosition(c);if(f!==null){c=f.viewToModel(c);if(!this.touches[b]){this.touches[b]={actor:f,touch:new CAAT.Event.TouchInfo(b,c.x,c.y,f)};r.push(b)}}}var d={};for(j=0;j<r.length;j++){var p=r[j];var f=this.touches[p].actor;if(!d[f.id]){d[f.id]={actor:f,touch:new CAAT.Event.TouchEvent().init(n,f,this.currentScene&&this.currentScene.time)}}var o=d[f.id].touch;o.addTouch(this.touches[p].touch);o.addChangedTouch(this.touches[p].touch)}for(var a in d){var g=d[a];var f=g.actor;var h=g.touch;for(var q in this.touches){var m=this.touches[q];if(m.actor.id===f.id){h.addTouch(m.touch)}}f.touchStart(h)}},__findTouchFirstActor:function(){var a=Number.MAX_VALUE;var b=null;for(var d in this.touches){var c=this.touches[d];if(c.touch.time&&c.touch.time<a&&c.actor.isGestureEnabled()){b=c.actor;a=c.touch.time}}return b},__gesturedActor:null,__touchGestureStartHandleMT:function(b){var a=this.__findTouchFirstActor();if(a!==null&&a.isGestureEnabled()){this.__gesturedActor=a;this.__gestureRotation=a.rotationAngle;this.__gestureSX=a.scaleX-1;this.__gestureSY=a.scaleY-1;a.gestureStart(b.rotation*Math.PI/180,b.scale+this.__gestureSX,b.scale+this.__gestureSY)}},__touchGestureEndHandleMT:function(a){if(null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()){this.__gesturedActor.gestureEnd(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY)}this.__gestureRotation=0;this.__gestureScale=0},__touchGestureChangeHandleMT:function(a){if(this.__gesturedActor!==null&&this.__gesturedActor.isGestureEnabled()){this.__gesturedActor.gestureChange(a.rotation*Math.PI/180,this.__gestureSX+a.scale,this.__gestureSY+a.scale)}},addHandlers:function(a){var b=this;CAAT.bindEvent(window,"mouseup",function(d){if(b.touching){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);b.__mouseUpHandler(d);b.touching=false}},false);CAAT.bindEvent(window,"mousedown",function(d){if(d.target===a){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);if(c.x<0||c.y<0||c.x>=b.width||c.y>=b.height){return}b.touching=true;b.__mouseDownHandler(d)}},false);CAAT.bindEvent(window,"mouseover",function(d){if(d.target===a&&!b.dragging){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);if(c.x<0||c.y<0||c.x>=b.width||c.y>=b.height){return}b.__mouseOverHandler(d)}},false);CAAT.bindEvent(window,"mouseout",function(d){if(d.target===a&&!b.dragging){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);b.__mouseOutHandler(d)}},false);CAAT.bindEvent(window,"mousemove",function(d){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);if(!b.dragging&&(c.x<0||c.y<0||c.x>=b.width||c.y>=b.height)){return}b.__mouseMoveHandler(d)},false);CAAT.bindEvent(window,"dblclick",function(d){if(d.target===a){d.preventDefault();d.cancelBubble=true;if(d.stopPropagation){d.stopPropagation()}var c=b.mousePoint;b.getCanvasCoord(c,d);if(c.x<0||c.y<0||c.x>=b.width||c.y>=b.height){return}b.__mouseDBLClickHandler(d)}},false);if(CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE){CAAT.bindEvent(a,"touchstart",this.__touchStartHandler.bind(this),false);CAAT.bindEvent(a,"touchmove",this.__touchMoveHandler.bind(this),false);CAAT.bindEvent(a,"touchend",this.__touchEndHandler.bind(this),false);CAAT.bindEvent(a,"gesturestart",function(c){if(c.target===a){c.preventDefault();b.__gestureStart(c.scale,c.rotation)}},false);CAAT.bindEvent(a,"gestureend",function(c){if(c.target===a){c.preventDefault();b.__gestureEnd(c.scale,c.rotation)}},false);CAAT.bindEvent(a,"gesturechange",function(c){if(c.target===a){c.preventDefault();b.__gestureChange(c.scale,c.rotation)}},false)}else{if(CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH){CAAT.bindEvent(a,"touchstart",this.__touchStartHandlerMT.bind(this),false);CAAT.bindEvent(a,"touchmove",this.__touchMoveHandlerMT.bind(this),false);CAAT.bindEvent(a,"touchend",this.__touchEndHandlerMT.bind(this),false);CAAT.bindEvent(a,"touchcancel",this.__touchCancelHandleMT.bind(this),false);CAAT.bindEvent(a,"gesturestart",this.__touchGestureStartHandleMT.bind(this),false);CAAT.bindEvent(a,"gestureend",this.__touchGestureEndHandleMT.bind(this),false);CAAT.bindEvent(a,"gesturechange",this.__touchGestureChangeHandleMT.bind(this),false)}}},enableEvents:function(a){CAAT.RegisterDirector(this);this.in_=false;this.createEventHandler(a)},createEventHandler:function(a){this.in_=false;this.addHandlers(a)}}},onCreate:function(){if(typeof CAAT.__CSS__!=="undefined"){CAAT.Foundation.Director.prototype.clip=true;CAAT.Foundation.Director.prototype.glEnabled=false;CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"};CAAT.Foundation.Director.prototype.setScaleProportional=function(a,c){var b=Math.min(a/this.referenceWidth,c/this.referenceHeight);this.setScaleAnchored(b,b,0,0);this.eventHandler.style.width=""+this.referenceWidth+"px";this.eventHandler.style.height=""+this.referenceHeight+"px"};CAAT.Foundation.Director.prototype.setBounds=function(a,e,b,d){CAAT.Foundation.Director.superclass.setBounds.call(this,a,e,b,d);for(var c=0;c<this.scenes.length;c++){this.scenes[c].setBounds(0,0,b,d)}this.eventHandler.style.width=b+"px";this.eventHandler.style.height=d+"px";return this};CAAT.Foundation.Director.prototype.initialize=function(c,a,d,b){this.timeline=new Date().getTime();this.domElement=d;this.style("position","absolute");this.style("width",""+c+"px");this.style("height",""+a+"px");this.style("overflow","hidden");this.enableEvents(d);this.setBounds(0,0,c,a);this.checkDebug();return this};CAAT.Foundation.Director.prototype.render=function(e){this.time+=e;this.animate(this,e);var b,a,d;if(!navigator.isCocoonJS&&CAAT.DEBUG){this.resetStats()}for(b=0,a=this.childrenList.length;b<a;b++){var f=this.childrenList[b];if(f.isInAnimationFrame(this.time)&&!f.isPaused()){d=f.time-f.start_time;f.timerManager.checkTimers(d);f.timerManager.removeExpiredTimers()}}for(b=0,a=this.childrenList.length;b<a;b++){var f=this.childrenList[b];if(f.isInAnimationFrame(this.time)){d=f.time-f.start_time;if(f.onRenderStart){f.onRenderStart(d)}f.paintActor(this,d);if(f.onRenderEnd){f.onRenderEnd(d)}if(!f.isPaused()){f.time+=e}if(!navigator.isCocoonJS&&CAAT.DEBUG){this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded;this.statistics.size_total+=f.size_total;this.statistics.size_active+=f.size_active;this.statistics.size_dirtyRects=this.nDirtyRects}}}this.frameCounter++};CAAT.Foundation.Director.prototype.addScene=function(a){a.setVisible(true);a.setBounds(0,0,this.width,this.height);this.scenes.push(a);a.setEaseListener(this);if(null===this.currentScene){this.setScene(0)}this.domElement.appendChild(a.domElement)};CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[];this.domElement.innerHTML="";this.createEventHandler()};CAAT.Foundation.Director.prototype.setClear=function(a){return this};CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=document.createElement("div");this.domElement.appendChild(this.eventHandler);this.eventHandler.style.position="absolute";this.eventHandler.style.left="0";this.eventHandler.style.top="0";this.eventHandler.style.zIndex=999999;this.eventHandler.style.width=""+this.width+"px";this.eventHandler.style.height=""+this.height+"px";this.canvas=this.eventHandler;this.in_=false;this.addHandlers(this.canvas)};CAAT.Foundation.Director.prototype.inDirtyRect=function(){return true}}}});CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(a){this.scene=a;return this},setApplicationRange:function(a){this.range=a;return this},setLayoutOp:function(a){this.layoutOp=a;return this},setSizes:function(c,a){this.minSize=c;this.maxSize=a;for(var b=0;b<this.childrenList.length;b++){this.childrenList[b].width=c;this.childrenList[b].height=c}return this},layout:function(){var e,f;var h=CAAT.Foundation.UI.Dock;if(this.layoutOp===h.OP_LAYOUT_BOTTOM||this.layoutOp===h.OP_LAYOUT_TOP){var d=0,b=0;for(e=0;e<this.getNumChildren();e++){d+=this.getChildAt(e).width}b=(this.width-d)/2;for(e=0;e<this.getNumChildren();e++){f=this.getChildAt(e);f.x=b;b+=f.width;if(this.layoutOp===h.OP_LAYOUT_BOTTOM){f.y=this.maxSize-f.height}else{f.y=0}}}else{var g=0,a=0;for(e=0;e<this.getNumChildren();e++){g+=this.getChildAt(e).height}a=(this.height-g)/2;for(e=0;e<this.getNumChildren();e++){f=this.getChildAt(e);f.y=a;a+=f.height;if(this.layoutOp===h.OP_LAYOUT_LEFT){f.x=0}else{f.x=this.width-f.width}}}},mouseMove:function(a){this.actorNotPointed()},mouseExit:function(a){this.actorNotPointed()},actorNotPointed:function(){var a;var c=this;for(a=0;a<this.getNumChildren();a++){var b=this.getChildAt(a);b.emptyBehaviorList();b.addBehavior(new CAAT.Behavior.GenericBehavior().setValues(b.width,this.minSize,b,"width").setFrameTime(this.scene.time,250)).addBehavior(new CAAT.Behavior.GenericBehavior().setValues(b.height,this.minSize,b,"height").setFrameTime(this.scene.time,250));if(a===this.getNumChildren()-1){b.behaviorList[0].addListener({behaviorApplied:function(f,h,d,e,g){e.parent.layout()},behaviorExpired:function(e,f,d){for(a=0;a<c.getNumChildren();a++){b=c.getChildAt(a);b.width=c.minSize;b.height=c.minSize}d.parent.layout()}})}}},actorPointed:function(k,j,d){var e=this.findChild(d);var h=CAAT.Foundation.UI.Dock;var f=0;if(this.layoutOp===h.OP_LAYOUT_BOTTOM||this.layoutOp===h.OP_LAYOUT_TOP){f=k/d.width}else{f=j/d.height}var b;for(b=0;b<this.childrenList.length;b++){var a=this.childrenList[b];a.emptyBehaviorList();var g=0;if(b<e-this.range||b>e+this.range){g=this.minSize}else{if(b===e){g=this.maxSize}else{if(b<e){g=this.minSize+(this.maxSize-this.minSize)*(Math.cos((b-e-f+1)/this.range*Math.PI)+1)/2}else{g=this.minSize+(this.maxSize-this.minSize)*(Math.cos((b-e-f)/this.range*Math.PI)+1)/2}}}a.height=g;a.width=g}this.layout()},actorMouseExit:function(c){if(null!==this.ttask){this.ttask.cancel()}var a=this;this.ttask=this.scene.createTimer(this.scene.time,100,function b(d,f,e){a.actorNotPointed()},null,null)},actorMouseEnter:function(a){if(null!==this.ttask){this.ttask.cancel();this.ttask=null}},addChild:function(a){var b=this;a.__Dock_mouseEnter=a.mouseEnter;a.__Dock_mouseExit=a.mouseExit;a.__Dock_mouseMove=a.mouseMove;a.mouseEnter=function(c){b.actorMouseEnter(c);this.__Dock_mouseEnter(c)};a.mouseExit=function(c){b.actorMouseExit(c);this.__Dock_mouseExit(c)};a.mouseMove=function(c){b.actorPointed(c.point.x,c.point.y,c.source);this.__Dock_mouseMove(c)};a.width=this.minSize;a.height=this.minSize;return CAAT.Foundation.UI.Dock.superclass.addChild.call(this,a)}}});CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(a){this.gap=a;return this},setInterpolator:function(b,a){this.interpolator=b;this.contour=b.getContour(a||this.S);return this},paint:function(a,f){CAAT.InterpolatorActor.superclass.paint.call(this,a,f);if(this.backgroundImage){return this}if(this.interpolator){var c=a.ctx;var b=(this.width-2*this.gap);var e=(this.height-2*this.gap);c.beginPath();c.moveTo(this.gap+b*this.contour[0].x,-this.gap+this.height-e*this.contour[0].y);for(var d=1;d<this.contour.length;d++){c.lineTo(this.gap+b*this.contour[d].x,-this.gap+this.height-e*this.contour[d].y)}c.strokeStyle=this.strokeStyle;c.stroke()}},getInterpolator:function(){return this.interpolator}}});CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var b=0;var d=0.6;var h=function(i){this.ctx=i;return this};h.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,setDefault:function(i){this.defaultFS=24;this.font="Arial";this.fontSize=this.defaultFS;this.fill="#000";this.stroke="#f00";this.filled=true;this.stroked=false;this.strokeSize=1;this.italic=false;this.bold=false;this.alignment="left";this.tabSize=75;this.shadow=false;this.shadowBlur=0;this.shadowColor="#000";for(var j in i){if(i.hasOwnProperty(j)){this[j]=i[j]}}this.__setFont();return this},setStyle:function(j){if(typeof j!=="undefined"){for(var i in j){this[i]=j[i]}}return this},applyStyle:function(){this.__setFont();return this},clone:function(){var k=new h(this.ctx);var j;for(j in this){if(this.hasOwnProperty(j)){k[j]=this[j]}}var i=this;while(i.chain){i=i.chain;for(j in i){if(k[j]===null&&i.hasOwnProperty(j)){k[j]=i[j]}}}k.__setFont();return k},__getProperty:function(k){var j=this;var i;do{i=j[k];if(i!==null){return i}j=j.chain}while(j);return null},image:function(i){this.__setShadow(i)},text:function(j,k,i,m){this.__setShadow(j);j.font=this.__getProperty("sfont");if(this.filled){this.__fillText(j,k,i,m)}if(this.stroked){this.__strokeText(j,k,i,m)}},__setShadow:function(i){if(this.__getProperty("shadow")){i.shadowBlur=this.__getProperty("shadowBlur");i.shadowColor=this.__getProperty("shadowColor")}},__fillText:function(j,k,i,m){j.fillStyle=this.__getProperty("fill");j.fillText(k,i,m)},__strokeText:function(j,k,i,m){j.strokeStyle=this.__getProperty("stroke");j.lineWidth=this.__getProperty("strokeSize");j.beginPath();j.strokeText(k,i,m)},__setFont:function(){var j=this.__getProperty("italic");var k=this.__getProperty("bold");var m=this.__getProperty("fontSize");var i=this.__getProperty("font");this.sfont=(j?"italic ":"")+(k?"bold ":"")+m+"px "+i;this.ctx.font=this.__getProperty("sfont")},setBold:function(i){if(i!=this.bold){this.bold=i;this.__setFont()}},setItalic:function(i){if(i!=this.italic){this.italic=i;this.__setFont()}},setStroked:function(i){this.stroked=i},setFilled:function(i){this.filled=i},getTabPos:function(i){var j=this.__getProperty("tabSize");return(((i/j)>>0)+1)*j},setFillStyle:function(i){this.fill=i},setStrokeStyle:function(i){this.stroke=i},setStrokeSize:function(i){this.strokeSize=i},setAlignment:function(i){this.alignment=i},setFontSize:function(i){if(i!==this.fontSize){this.fontSize=i;this.__setFont()}}};var c=function(){this.text="";return this};c.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0;this.currentLine=new f();this.lines.push(this.currentLine)},__image:function(k,j,m){var i;if(j&&m){i=k.getWidth()}else{i=k.getWrappedImageWidth()}if(this.width){if(i+this.x>this.width&&this.x>0){this.__nextLine()}}this.currentLine.addElementImage(new g(this.x,k,j,m,this.crcs.clone(),this.__getCurrentAnchor()));this.x+=i},__text:function(){if(this.text.length===0){return}var i=this.ctx.measureText(this.text).width;if(this.width){if(i+this.x>this.width&&this.x>0){this.__nextLine()}}this.currentLine.addElement(new e(this.text,this.x,i,0,this.crcs.clone(),this.__getCurrentAnchor()));this.x+=i;this.text=""},fchar:function(i){if(i===" "){this.__text();this.x+=this.ctx.measureText(i).width;if(this.width){if(this.x>this.width){this.__nextLine()}}}else{this.text+=i}},end:function(){if(this.text.length>0){this.__text()}var n=0;var k=0;for(var j=0;j<this.lines.length;j++){var m=this.lines[j].getHeight();if(m===0){m=this.styles["default"].fontSize}n+=m;if(j===this.lines.length-1){k=(m*0.25)>>0}this.lines[j].setY(n)}this.documentHeight=n+k},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){if(this.anchorStack.length){return this.anchorStack[this.anchorStack.length-1]}return null},__resetAppliedStyles:function(){this.rcs=[];this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=new h(this.ctx).setDefault(this.styles["default"]);this.rcs.push(this.crcs)},__pushStyle:function(j){var i=this.crcs;this.crcs=new h(this.ctx);this.crcs.chain=i;this.crcs.setStyle(j);this.crcs.applyStyle();this.rcs.push(this.crcs)},__popStyle:function(){if(this.rcs.length>1){this.rcs.pop();this.crcs=this.rcs[this.rcs.length-1];this.crcs.applyStyle()}},__popAnchor:function(){if(this.anchorStack.length>0){this.anchorStack.pop()}},__pushAnchor:function(i){this.anchorStack.push(i)},start:function(j,m,i,k){this.x=0;this.y=0;this.width=typeof k!=="undefined"?k:0;this.ctx=j;this.lines=[];this.styles=m;this.images=i;this.anchorStack=[];this.__resetAppliedStyles();this.__nextLine()},setTag:function(i){var m,j;this.__text();i=i.toLowerCase();if(i==="b"){this.crcs.setBold(true)}else{if(i==="/b"){this.crcs.setBold(false)}else{if(i==="i"){this.crcs.setItalic(true)}else{if(i==="/i"){this.crcs.setItalic(false)}else{if(i==="stroked"){this.crcs.setStroked(true)}else{if(i==="/stroked"){this.crcs.setStroked(false)}else{if(i==="filled"){this.crcs.setFilled(true)}else{if(i==="/filled"){this.crcs.setFilled(false)}else{if(i==="tab"){this.x=this.crcs.getTabPos(this.x)}else{if(i==="br"){this.__nextLine()}else{if(i==="/a"){this.__popAnchor()}else{if(i==="/style"){if(this.rcs.length>1){this.__popStyle()}else{}}else{if(i.indexOf("fillcolor")===0){m=i.split("=");this.crcs.setFillStyle(m[1])}else{if(i.indexOf("strokecolor")===0){m=i.split("=");this.crcs.setStrokeStyle(m[1])}else{if(i.indexOf("strokesize")===0){m=i.split("=");this.crcs.setStrokeSize(m[1]|0)}else{if(i.indexOf("fontsize")===0){m=i.split("=");this.crcs.setFontSize(m[1]|0)}else{if(i.indexOf("style")===0){m=i.split("=");j=this.styles[m[1]];if(j){this.__pushStyle(j)}}else{if(i.indexOf("image")===0){m=i.split("=")[1].split(",");var n=m[0];if(this.images[n]){var k=0,o=0;if(m.length>=3){k=m[1]|0;o=m[2]|0}this.__image(this.images[n],k,o)}}else{if(i.indexOf("a=")===0){m=i.split("=");this.__pushAnchor(m[1])}}}}}}}}}}}}}}}}}}}}};var a=function(i,j){this.link=i;this.style=j;return this};a.prototype={x:null,y:null,width:null,height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(i){this.link=i;return this},getLink:function(){return this.link},contains:function(i,j){return false}};var g=function(i,n,m,o,k,j){g.superclass.constructor.call(this,j,k);this.x=i;this.image=n;this.row=m;this.column=o;this.width=n.getWidth();this.height=n.getHeight();if(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage){this.spriteIndex=m*n.columns+o;this.paint=this.paintSI}return this};g.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(i){this.style.image(i);i.drawImage(this.image,this.x,-this.height+1);if(b){i.strokeRect(this.x,-this.height+1,this.width,this.height)}},paintSI:function(i){this.style.image(i);this.image.setSpriteIndex(this.spriteIndex);this.image.paint({ctx:i},0,this.x,-this.height+1);if(b){i.strokeRect(this.x,-this.height+1,this.width,this.height)}},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.singleHeight:this.image.height},getFontMetrics:function(){return null},contains:function(i,j){return i>=this.x&&i<=this.x+this.width&&j>=this.y&&j<this.y+this.height},setYPosition:function(i){this.y=i-this.height+1}};var e=function(o,j,n,i,m,k){e.superclass.constructor.call(this,k,m);this.x=j;this.y=0;this.width=n;this.text=o;this.style=m;this.fm=CAAT.Module.Font.Font.getFontMetrics(m.sfont);this.height=this.fm.height;return this};e.prototype={text:null,style:null,fm:null,bl:null,paint:function(i){this.style.text(i,this.text,this.x,0);if(b){i.strokeRect(this.x,-this.fm.ascent,this.width,this.height)}},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(i,j){return i>=this.x&&i<=this.x+this.width&&j>=this.y&&j<=this.y+this.height},setYPosition:function(i){this.bl=i;this.y=i-this.fm.ascent}};extend(g,a);extend(e,a);var f=function(){this.elements=[];return this};f.prototype={elements:null,width:0,height:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(i){this.width=Math.max(this.width,i.x+i.width);this.height=Math.max(this.height,i.height);this.elements.push(i);this.alignment=i.style.__getProperty("alignment")},addElementImage:function(i){this.width=Math.max(this.width,i.x+i.width);this.height=Math.max(this.height,i.height);this.elements.push(i)},getHeight:function(){return this.height},setY:function(i){this.y=i},getY:function(){return this.y},paint:function(j){j.save();j.translate(this.x,this.y+this.baselinePos);for(var k=0;k<this.elements.length;k++){this.elements[k].paint(j)}j.restore()},setAlignment:function(m){var i;if(this.alignment==="center"){this.x=(m-this.width)/2}else{if(this.alignment==="right"){this.x=m-this.width}else{if(this.alignment==="justify"){if(this.width/m>=d&&this.elements.length>1){var k=m-this.width;var n=(k/(this.elements.length-1))|0;for(i=1;i<this.elements.length;i++){this.elements[i].x+=i*n}k=m-this.width-n*(this.elements.length-1);for(i=0;i<k;i++){this.elements[this.elements.length-1-i].x+=k-i}}}}}},adjustHeight:function(){var k=null;var o=null;var j;for(j=0;j<this.elements.length;j+=1){var n=this.elements[j];var m=n.getFontMetrics();if(null!=m){if(!k){k=m}else{if(m.ascent>k.ascent){k=m}}}else{if(!o){o=n}else{if(n.getHeight()>n.getHeight()){o=n}}}}this.baselinePos=Math.max(k?k.ascent:0,o?o.getHeight():0);this.height=this.baselinePos+(k!=null?k.descent:0);for(j=0;j<this.elements.length;j++){this.elements[j].setYPosition(this.baselinePos)}return this.height},__getElementAt:function(j,n){for(var k=0;k<this.elements.length;k++){var m=this.elements[k];if(m.contains(j,n)){return m}}return null}};return{__init:function(){this.__super();this.rc=new c();this.lines=[];this.styles={};this.images={};return this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:true,lines:null,images:null,clickCallback:null,setStyle:function(i,j){this.styles[i]=j;return this},addImage:function(i,j){this.images[i]=j;return this},setSize:function(i,j){CAAT.Foundation.UI.Label.superclass.setSize.call(this,i,j);this.setText(this.text,this.width);return this},setBounds:function(i,m,j,k){CAAT.Foundation.UI.Label.superclass.setBounds.call(this,i,m,j,k);this.setText(this.text,this.width);return this},setText:function(o,j){if(null===o){return}var k=this.cached;if(k){this.stopCacheAsBitmap()}this.documentWidth=0;this.documentHeight=0;this.text=o;var n,m,r;var p,t;var q;var s=CAAT.currentDirector.ctx;s.save();r=this.text;n=0;m=r.length;this.rc.start(s,this.styles,this.images,j);while(n<m){q=r.charAt(n);if(q==="\\"){n+=1;this.rc.fchar(r.charAt(n));n+=1}else{if(q==="<"){p=r.indexOf(">",n+1);if(-1!==p){t=r.substr(n+1,p-n-1);if(t.indexOf("<")!==-1){this.rc.fchar(q);n+=1}else{this.rc.setTag(t);n=p+1}}}else{this.rc.fchar(q);n+=1}}}this.rc.end();this.lines=this.rc.lines;this.__calculateDocumentDimension(typeof j==="undefined"?0:j);this.setLinesAlignment();s.restore();this.setPreferredSize(this.documentWidth,this.documentHeight);this.invalidateLayout();this.setDocumentPosition();if(k){this.cacheAsBitmap(0,k)}return this},setVerticalAlignment:function(i){this.valignment=i;this.setDocumentPosition();return this},setHorizontalAlignment:function(i){this.halignment=i;this.setDocumentPosition();return this},setDocumentPosition:function(){var i=0,j=0;if(this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER){j=(this.height-this.documentHeight)/2}else{if(this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM){j=this.height-this.documentHeight}}if(this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER){i=(this.width-this.documentWidth)/2}else{if(this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT){i=this.width-this.documentWidth}}this.documentX=i;this.documentY=j},__calculateDocumentDimension:function(k){var j;var m=0;this.documentWidth=0;this.documentHeight=0;for(j=0;j<this.lines.length;j++){this.lines[j].y=m;this.documentWidth=Math.max(this.documentWidth,this.lines[j].width);this.documentHeight+=this.lines[j].adjustHeight();m+=this.lines[j].getHeight()}this.documentWidth=Math.max(this.documentWidth,k);return this},setLinesAlignment:function(){for(var j=0;j<this.lines.length;j++){this.lines[j].setAlignment(this.documentWidth)}},paint:function(m,o){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var k=m.ctx;k.save();k.textBaseline="alphabetic";k.translate(this.documentX,this.documentY);for(var n=0;n<this.lines.length;n++){var j=this.lines[n];j.paint(m.ctx);if(b){k.strokeRect(j.x,j.y,j.width,j.height)}}k.restore()}else{if(this.backgroundImage){this.backgroundImage.paint(m,o,0,0)}}},__getDocumentElementAt:function(j,n){j-=this.documentX;n-=this.documentY;for(var m=0;m<this.lines.length;m++){var k=this.lines[m];if(k.x<=j&&k.y<=n&&k.x+k.width>=j&&k.y+k.height>=n){return k.__getElementAt(j-k.x,n-k.y)}}return null},mouseExit:function(i){CAAT.setCursor("default")},mouseMove:function(j){var i=this.__getDocumentElementAt(j.x,j.y);if(i&&i.getLink()){CAAT.setCursor("pointer")}else{CAAT.setCursor("default")}},mouseClick:function(j){if(this.clickCallback){var i=this.__getDocumentElementAt(j.x,j.y);if(i.getLink()){this.clickCallback(i.getLink())}}},setClickCallback:function(i){this.clickCallback=i;return this}}}});CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:false,outlineColor:"black",onUpdateCallback:null,interactive:false,showBBox:false,getPath:function(){return this.path},setPath:function(a){this.path=a;if(a!=null){this.pathBoundingRectangle=a.getBoundingBox();this.setInteractive(this.interactive)}return this},paint:function(b,c){CAAT.Foundation.UI.PathActor.superclass.paint.call(this,b,c);if(!this.path){return}var a=b.ctx;a.strokeStyle="#000";this.path.paint(b,this.interactive);if(this.bOutline){a.strokeStyle=this.outlineColor;a.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height)}},showBoundingBox:function(a,b){this.bOutline=a;if(a&&b){this.outlineColor=b}return this},setInteractive:function(a){this.interactive=a;if(this.path){this.path.setInteractive(a)}return this},setOnUpdateCallback:function(a){this.onUpdateCallback=a;return this},mouseDrag:function(a){this.path.drag(a.point.x,a.point.y,this.onUpdateCallback)},mouseDown:function(a){this.path.press(a.point.x,a.point.y)},mouseUp:function(a){this.path.release()}}});CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){this.__super();this.compositeOp="source-over";this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE);return this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=a;return this},setLineJoin:function(a){this.lineJoin=a;return this},setMiterLimit:function(a){this.miterLimit=a;return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setShape:function(a){this.shape=a;this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle;return this},setCompositeOp:function(a){this.compositeOp=a;return this},paint:function(a,b){},paintCircle:function(b,c){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,b,c);return}var a=b.ctx;a.lineWidth=this.lineWidth;a.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle){a.fillStyle=this.fillStyle;a.beginPath();a.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,false);a.fill()}if(null!==this.strokeStyle){a.strokeStyle=this.strokeStyle;a.beginPath();a.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,false);a.stroke()}},paintRectangle:function(b,c){if(this.cached){CAAT.Foundation.ActorContainer.prototype.paint.call(this,b,c);return}var a=b.ctx;a.lineWidth=this.lineWidth;if(this.lineCap){a.lineCap=this.lineCap}if(this.lineJoin){a.lineJoin=this.lineJoin}if(this.miterLimit){a.miterLimit=this.miterLimit}a.globalCompositeOperation=this.compositeOp;if(null!==this.fillStyle){a.fillStyle=this.fillStyle;a.beginPath();a.fillRect(0,0,this.width,this.height);a.fill()}if(null!==this.strokeStyle){a.strokeStyle=this.strokeStyle;a.beginPath();a.strokeRect(0,0,this.width,this.height);a.stroke()}}}});CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){this.__super();this.compositeOp="source-over";return this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){this.lineWidth=a;return this},setLineCap:function(a){this.lineCap=a;return this},setLineJoin:function(a){this.lineJoin=a;return this},setMiterLimit:function(a){this.miterLimit=a;return this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(a){return this},setOutlined:function(a){return this},setCompositeOp:function(a){this.compositeOp=a;return this},setInitialAngle:function(a){this.initialAngle=a;return this},initialize:function(c,a,b){this.setSize(2*a,2*a);this.nPeaks=c;this.maxRadius=a;this.minRadius=b;return this},paint:function(b,a){var p=b.ctx;var k=this.width/2;var h=this.height/2;var e=this.maxRadius;var c=this.minRadius;var g=k+e*Math.cos(this.initialAngle);var d=h+e*Math.sin(this.initialAngle);p.lineWidth=this.lineWidth;if(this.lineCap){p.lineCap=this.lineCap}if(this.lineJoin){p.lineJoin=this.lineJoin}if(this.miterLimit){p.miterLimit=this.miterLimit}p.globalCompositeOperation=this.compositeOp;p.beginPath();p.moveTo(g,d);for(var m=1;m<this.nPeaks*2;m++){var f=Math.PI/this.nPeaks*m+this.initialAngle;var j=(m%2===0)?e:c;var o=k+j*Math.cos(f);var n=h+j*Math.sin(f);p.lineTo(o,n)}p.lineTo(k+e*Math.cos(this.initialAngle),h+e*Math.sin(this.initialAngle));p.closePath();if(this.fillStyle){p.fillStyle=this.fillStyle;p.fill()}if(this.strokeStyle){p.strokeStyle=this.strokeStyle;p.stroke()}}}});CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){this.__super();this.font="10px sans-serif";this.textAlign="left";this.outlineColor="black";this.clip=false;this.__calcFontData();return this},font:null,fontData:null,textAlign:null,textBaseline:"top",fill:true,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:false,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:10000,sign:1,lx:0,ly:0,setFill:function(a){this.stopCacheAsBitmap();this.fill=a;return this},setLineWidth:function(a){this.stopCacheAsBitmap();this.lineWidth=a;return this},setTextFillStyle:function(a){this.stopCacheAsBitmap();this.textFillStyle=a;return this},setOutline:function(a){this.stopCacheAsBitmap();this.outline=a;return this},setPathTraverseDirection:function(a){this.sign=a;return this},setOutlineColor:function(a){this.stopCacheAsBitmap();this.outlineColor=a;return this},setText:function(a){this.stopCacheAsBitmap();this.text=a;if(null===this.text||this.text===""){this.width=this.height=0}this.calcTextSize(CAAT.currentDirector);this.invalidate();return this},setTextAlign:function(a){this.textAlign=a;this.__setLocation();return this},setAlign:function(a){return this.setTextAlign(a)},setTextBaseline:function(a){this.stopCacheAsBitmap();this.textBaseline=a;return this},setBaseline:function(a){this.stopCacheAsBitmap();return this.setTextBaseline(a)},setFont:function(a){this.stopCacheAsBitmap();if(!a){a="10px sans-serif"}if(a instanceof CAAT.Module.Font.Font){a.setAsSpriteImage()}else{if(a instanceof CAAT.Foundation.SpriteImage){}}this.font=a;this.__calcFontData();this.calcTextSize(CAAT.director[0]);return this},setLocation:function(a,b){this.lx=a;this.ly=b;this.__setLocation();return this},setPosition:function(a,b){this.lx=a;this.ly=b;this.__setLocation();return this},setBounds:function(a,d,b,c){this.lx=a;this.ly=d;this.setSize(b,c);this.__setLocation();return this},setSize:function(a,b){CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,a,b);this.__setLocation();return this},__setLocation:function(){var a,b;if(this.textAlign==="center"){a=this.lx-this.width/2}else{if(this.textAlign==="right"||this.textAlign==="end"){a=this.lx-this.width}else{a=this.lx}}if(this.textBaseline==="bottom"){b=this.ly-this.height}else{if(this.textBaseline==="middle"){b=this.ly-this.height/2}else{if(this.textBaseline==="alphabetic"){b=this.ly-this.fontData.ascent}else{b=this.ly}}}CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,a,b)},centerAt:function(a,b){this.textAlign="left";this.textBaseline="top";return CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,a,b)},calcTextSize:function(b){if(typeof this.text==="undefined"||null===this.text||""===this.text){this.textWidth=0;this.textHeight=0;return this}if(b.glEnabled){return this}if(this.font instanceof CAAT.Foundation.SpriteImage){this.textWidth=this.font.stringWidth(this.text);this.textHeight=this.font.stringHeight();this.width=this.textWidth;this.height=this.textHeight;this.fontData=this.font.getFontData();return this}if(this.font instanceof CAAT.Module.Font.Font){this.textWidth=this.font.stringWidth(this.text);this.textHeight=this.font.stringHeight();this.width=this.textWidth;this.height=this.textHeight;this.fontData=this.font.getFontData();return this}var a=b.ctx;a.save();a.font=this.font;this.textWidth=a.measureText(this.text).width;if(this.width===0){this.width=this.textWidth}this.textHeight=this.fontData.height;this.setSize(this.textWidth,this.textHeight);a.restore();return this},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(c,d){if(!this.text){return}CAAT.Foundation.UI.TextActor.superclass.paint.call(this,c,d);if(this.cached){return}if(null===this.text){return}if(this.textWidth===0||this.textHeight===0){this.calcTextSize(c)}var b=c.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage){this.drawSpriteText(c,d);return}if(null!==this.font){b.font=this.font}b.textBaseline="alphabetic";if(null===this.path){if(null!==this.textAlign){b.textAlign=this.textAlign}var a=0;if(this.textAlign==="center"){a=(this.width/2)|0}else{if(this.textAlign==="right"){a=this.width}}if(this.fill){if(null!==this.textFillStyle){b.fillStyle=this.textFillStyle}b.fillText(this.text,a,this.fontData.ascent)}if(this.outline){if(null!==this.outlineColor){b.strokeStyle=this.outlineColor}b.lineWidth=this.lineWidth;b.beginPath();b.strokeText(this.text,a,this.fontData.ascent)}}else{this.drawOnPath(c,d)}},drawOnPath:function(a,b){var m=a.ctx;if(this.fill&&null!==this.textFillStyle){m.fillStyle=this.textFillStyle}if(this.outline&&null!==this.outlineColor){m.strokeStyle=this.outlineColor}var g=this.sign*this.pathInterpolator.getPosition((b%this.pathDuration)/this.pathDuration).y*this.path.getLength();var k=new CAAT.Math.Point(0,0,0);var j=new CAAT.Math.Point(0,0,0);for(var d=0;d<this.text.length;d++){var e=this.text[d].toString();var f=m.measureText(e).width;var h=g;k=this.path.getPositionFromLength(h).clone();j=this.path.getPositionFromLength(h-0.1).clone();var c=Math.atan2(k.y-j.y,k.x-j.x);m.save();m.translate(k.x>>0,k.y>>0);m.rotate(c);if(this.fill){m.fillText(e,0,0)}if(this.outline){m.beginPath();m.lineWidth=this.lineWidth;m.strokeText(e,0,0)}m.restore();g+=f}},drawSpriteText:function(a,b){if(null===this.path){this.font.drawText(this.text,a.ctx,0,0)}else{this.drawSpriteTextOnPath(a,b)}},drawSpriteTextOnPath:function(b,c){var a=b.ctx;var h=this.sign*this.pathInterpolator.getPosition((c%this.pathDuration)/this.pathDuration).y*this.path.getLength();var n=new CAAT.Math.Point(0,0,0);var m=new CAAT.Math.Point(0,0,0);for(var e=0;e<this.text.length;e++){var f=this.text[e].toString();var g=this.font.stringWidth(f);var j=g/2+h;n=this.path.getPositionFromLength(j).clone();m=this.path.getPositionFromLength(j-0.1).clone();var d=Math.atan2(n.y-m.y,n.x-m.x);a.save();a.translate(n.x|0,n.y|0);a.rotate(d);var k=this.textBaseline==="bottom"?0-this.font.getHeight():0;this.font.drawText(f,a,0,k);a.restore();h+=g}},setPath:function(b,c,a){this.path=b;this.pathInterpolator=c||new CAAT.Behavior.Interpolator().createLinearInterpolator();this.pathDuration=a||10000;this.mouseEnabled=false;return this}}});CAAT.ModuleManager.solveAll();CAAT.Module.Initialization.Template=CAAT.Module.Initialization.Template||{};CAAT.Module.Initialization.Template.init=function(a,h,d,g,c){var e=document.getElementById(d);var b;if(CAAT.__CSS__){if(e){if(false===e instanceof HTMLDivElement){e=null}}if(e===null){e=document.createElement("div");document.body.appendChild(e)}b=new CAAT.Director().initialize(a||800,h||600,e)}else{if(e){if(e instanceof HTMLDivElement){var i=document.createElement("canvas");e.appendChild(i);e=i}else{if(false==e instanceof HTMLCanvasElement){var i=document.createElement("canvas");document.body.appendChild(i);e=i}}}else{e=document.createElement("canvas");document.body.appendChild(e)}b=new CAAT.Director().initialize(a||800,h||600,e)}new CAAT.Module.Preloader.ImagePreloader().loadImages(g,function f(k,j){if(k==j.length){b.emptyScenes();b.setImagesCache(j);app&&app.activityLoaded&&app.activityLoaded();c(b);b.setScene(0);CAAT.loop(60)}})};